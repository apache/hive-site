<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : Storage Based Authorization in the Metastore Server</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--storage-based-authorization-in-the-metastore-server>Apache Hive : Storage Based Authorization in the Metastore Server</h1>
<ul>
<li><a href=#storage-based-authorization-in-the-metastore-server>Storage Based Authorization in the Metastore Server</a>
<ul>
<li><a href=#the-need-for-metastore-server-security>The Need for Metastore Server Security</a></li>
<li><a href=#storage-based-authorization>Storage Based Authorization</a></li>
<li><a href=#configuration-parameters-for-metastore-security>Configuration Parameters for Metastore Security</a>
<ul>
<li><a href=#sample-hive-site-xml:-default-settings>Sample hive-site.xml: Default Settings</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id=storage-based-authorization-in-the-metastore-server>Storage Based Authorization in the Metastore Server</h1>
<p>The metastore server security feature with storage based authorization was added to Hive in release 0.10. This feature was introduced previously in <a href=https://hive.apache.org/docs/latest/hcatalog-authorization_34014782/>HCatalog</a>.</p>
<p>Version 0.10.0</p>
<p><a href=https://issues.apache.org/jira/browse/HIVE-3705>HIVE-3705</a> added metastore server security to Hive in release 0.10.0.</p>
<ul>
<li>For additional information about storage based authorization in the metastore server, see the HCatalog document <a href=https://hive.apache.org/docs/latest/hcatalog-authorization_34014782/>Storage Based Authorization</a>.</li>
<li>For an overview of Hive authorization models and other security options, see the <a href=https://hive.apache.org/docs/latest/languagemanual-authorization_27362032/>Authorization</a> document.</li>
</ul>
<h2 id=the-need-for-metastore-server-security>The Need for Metastore Server Security</h2>
<p>When multiple clients access the same metastore in a backing database, such as MySQL, the database connection credentials may be visible in the <code>hive-site.xml</code> configuration file. A malicious or incompetent user could cause serious damage to metadata even though the underlying data is protected by HDFS access controls.</p>
<p>Also, when a Hive metastore server uses Thrift to communicate with clients and has a backing database for metadata storage and persistence, the authentication and authorization done on the client side cannot guarantee security on the metastore side. To provide security for metadata, Hive release 0.10 added authorization capability to the metastore. (See <a href=https://issues.apache.org/jira/browse/HIVE-3705>HIVE-3705</a>.) </p>
<h2 id=storage-based-authorization>Storage Based Authorization</h2>
<p>When metastore server security is configured to use Storage Based Authorization, it uses the file system permissions for folders corresponding to the different metadata objects as the source of truth for the authorization policy. Use of Storage Based Authorization in metastore is recommended.</p>
<p>See details in the HCatalog <a href=https://hive.apache.org/docs/latest/hcatalog-authorization_34014782/>Storage Based Authorization document</a>.</p>
<p>Starting in Hive 0.14, storage based authorization authorizes read privilege on database and tables. The <code>get_database</code> api call needs database directory read privilege. The <code>get_table_*</code> calls that fetch table information and <code>get_partition_*</code> calls to list the partitions of a table require read privilege on the table directory. It is enabled by default with storage based authorization. See hive.security.metastore.authorization.auth.reads in the next section on configuration.</p>
<h2 id=configuration-parameters-for-metastore-security>Configuration Parameters for Metastore Security</h2>
<p>To enable Hive metastore server security, set these parameters in <code>hive-site.xml</code>:</p>
<ul>
<li><code>hive.metastore.pre.event.listeners</code></li>
</ul>
<p>Set to <code>org.apache.hadoop.hive.ql.security.authorization.AuthorizationPreEventListener</code> .</p>
<p>This turns on metastore-side security.</p>
<ul>
<li><code>hive.security.metastore.authorization.manager</code></li>
</ul>
<p>Set to <code>org.apache.hadoop.hive.ql.security.authorization.StorageBasedAuthorizationProvider</code> .</p>
<p>This tells Hive which metastore-side authorization provider to use. The default setting uses <code>DefaultHiveMetastoreAuthorizationProvider</code>, which implements the standard Hive grant/revoke model. To use an HDFS permission-based model (recommended) to do your authorization, use <code>StorageBasedAuthorizationProvider</code> as instructed above.</p>
<p>Versions 0.10.0 and 0.12.0</p>
<p>The <code>StorageBasedAuthorizationProvider</code> was introduced in Hive 0.10.0, running on the metastore side only (<a href=https://issues.apache.org/jira/browse/HIVE-3705>HIVE-3705</a>). Starting in Hive 0.12.0 it also runs on the client side (<a href=https://issues.apache.org/jira/browse/HIVE-5048>HIVE-5048</a> and <a href=https://issues.apache.org/jira/browse/HIVE-5402>HIVE-5402</a>).</p>
<ul>
<li>hive.security.metastore.authenticator.manager</li>
</ul>
<p>Set to <code>org.apache.hadoop.hive.ql.security.HadoopDefaultMetastoreAuthenticator</code> .</p>
<ul>
<li><code>hive.security.metastore.authorization.auth.reads</code><br>
When this is set to true, Hive metastore authorization also checks for read access. It is set to true by default. Read authorization checks were introduced in <a href=https://issues.apache.org/jira/browse/HIVE-8221>Hive 0.14.0</a>.</li>
</ul>
<h3 id=sample-hive-sitexml-default-settings>Sample hive-site.xml:  Default Settings</h3>
<p>The snippet below shows the keys as they are in a default state in <code>hive-site.xml</code> (metastore-side security set up to use the default authorization/authentication, but disabled). Please edit in information as above to get the desired authorization behaviour:</p>
<pre tabindex=0><code>&lt;property&gt;
  &lt;name&gt;hive.security.metastore.authorization.manager&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hive.ql.security.authorization.DefaultHiveMetastoreAuthorizationProvider&lt;/value&gt;
  &lt;description&gt;authorization manager class name to be used in the metastore for authorization.
  The user defined authorization class should implement interface
  org.apache.hadoop.hive.ql.security.authorization.HiveMetastoreAuthorizationProvider.
  &lt;/description&gt;
 &lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;hive.security.metastore.authenticator.manager&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hive.ql.security.HadoopDefaultMetastoreAuthenticator&lt;/value&gt;
  &lt;description&gt;authenticator manager class name to be used in the metastore for authentication.
  The user defined authenticator should implement interface 
  org.apache.hadoop.hive.ql.security.HiveAuthenticationProvider.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;hive.metastore.pre.event.listeners&lt;/name&gt;
  &lt;value&gt; &lt;/value&gt;
  &lt;description&gt;pre-event listener classes to be loaded on the metastore side to run code
  whenever databases, tables, and partitions are created, altered, or dropped.
  Set to org.apache.hadoop.hive.ql.security.authorization.AuthorizationPreEventListener
  if metastore-side authorization is desired.
  &lt;/description&gt;
&lt;/property&gt;

</code></pre>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>