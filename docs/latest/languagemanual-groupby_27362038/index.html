<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : LanguageManual GroupBy</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--languagemanual-groupby>Apache Hive : LanguageManual GroupBy</h1>
<ul>
<li><a href=#group-by-syntax>Group By Syntax</a>
<ul>
<li><a href=#simple-examples>Simple Examples</a></li>
<li><a href=#select-statement-and-group-by-clause>Select statement and group by clause</a></li>
</ul>
</li>
<li><a href=#advanced-features>Advanced Features</a>
<ul>
<li><a href=#multi-group-by-inserts>Multi-Group-By Inserts</a></li>
<li><a href=#map-side-aggregation-for-group-by>Map-side Aggregation for Group By</a></li>
<li><a href=#grouping-sets-cubes-rollups-and-the-grouping__id-function>Grouping Sets, Cubes, Rollups, and the GROUPING__ID Function</a></li>
</ul>
</li>
</ul>
<h2 id=group-by-syntax>Group By Syntax</h2>
<pre tabindex=0><code>groupByClause: GROUP BY groupByExpression (, groupByExpression)*

groupByExpression: expression

groupByQuery: SELECT expression (, expression)* FROM src groupByClause?

</code></pre><p>In <code>groupByExpression</code> columns are specified by name, not by position number. However in <a href=https://issues.apache.org/jira/browse/HIVE-581>Hive 0.11.0</a> and later, columns can be specified by position when configured as follows:</p>
<ul>
<li>For Hive 0.11.0 through 2.1.x, set <a href=#hive-groupby-orderby-position-alias>hive.groupby.orderby.position.alias</a> to true (the default is false).</li>
<li>For Hive 2.2.0 and later, set <a href=#hive-groupby-position-alias>hive.groupby.position.alias</a> to true (the default is false).</li>
</ul>
<h3 id=simple-examples>Simple Examples</h3>
<p>In order to count the number of rows in a table:</p>
<pre tabindex=0><code>  SELECT COUNT(*) FROM table2;

</code></pre><p>Note that for versions of Hive which don&rsquo;t include <a href=https://issues.apache.org/jira/browse/HIVE-287>HIVE-287</a>, you&rsquo;ll need to use COUNT(1) in place of COUNT(*).</p>
<p>In order to count the number of distinct users by gender one could write the following query:</p>
<pre tabindex=0><code>  INSERT OVERWRITE TABLE pv_gender_sum
  SELECT pv_users.gender, count (DISTINCT pv_users.userid)
  FROM pv_users
  GROUP BY pv_users.gender;

</code></pre><p>Multiple aggregations can be done at the same time, however, no two aggregations can have different DISTINCT columns. For example, the following is possible because count(DISTINCT) and sum(DISTINCT) specify the same column:</p>
<pre tabindex=0><code>  INSERT OVERWRITE TABLE pv_gender_agg
  SELECT pv_users.gender, count(DISTINCT pv_users.userid), count(*), sum(DISTINCT pv_users.userid)
  FROM pv_users
  GROUP BY pv_users.gender;

</code></pre><p>Note that for versions of Hive which don&rsquo;t include <a href=https://issues.apache.org/jira/browse/HIVE-287>HIVE-287</a>, you&rsquo;ll need to use COUNT(1) in place of COUNT(*).</p>
<p>However, the following query is not allowed. We don&rsquo;t allow multiple DISTINCT expressions in the same query.</p>
<pre tabindex=0><code>  INSERT OVERWRITE TABLE pv_gender_agg
  SELECT pv_users.gender, count(DISTINCT pv_users.userid), count(DISTINCT pv_users.ip)
  FROM pv_users
  GROUP BY pv_users.gender;

</code></pre><h3 id=select-statement-and-group-by-clause>Select statement and group by clause</h3>
<p>When using group by clause, the select statement can only include columns included in the group by clause. Of course, you can have as many aggregation functions (e.g. <code>count</code>) in the select statement as well.<br>
Let&rsquo;s take a simple example</p>
<pre tabindex=0><code>CREATE TABLE t1(a INTEGER, b INTGER);

</code></pre><p>A group by query on the above table could look like:</p>
<pre tabindex=0><code>SELECT
   a,
   sum(b)
FROM
   t1
GROUP BY
   a;

</code></pre><p>The above query works because the select clause contains <code>a</code> (the group by key) and an aggregation function (<code>sum(b)</code>).</p>
<p>However, the query below <strong>DOES NOT</strong> work:</p>
<pre tabindex=0><code>SELECT
   a,
   b
FROM
   t1
GROUP BY
   a;

</code></pre><p>This is because the select clause has an additional column (<code>b</code>) that is not included in the group by clause (and it&rsquo;s not an aggregation function either). This is because, if the table <code>t1</code> looked like:</p>
<pre tabindex=0><code>a    b
------
100  1
100  2
100  3

</code></pre><p>Since the grouping is only done on <code>a</code>, what value of <code>b</code> should Hive display for the group <code>a=100</code>? One can argue that it should be the first value or the lowest value but we all agree that there are multiple possible options. Hive does away with this guessing by making it invalid SQL (HQL, to be precise) to have a column in the select clause that is not included in the group by clause.</p>
<h2 id=advanced-features>Advanced Features</h2>
<h3 id=multi-group-by-inserts>Multi-Group-By Inserts</h3>
<p>The output of the aggregations or simple selects can be further sent into multiple tables or even to hadoop dfs files (which can then be manipulated using hdfs utilitites). e.g. if along with the gender breakdown, one needed to find the breakdown of unique page views by age, one could accomplish that with the following query:</p>
<pre tabindex=0><code>  FROM pv_users 
  INSERT OVERWRITE TABLE pv_gender_sum
    SELECT pv_users.gender, count(DISTINCT pv_users.userid) 
    GROUP BY pv_users.gender 
  INSERT OVERWRITE DIRECTORY '/user/facebook/tmp/pv_age_sum'
    SELECT pv_users.age, count(DISTINCT pv_users.userid) 
    GROUP BY pv_users.age; 

</code></pre><h3 id=map-side-aggregation-for-group-by>Map-side Aggregation for Group By</h3>
<p><em>hive.map.aggr</em> controls how we do aggregations. The default is false. If it is set to true, Hive will do the first-level aggregation directly in the map task.<br>
This usually provides better efficiency, but may require more memory to run successfully.</p>
<pre tabindex=0><code>  set hive.map.aggr=true;
  SELECT COUNT(*) FROM table2;

</code></pre><p>Note that for versions of Hive which don&rsquo;t include <a href=https://issues.apache.org/jira/browse/HIVE-287>HIVE-287</a>, you&rsquo;ll need to use COUNT(1) in place of COUNT(*).</p>
<h3 id=grouping-sets-cubes-rollups-and-the-grouping__id-function>Grouping Sets, Cubes, Rollups, and the GROUPING__ID Function</h3>
<p>Version</p>
<p>Grouping sets, CUBE and ROLLUP operators, and the GROUPING__ID function were added in Hive release 0.10.0.</p>
<p>See <a href=https://hive.apache.org/docs/latest/30151323/>Enhanced Aggregation, Cube, Grouping and Rollup</a> for information about these aggregation operators.</p>
<p>Also see the JIRAs:</p>
<ul>
<li><a href=https://issues.apache.org/jira/browse/HIVE-2397>HIVE-2397</a> Support with rollup option for group by</li>
<li><a href=https://issues.apache.org/jira/browse/HIVE-3433>HIVE-3433</a> Implement CUBE and ROLLUP operators in Hive</li>
<li><a href=https://issues.apache.org/jira/browse/HIVE-3471>HIVE-3471</a> Implement grouping sets in Hive</li>
<li><a href=https://issues.apache.org/jira/browse/HIVE-3613>HIVE-3613</a> Implement grouping_id function</li>
</ul>
<p>New in Hive release 0.11.0:</p>
<ul>
<li><a href=https://issues.apache.org/jira/browse/HIVE-3552>HIVE-3552</a> HIVE-3552 performant manner for performing cubes/rollups/grouping sets for a high number of grouping set keys</li>
</ul>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>