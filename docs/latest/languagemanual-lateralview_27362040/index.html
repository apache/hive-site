<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : LanguageManual LateralView</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--languagemanual-lateralview>Apache Hive : LanguageManual LateralView</h1>
<ul>
<li><a href=#lateral-view-syntax>Lateral View Syntax</a></li>
<li><a href=#description>Description</a></li>
<li><a href=#example>Example</a></li>
<li><a href=#multiple-lateral-views>Multiple Lateral Views</a></li>
<li><a href=#outer-lateral-views>Outer Lateral Views</a></li>
</ul>
<h2 id=lateral-view-syntax>Lateral View Syntax</h2>
<pre tabindex=0><code>lateralView: LATERAL VIEW udtf(expression) tableAlias AS columnAlias (',' columnAlias)*
fromClause: FROM baseTable (lateralView)*

</code></pre><h2 id=description>Description</h2>
<p>Lateral view is used in conjunction with user-defined table generating functions such as <code>explode()</code>. As mentioned in <a href=#built-in-table-generating-functions>Built-in Table-Generating Functions</a>, a UDTF generates zero or more output rows for each input row. A lateral view first applies the UDTF to each row of base table and then joins resulting output rows to the input rows to form a virtual table having the supplied table alias.</p>
<p>Version</p>
<p>Prior to Hive 0.6.0, lateral view did not support the predicate push-down optimization. In Hive 0.5.0 and earlier, if you used a WHERE clause your query may not have compiled. A workaround was to add <code>set hive.optimize.ppd=false;</code> before your query. The fix was made in Hive 0.6.0; see <a href=https://issues.apache.org/jira/browse/HIVE-1056>https://issues.apache.org/jira/browse/HIVE-1056</a>: Predicate push down does not work with UDTF&rsquo;s.</p>
<p>Version</p>
<p>From Hive 0.12.0, column aliases can be omitted. In this case, aliases are inherited from field names of StructObjectInspector which is returned from UTDF.</p>
<h2 id=example>Example</h2>
<p>Consider the following base table named <code>pageAds</code>. It has two columns: <code>pageid</code> (name of the page) and <code>adid_list</code> (an array of ads appearing on the page):</p>
<table>
<thead>
<tr>
<th>Column name</th>
<th>Column type</th>
</tr>
</thead>
<tbody>
<tr>
<td>pageid</td>
<td>STRING</td>
</tr>
<tr>
<td>adid_list</td>
<td>Array</td>
</tr>
</tbody>
</table>
<p>An example table with two rows:</p>
<table>
<thead>
<tr>
<th>pageid</th>
<th>adid_list</th>
</tr>
</thead>
<tbody>
<tr>
<td>front_page</td>
<td>[1, 2, 3]</td>
</tr>
<tr>
<td>contact_page</td>
<td>[3, 4, 5]</td>
</tr>
</tbody>
</table>
<p>and the user would like to count the total number of times an ad appears across all pages.</p>
<p>A lateral view with <a href=#explode-->explode()</a> can be used to convert <code>adid_list</code> into separate rows using the query:</p>
<pre tabindex=0><code>SELECT pageid, adid
FROM pageAds LATERAL VIEW explode(adid_list) adTable AS adid;

</code></pre><p>The resulting output will be</p>
<table>
<thead>
<tr>
<th>pageid (string)</th>
<th>adid (int)</th>
</tr>
</thead>
<tbody>
<tr>
<td>&ldquo;front_page&rdquo;</td>
<td>1</td>
</tr>
<tr>
<td>&ldquo;front_page&rdquo;</td>
<td>2</td>
</tr>
<tr>
<td>&ldquo;front_page&rdquo;</td>
<td>3</td>
</tr>
<tr>
<td>&ldquo;contact_page&rdquo;</td>
<td>3</td>
</tr>
<tr>
<td>&ldquo;contact_page&rdquo;</td>
<td>4</td>
</tr>
<tr>
<td>&ldquo;contact_page&rdquo;</td>
<td>5</td>
</tr>
</tbody>
</table>
<p>Then in order to count the number of times a particular ad appears, count/group by can be used:</p>
<pre tabindex=0><code>SELECT adid, count(1)
FROM pageAds LATERAL VIEW explode(adid_list) adTable AS adid
GROUP BY adid;

</code></pre><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>int adid</td>
<td>count(1)</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
</tr>
</tbody>
</table>
<h2 id=multiple-lateral-views>Multiple Lateral Views</h2>
<p>A FROM clause can have multiple LATERAL VIEW clauses. Subsequent LATERAL VIEWS can reference columns from any of the tables appearing to the left of the LATERAL VIEW.</p>
<p>For example, the following could be a valid query:</p>
<pre tabindex=0><code>SELECT * FROM exampleTable
LATERAL VIEW explode(col1) myTable1 AS myCol1
LATERAL VIEW explode(myCol1) myTable2 AS myCol2;

</code></pre><p>LATERAL VIEW clauses are applied in the order that they appear. For example with the following base table:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Array&lt;int> col1</td>
<td>Array&lt;string> col2</td>
</tr>
<tr>
<td>[1, 2]</td>
<td>[a", &ldquo;b&rdquo;, &ldquo;c&rdquo;]</td>
</tr>
<tr>
<td>[3, 4]</td>
<td>[d", &ldquo;e&rdquo;, &ldquo;f&rdquo;]</td>
</tr>
</tbody>
</table>
<p>The query:</p>
<pre tabindex=0><code>SELECT myCol1, col2 FROM baseTable
LATERAL VIEW explode(col1) myTable1 AS myCol1;

</code></pre><p>Will produce:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>int mycol1</td>
<td>Array&lt;string> col2</td>
</tr>
<tr>
<td>1</td>
<td>[a", &ldquo;b&rdquo;, &ldquo;c&rdquo;]</td>
</tr>
<tr>
<td>2</td>
<td>[a", &ldquo;b&rdquo;, &ldquo;c&rdquo;]</td>
</tr>
<tr>
<td>3</td>
<td>[d", &ldquo;e&rdquo;, &ldquo;f&rdquo;]</td>
</tr>
<tr>
<td>4</td>
<td>[d", &ldquo;e&rdquo;, &ldquo;f&rdquo;]</td>
</tr>
</tbody>
</table>
<p>A query that adds an additional LATERAL VIEW:</p>
<pre tabindex=0><code>SELECT myCol1, myCol2 FROM baseTable
LATERAL VIEW explode(col1) myTable1 AS myCol1
LATERAL VIEW explode(col2) myTable2 AS myCol2;

</code></pre><p>Will produce:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>int myCol1</td>
<td>string myCol2</td>
</tr>
<tr>
<td>1</td>
<td>&ldquo;a&rdquo;</td>
</tr>
<tr>
<td>1</td>
<td>&ldquo;b&rdquo;</td>
</tr>
<tr>
<td>1</td>
<td>&ldquo;c&rdquo;</td>
</tr>
<tr>
<td>2</td>
<td>&ldquo;a&rdquo;</td>
</tr>
<tr>
<td>2</td>
<td>&ldquo;b&rdquo;</td>
</tr>
<tr>
<td>2</td>
<td>&ldquo;c&rdquo;</td>
</tr>
<tr>
<td>3</td>
<td>&ldquo;d&rdquo;</td>
</tr>
<tr>
<td>3</td>
<td>&ldquo;e&rdquo;</td>
</tr>
<tr>
<td>3</td>
<td>&ldquo;f&rdquo;</td>
</tr>
<tr>
<td>4</td>
<td>&ldquo;d&rdquo;</td>
</tr>
<tr>
<td>4</td>
<td>&ldquo;e&rdquo;</td>
</tr>
<tr>
<td>4</td>
<td>&ldquo;f&rdquo;</td>
</tr>
</tbody>
</table>
<h2 id=outer-lateral-views>Outer Lateral Views</h2>
<p>Version</p>
<p>Introduced in Hive version 0.12.0</p>
<p>The user can specify the optional <code>OUTER</code> keyword to generate rows even when a <code>LATERAL VIEW</code> usually would not generate a row. This happens when the UDTF used does not generate any rows which happens easily with <code>explode</code> when the column to explode is empty. In this case the source row would never appear in the results. <code>OUTER</code> can be used to prevent that and rows will be generated with <code>NULL</code> values in the columns coming from the UDTF.</p>
<p>For example, the following query returns an empty result:</p>
<pre tabindex=0><code>SELEC * FROM src LATERAL VIEW explode(array()) C AS a limit 10;

</code></pre><p>But with the <code>OUTER</code> keyword</p>
<pre tabindex=0><code>SELECT * FROM src LATERAL VIEW OUTER explode(array()) C AS a limit 10;

</code></pre><p>it will produce:</p>
<p>238 val_238 NULL<br>
86 val_86 NULL<br>
311 val_311 NULL<br>
27 val_27 NULL<br>
165 val_165 NULL<br>
409 val_409 NULL<br>
255 val_255 NULL<br>
278 val_278 NULL<br>
98 val_98 NULL<br>
&mldr;</p>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>