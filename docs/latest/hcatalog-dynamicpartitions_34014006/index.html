<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : HCatalog DynamicPartitions</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--hcatalog-dynamicpartitions>Apache Hive : HCatalog DynamicPartitions</h1>
<h1 id=dynamic-partitioning>Dynamic Partitioning</h1>
<ul>
<li><a href=#dynamic-partitioning>Dynamic Partitioning</a>
<ul>
<li><a href=#overview>Overview</a>
<ul>
<li><a href=#external-tables>External Tables</a></li>
<li><a href=#hive-dynamic-partitions>Hive Dynamic Partitions</a></li>
</ul>
</li>
<li><a href=#usage-with-pig>Usage with Pig</a></li>
<li><a href=#usage-from-mapreduce>Usage from MapReduce</a></li>
</ul>
</li>
</ul>
<h2 id=overview>Overview</h2>
<p>When writing data in HCatalog it is possible to write all records to a single partition. In this case the partition column(s) need not be in the output data.</p>
<p>The following Pig script illustrates this:</p>
<pre tabindex=0><code>A = load 'raw' using HCatLoader(); 
... 
split Z into for_us if region='us', for_eu if region='eu', for_asia if region='asia'; 
store for_us into 'processed' using HCatStorer(&quot;ds=20110110, region=us&quot;); 
store for_eu into 'processed' using HCatStorer(&quot;ds=20110110, region=eu&quot;); 
store for_asia into 'processed' using HCatStorer(&quot;ds=20110110, region=asia&quot;); 

</code></pre><p>In cases where you want to write data to multiple partitions simultaneously, this can be done by placing partition columns in the data and not specifying partition values when storing the data.</p>
<pre tabindex=0><code>A = load 'raw' using HCatLoader(); 
... 
store Z into 'processed' using HCatStorer(); 

</code></pre><p>The way dynamic partitioning works is that HCatalog locates partition columns in the data passed to it and uses the data in these columns to split the rows across multiple partitions. (The data passed to HCatalog <strong>must</strong> have a schema that matches the schema of the destination table and hence should always contain partition columns.) It is important to note that partition columns can’t contain null values or the whole process will fail.</p>
<p>It is also important to note that all partitions created during a single run are part of one transaction; therefore if any part of the process fails, none of the partitions will be added to the table.</p>
<h3 id=external-tables>External Tables</h3>
<p>Version</p>
<p>This section describes changes that occurred in HCatalog 0.5, 0.12, and 0.13 for dynamic partitions of external tables.</p>
<p>Starting in HCatalog 0.5, dynamic partitioning on external tables was broken (<a href=https://issues.apache.org/jira/browse/HCATALOG-500>HCATALOG-500</a>). This issue was fixed in Hive 0.12.0 by creating dynamic partitions of external tables in locations based on metadata rather than user specifications (<a href=https://issues.apache.org/jira/browse/HIVE-5011>HIVE-5011</a>). Starting in Hive 0.13.0, users are able to customize the locations by specifying a path pattern in the job configuration property hcat.dynamic.partitioning.custom.pattern (<a href=https://issues.apache.org/jira/browse/HIVE-6109>HIVE-6109</a>). Static partitions for external tables can have user-specified locations in all Hive releases.</p>
<p>For example, in Hive 0.12.0 if a table named user_logs is partitioned by (year, month, day, hour, minute, country) and stored at external location &ldquo;hdfs://hcat/data/user_logs&rdquo;, then the locations of its dynamic partitions have the standard Hive format which includes keys as well as values, such as:</p>
<ul>
<li>hdfs://hcat/data/user_logs/year=2013/month=12/day=21/hour=06/minute=10/country=US</li>
</ul>
<p>In Hive 0.13.0 and later, hcat.dynamic.partitioning.custom.pattern can be configured to a custom path pattern. For example, the pattern &ldquo;${year}/${month}/${day}/${hour}/${minute}/${country}&rdquo; omits keys from the path:</p>
<ul>
<li>hdfs://hcat/data/user_logs/2013/12/21/06/10/US</li>
</ul>
<p>Each dynamic partition column must be present in the custom location path in the format ${column_name}, and the custom location path must consist of all dynamic partition columns. Other valid custom path strings include:</p>
<ul>
<li>data/${year}/${month}/${day}/${country}</li>
<li>${year}­‐${month}­‐${day}/country=${country}</li>
<li>output/yr=${year}/mon=${month}/day=${day}/geo=${country}</li>
</ul>
<p>See <a href=https://hive.apache.org/docs/latest/hcatalog-configuration-properties_39622369/>HCatalog Configuration Properties</a> for another example. Also see the <a href=https://issues.apache.org/jira/secure/attachment/12622686/HIVE-6109.pdf>PDF attachment to HIVE-6019</a> for details of the implementation.</p>
<h3 id=hive-dynamic-partitions>Hive Dynamic Partitions</h3>
<p>Information about Hive dynamic partitions is available here:</p>
<ul>
<li><a href=https://hive.apache.org/docs/latest/dynamicpartitions_27823715/>Design Document for Dynamic Partitions</a>
<ul>
<li><a href=https://issues.apache.org/jira/secure/attachment/12437909/dp_design.txt>Original design doc</a></li>
<li><a href=https://issues.apache.org/jira/browse/HIVE-936>HIVE-936</a></li>
</ul>
</li>
<li><a href=#tutorial:-dynamic-partition-insert>Tutorial: Dynamic-Partition Insert</a></li>
<li><a href=#hive-dml:-dynamic-partition-inserts>Hive DML: Dynamic Partition Inserts</a></li>
</ul>
<h2 id=usage-with-pig>Usage with Pig</h2>
<p>Usage from Pig is very simple! Instead of specifying all keys as one normally does for a store, users can specify the keys that are actually needed. HCatOutputFormat will trigger on dynamic partitioning usage if necessary (if a key value is not specified) and will inspect the data to write it out appropriately.</p>
<p>So this statement&mldr;</p>
<pre tabindex=0><code>store A into 'mytable' using HCatStorer(&quot;a=1, b=1&quot;);

</code></pre><p>&mldr;is equivalent to any of the following statements, if the data has only values where a=1 and b=1:</p>
<pre tabindex=0><code>store A into 'mytable' using HCatStorer();

</code></pre><pre tabindex=0><code>store A into 'mytable' using HCatStorer(&quot;a=1&quot;);

</code></pre><pre tabindex=0><code>store A into 'mytable' using HCatStorer(&quot;b=1&quot;);

</code></pre><p>On the other hand, if there is data that spans more than one partition, then HCatOutputFormat will automatically figure out how to spray the data appropriately.</p>
<p>For example, let&rsquo;s say a=1 for all values across our dataset and b takes the values 1 and 2. Then the following statement&mldr;</p>
<pre tabindex=0><code>store A into 'mytable' using HCatStorer();

</code></pre><p>&mldr;is equivalent to either of these statements:</p>
<pre tabindex=0><code>store A into 'mytable' using HCatStorer(&quot;a=1&quot;);

</code></pre><pre tabindex=0><code>split A into A1 if b='1', A2 if b='2';
store A1 into 'mytable' using HCatStorer(&quot;a=1, b=1&quot;);
store A2 into 'mytable' using HCatStorer(&quot;a=1, b=2&quot;);

</code></pre><h2 id=usage-from-mapreduce>Usage from MapReduce</h2>
<p>As with Pig, the only change in dynamic partitioning that a MapReduce programmer sees is that they don&rsquo;t have to specify all the partition key/value combinations.</p>
<p>A current code example for writing out a specific partition for (a=1, b=1) would go something like this:</p>
<pre tabindex=0><code>Map&lt;String, String&gt; partitionValues = new HashMap&lt;String, String&gt;();
partitionValues.put(&quot;a&quot;, &quot;1&quot;);
partitionValues.put(&quot;b&quot;, &quot;1&quot;);
HCatTableInfo info = HCatTableInfo.getOutputTableInfo(dbName, tblName, partitionValues);
HCatOutputFormat.setOutput(job, info);

</code></pre><p>And to write to multiple partitions, separate jobs will have to be kicked off with each of the above.</p>
<p>With dynamic partitioning, we simply specify only as many keys as we know about, or as required. It will figure out the rest of the keys by itself and spray out necessary partitions, being able to create multiple partitions with a single job.</p>
<p> </p>
<p><strong>Navigation Links</strong>
Previous: <a href=https://hive.apache.org/docs/latest/hcatalog-storageformats_34013997/>Storage Formats</a><br>
Next: <a href=https://hive.apache.org/docs/latest/hcatalog-notification_34014558/>Notification</a></p>
<p>Hive design document: <a href=https://hive.apache.org/docs/latest/dynamicpartitions_27823715/>Dynamic Partitions</a><br>
Hive tutorial: <a href=#dynamic-partition-insert>Dynamic-Partition Insert</a><br>
Hive DML: <a href=#dynamic-partition-inserts>Dynamic Partition Inserts</a></p>
<p>General: <a href=https://hive.apache.org/docs/latest/hcatalog_33299065/>HCatalog Manual</a> – <a href=https://hive.apache.org/docs/latest/webhcat_33299069/>WebHCat Manual</a> – <a href=https://hive.apache.org/docs/latest/home_27362069/>Hive Wiki Home</a> – <a href=http://hive.apache.org/>Hive Project Site</a></p>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>