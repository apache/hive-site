<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : Hive PTest2 Infrastructure</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--hive-ptest2-infrastructure>Apache Hive : Hive PTest2 Infrastructure</h1>
<h2 id=background>Background</h2>
<p>Hive build jobs include <a href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Hive PreCommit Testing</a> and scheduled builds of various branches with various flags.  They are run on the Hive PTest2 Infrastructure, which is an EC2 cluster currently sponsored by Cloudera.  The Hive PTest2 Infra runs each build sequentially, but splits the testing across all the resources of the cluster to achieve much higher throughput.</p>
<h2 id=location>Location</h2>
<p>The infrastructure master is at ec2-174-129-184-35.compute-1.amazonaws.com.  Committers can be granted access to this host by request, see <a href=https://issues.apache.org/jira/browse/HIVE-4739>HIVE-4739</a>.</p>
<h2 id=processes>Processes</h2>
<p>The infrastructure master hosts two processes:</p>
<ol>
<li>Jenkins: <a href=http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/>http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/</a>
<ul>
<li>This is the admin for Hive builds.  The dashboard shows the state of the build queue, test results of past builds, etc.</li>
<li>Builds are submitted either manually in the dashboard UI, automatically by patch upload (see <a href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Hive PreCommit Testing</a>), or by Jenkins schedule (branch builds).</li>
</ul>
</li>
<li>Hive PTest2 WebServer
<ul>
<li>Exposes a REST API to take test requests from the Jenkins builds.  Each request specifies a profile property-file, which contains a set of properties such as what branch to build and what tests to run.</li>
<li>On a test request:
<ul>
<li>Creates EC2 slaves, which are spot-instances.</li>
<li>Reads the specified property-file and compiles Hive using it.</li>
<li>Distributes the compiled artifacts across the EC2 slaves, makes SSH calls to run the tests remotely in parallel, and gathers the results.</li>
</ul>
</li>
</ul>
<ol>
<li>
<ul>
<li>If no further test request comes in 30 minutes, the slaves are shutdown.</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id=jenkins-configurationdebug>Jenkins Configuration/Debug</h3>
<ul>
<li>Jenkins logs:  /var/log/jenkins/jenkins.log</li>
<li>Jenkins config: /etc/sysconfig/jenkins</li>
<li>Jenkins home: /var/lib/jenkins  (job info is located at /var/lib/jenkins/jobs)</li>
</ul>
<h3 id=hive-ptest2-webserver-configurationdebug>Hive PTest2 WebServer Configuration/Debug</h3>
<ul>
<li>Test Logs: <a href=http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/>http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/</a>  (redirects to /data/hive-ptest/logs/)</li>
<li>Profile properties files: /usr/local/hiveptest/etc/public/</li>
<li>Webservice logs: /home/hiveptest/apache-tomcat-7.0.41/logs/</li>
<li>Working Directory: /data/hive-ptest/working/ (where libs, source, etc. are stored)</li>
<li>Scripts: /usr/local/hiveptest/bin/</li>
<li>Relevant JIRAs: <a href=https://issues.apache.org/jira/browse/HIVE-4675>HIVE-4675</a> and <a href=https://issues.apache.org/jira/browse/HIVE-4739>HIVE-4739</a></li>
</ul>
<h2 id=faq>FAQ:</h2>
<h3 id=how-do-i-restart-jenkins>How do I restart Jenkins?</h3>
<p>sudo service jenkins restart</p>
<h3 id=how-do-i-setup-a-new-branch-build>How do I setup a new branch build?</h3>
<ol>
<li>Log into build machine, go to /usr/local/hiveptest/etc/public, create a new profile properties in the form {newprofile.properties} , where &ldquo;newprofile&rdquo; is the name of the new profile.  Easiest way is to copy an existing one, for example &ldquo;trunk-mr2.properties&rdquo; which are used to run pre-commit tests.</li>
<li>In the new profile property, set the &ldquo;repository&rdquo; property in the new profile to point to the new branch, and &ldquo;repository-name&rdquo; property to any unique value (will be used as the directory name of the checked-out code).  Set any other properties accordingly, as they will be invoked by the jenkins build.</li>
<li>In Jenkins, create a new job by copying template from existing job.</li>
<li>In new Jenkins job, go in the build config modify the profile argument in the Hive PTest2 WebServer call (it will be like: &ldquo;java &mldr; org.apache.hive.ptest.api.client.PTestClient &ndash;profile trunk-mr2&rdquo;) to point to the new profile  ie, (&ldquo;java &mldr;–profile newprofile).</li>
</ol>
<h3 id=how-can-i-read-or-make-changes-to-hive-ptest2-infra-code>How can I read or make changes to Hive PTest2 Infra code?</h3>
<p>Code is located in the Hive git repo.  It is under /hive/testutils/ptest2.  As the Hive PTest2 WebServer is a running process, if changes are made, it needs to be restarted.</p>
<h3 id=how-do-i-stop-start-restart-the-hive-ptest2-webserver-or-have-it-use-the-latest-test-infra-code>How do I stop, start, restart the Hive PTest2 WebServer, or have it use the latest test infra code?</h3>
<pre tabindex=0><code>$ sudo /usr/local/hiveptest/bin/stop-server.sh 
$ sudo /usr/local/hiveptest/bin/start-server.sh 
$ sudo /usr/local/hiveptest/bin/restart-server.sh 
$ sudo /usr/local/hiveptest/bin/update.sh 
</code></pre>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>