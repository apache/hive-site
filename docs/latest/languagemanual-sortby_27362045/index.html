<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : LanguageManual SortBy</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--languagemanual-sortby>Apache Hive : LanguageManual SortBy</h1>
<ul>
<li><a href=#order-sort-cluster-and-distribute-by>Order, Sort, Cluster, and Distribute By</a>
<ul>
<li><a href=#syntax-of-order-by>Syntax of Order By</a></li>
<li><a href=#syntax-of-sort-by>Syntax of Sort By</a>
<ul>
<li><a href=#difference-between-sort-by-and-order-by>Difference between Sort By and Order By</a></li>
<li><a href=#setting-types-for-sort-by>Setting Types for Sort By</a></li>
</ul>
</li>
<li><a href=#syntax-of-cluster-by-and-distribute-by>Syntax of Cluster By and Distribute By</a></li>
</ul>
</li>
</ul>
<h1 id=order-sort-cluster-and-distribute-by>Order, Sort, Cluster, and Distribute By</h1>
<p>This describes the syntax of SELECT clauses ORDER BY, SORT BY, CLUSTER BY, and DISTRIBUTE BY.  See <a href=#select-syntax>Select Syntax</a> for general information.</p>
<h2 id=syntax-of-order-by>Syntax of Order By</h2>
<p>The <em>ORDER BY</em> syntax in Hive QL is similar to the syntax of <em>ORDER BY</em> in SQL language.</p>
<pre tabindex=0><code>colOrder: ( ASC | DESC )
colNullOrder: (NULLS FIRST | NULLS LAST)           -- (Note: Available in Hive 2.1.0 and later)
orderBy: ORDER BY colName colOrder? colNullOrder? (',' colName colOrder? colNullOrder?)*
query: SELECT expression (',' expression)* FROM src orderBy

</code></pre><p>There are some limitations in the &ldquo;order by&rdquo; clause. In the strict mode (i.e., <a href=#hive-mapred-mode>hive.mapred.mode</a>=strict), the order by clause has to be followed by a &ldquo;limit&rdquo; clause. The limit clause is not necessary if you set hive.mapred.mode to nonstrict. The reason is that in order to impose total order of all results, there has to be one reducer to sort the final output. If the number of rows in the output is too large, the single reducer could take a very long time to finish.</p>
<p>Note that columns are specified by name, not by position number. However in <a href=https://issues.apache.org/jira/browse/HIVE-581>Hive 0.11.0</a> and later, columns can be specified by position when configured as follows:</p>
<ul>
<li>For Hive 0.11.0 through 2.1.x, set <a href=https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.groupby.orderby.position.alias>hive.groupby.orderby.position.alias</a> to true (the default is false).</li>
<li>For Hive 2.2.0 and later, <a href=https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.orderby.position.alias>hive.orderby.position.alias</a> is true by default.</li>
</ul>
<p>The default sorting order is ascending (ASC).</p>
<p>In <a href=https://issues.apache.org/jira/browse/HIVE-12994>Hive 2.1.0</a> and later, specifying the null sorting order for each of the columns in the &ldquo;order by&rdquo; clause is supported. The default null sorting order for ASC order is NULLS FIRST, while the default null sorting order for DESC order is NULLS LAST.</p>
<p>In <a href=https://issues.apache.org/jira/browse/HIVE-6348>Hive 3.0.0</a> and later, order by without limit in <a href=https://hive.apache.org/docs/latest/languagemanual-subqueries_27362044/>subqueries</a> and <a href=#views>views</a> will be removed by the optimizer. To disable it, set <a href=#hive-remove-orderby-in-subquery>hive.remove.orderby.in.subquery</a> to false.</p>
<h2 id=syntax-of-sort-by>Syntax of Sort By</h2>
<p>The <em>SORT BY</em> syntax is similar to the syntax of <em>ORDER BY</em> in SQL language.</p>
<pre tabindex=0><code>colOrder: ( ASC | DESC )
sortBy: SORT BY colName colOrder? (',' colName colOrder?)*
query: SELECT expression (',' expression)* FROM src sortBy

</code></pre><p>Hive uses the columns in <em>SORT BY</em> to sort the rows before feeding the rows to a reducer. The sort order will be dependent on the column types. If the column is of numeric type, then the sort order is also in numeric order. If the column is of string type, then the sort order will be lexicographical order.</p>
<p>In <a href=https://issues.apache.org/jira/browse/HIVE-6348>Hive 3.0.0</a> and later, sort by without limit in <a href=https://hive.apache.org/docs/latest/languagemanual-subqueries_27362044/>subqueries</a> and <a href=#views>views</a> will be removed by the optimizer. To disable it, set <a href=#hive-remove-orderby-in-subquery>hive.remove.orderby.in.subquery</a> to false.</p>
<h3 id=difference-between-sort-by-and-order-by>Difference between Sort By and Order By</h3>
<p>Hive supports <em>SORT BY</em> which sorts the data per reducer. The difference between &ldquo;order by&rdquo; and &ldquo;sort by&rdquo; is that the former guarantees total order in the output while the latter only guarantees ordering of the rows within a reducer. If there are more than one reducer, &ldquo;sort by&rdquo; may give partially ordered final results.</p>
<p>Note: It may be confusing as to the difference between SORT BY alone of a single column and CLUSTER BY. The difference is that CLUSTER BY partitions by the field and SORT BY if there are multiple reducers partitions randomly in order to distribute data (and load) uniformly across the reducers.</p>
<p>Basically, the data in each reducer will be sorted according to the order that the user specified. The following example shows</p>
<pre tabindex=0><code>SELECT key, value FROM src SORT BY key ASC, value DESC

</code></pre><p>The query had 2 reducers, and the output of each is:</p>
<pre tabindex=0><code>0   5
0   3
3   6
9   1

</code></pre><pre tabindex=0><code>0   4
0   3
1   1
2   5

</code></pre><h3 id=setting-types-for-sort-by>Setting Types for Sort By</h3>
<p>After a transform, variable types are generally considered to be strings, meaning that numeric data will be sorted lexicographically. To overcome this, a second SELECT statement with casts can be used before using SORT BY.</p>
<pre tabindex=0><code>FROM (FROM (FROM src
            SELECT TRANSFORM(value)
            USING 'mapper'
            AS value, count) mapped
      SELECT cast(value as double) AS value, cast(count as int) AS count
      SORT BY value, count) sorted
SELECT TRANSFORM(value, count)
USING 'reducer'
AS whatever

</code></pre><h2 id=syntax-of-cluster-by-and-distribute-by>Syntax of Cluster By and Distribute By</h2>
<p><em>Cluster By</em> and <em>Distribute By</em> are used mainly with the <a href=https://hive.apache.org/docs/latest/languagemanual-transform_27362047/>Transform/Map-Reduce Scripts</a>. But, it is sometimes useful in SELECT statements if there is a need to partition and sort the output of a query for subsequent queries.</p>
<p><em>Cluster By</em> is a short-cut for both <em>Distribute By</em> and <em>Sort By</em>.</p>
<p>Hive uses the columns in <em>Distribute By</em> to distribute the rows among reducers. All rows with the same <em>Distribute By</em> columns will go to the same reducer. However, <em>Distribute By</em> does not guarantee clustering or sorting properties on the distributed keys.</p>
<p>For example, we are <em>Distributing By x</em> on the following 5 rows to 2 reducer:</p>
<pre tabindex=0><code>x1
x2
x4
x3
x1

</code></pre><p>Reducer 1 got</p>
<pre tabindex=0><code>x1
x2
x1

</code></pre><p>Reducer 2 got</p>
<pre tabindex=0><code>x4
x3

</code></pre><p>Note that all rows with the same key x1 is guaranteed to be distributed to the same reducer (reducer 1 in this case), but they are not guaranteed to be clustered in adjacent positions.</p>
<p>In contrast, if we use <em>Cluster By x</em>, the two reducers will further sort rows on x:</p>
<p>Reducer 1 got</p>
<pre tabindex=0><code>x1
x1
x2

</code></pre><p>Reducer 2 got</p>
<pre tabindex=0><code>x3
x4

</code></pre><p>Instead of specifying <em>Cluster By</em>, the user can specify <em>Distribute By</em> and <em>Sort By</em>, so the partition columns and sort columns can be different. The usual case is that the partition columns are a prefix of sort columns, but that is not required.</p>
<pre tabindex=0><code>SELECT col1, col2 FROM t1 CLUSTER BY col1

</code></pre><pre tabindex=0><code>SELECT col1, col2 FROM t1 DISTRIBUTE BY col1

SELECT col1, col2 FROM t1 DISTRIBUTE BY col1 SORT BY col1 ASC, col2 DESC

</code></pre><pre tabindex=0><code>  FROM (
    FROM pv_users
    MAP ( pv_users.userid, pv_users.date )
    USING 'map_script'
    AS c1, c2, c3
    DISTRIBUTE BY c2
    SORT BY c2, c1) map_output
  INSERT OVERWRITE TABLE pv_users_reduced
    REDUCE ( map_output.c1, map_output.c2, map_output.c3 )
    USING 'reduce_script'
    AS date, count;

</code></pre><p>Note that columns are specified by name, not by position number. However in <a href=https://issues.apache.org/jira/browse/HIVE-28572>HIVE-28572</a> and later, columns can be specified by position when configured as follows:</p>
<ul>
<li>set <a href=https://hive.apache.org/docs/latest/configuration-properties_27842758/#hiveorderbypositionalias>hive.orderby.position.alias</a>=true;</li>
<li>set <a href=https://hive.apache.org/docs/latest/configuration-properties_27842758/#hivecboenable>hive.cbo.enable</a>=true;</li>
</ul>
<p>When any of the above conditions are not met, no distribution is performed.</p>
<p>In the following example we distribute by the 3rd and the 1st column (birthdate, age):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>set</span> hive.orderby.<span style=color:#66d9ef>position</span>.<span style=color:#66d9ef>alias</span><span style=color:#f92672>=</span><span style=color:#66d9ef>true</span>;
<span style=color:#66d9ef>set</span> hive.cbo.enable<span style=color:#f92672>=</span><span style=color:#66d9ef>true</span>;
<span style=color:#66d9ef>SELECT</span> age, name, birthdate <span style=color:#66d9ef>FROM</span> author DISTRIBUTE <span style=color:#66d9ef>BY</span> <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>;
</code></pre></div>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>