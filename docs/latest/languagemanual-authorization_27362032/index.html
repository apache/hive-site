<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : LanguageManual Authorization</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--languagemanual-authorization>Apache Hive : LanguageManual Authorization</h1>
<p>Hive Authorization</p>
<ul>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#hive-authorization-options>Hive Authorization Options</a>
<ul>
<li><a href=#use-cases>Use Cases</a></li>
<li><a href=#overview-of-authorization-modes>Overview of Authorization Modes</a>
<ul>
<li><a href=#1-storage-based-authorization-in-the-metastore-server>1 Storage Based Authorization in the Metastore Server</a>
<ul>
<li><a href=#fall-back-authorizer>Fall Back Authorizer</a></li>
</ul>
</li>
<li><a href=#2-sql-standards-based-authorization-in-hiveserver2>2 SQL Standards Based Authorization in HiveServer2</a></li>
<li><a href=#3-authorization-using-apache-ranger--sentry>3 Authorization using Apache Ranger & Sentry</a></li>
<li><a href=#4-old-default-hive-authorization-legacy-mode>4 Old default Hive Authorization (Legacy Mode)</a></li>
</ul>
</li>
<li><a href=#addressing-authorization-needs-of-multiple-use-cases>Addressing Authorization Needs of Multiple Use Cases</a></li>
</ul>
</li>
<li><a href=#explain-authorization>Explain Authorization</a></li>
<li><a href=#more-information>More Information</a></li>
</ul>
<h2 id=introduction>Introduction</h2>
<p>Note that this documentation is referring to Authorization which is verifying if a user has permission to perform a certain action, and not about Authentication (verifying the identity of the user). Strong authentication for tools like the <a href=https://hive.apache.org/docs/latest/languagemanual-cli_27362033/>Hive command line</a> is provided through the use of Kerberos. There are additional authentication options for users of <a href=https://hive.apache.org/docs/latest/setting-up-hiveserver2_30758712/>HiveServer2</a>.</p>
<h2 id=hive-authorization-options>Hive Authorization Options</h2>
<p>Three modes of Hive authorization are available to satisfy different use cases.</p>
<h3 id=use-cases>Use Cases</h3>
<p>It is useful to think of authorization in terms of two primary use cases of Hive. </p>
<ol>
<li>Hive as a table storage layer. This is the use case for Hive&rsquo;s <a href=https://hive.apache.org/docs/latest/hcatalog_33299065/>HCatalog</a> API users such as Apache Pig, MapReduce and some Massively Parallel Processing databases (Cloudera Impala, Facebook Presto, Spark SQL etc). In this case, Hive provides a table abstraction and metadata for files on storage (typically HDFS). These users have direct access to HDFS and the metastore server (which provides an API for metadata access). HDFS access is authorized through the use of <a href=http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html>HDFS permissions</a>. Metadata access needs to be authorized using Hive configuration.</li>
<li>Hive as a SQL query engine. This is one of the most common use cases of Hive. This is the &lsquo;Hive view&rsquo; of SQL users and BI tools. This use case has the following two subcategories:
<ol>
<li><a href=#hive-command-line>Hive command line</a> users. These users have direct access to HDFS and the Hive metastore, which makes this use case similar to use case 1. <em>Note, that usage of Hive CLI will be officially <a href=https://issues.apache.org/jira/browse/HIVE-10304>deprecated</a> soon in favor of Beeline.</em></li>
<li>ODBC/JDBC and other HiveServer2 API users (Beeline CLI is an example). These users have all data/metadata access happening through HiveServer2. They don&rsquo;t have direct access to HDFS or the metastore.</li>
</ol>
</li>
</ol>
<h3 id=overview-of-authorization-modes>Overview of Authorization Modes</h3>
<h4 id=1-storage-based-authorization-in-the-metastore-server>1 Storage Based Authorization in the Metastore Server</h4>
<p>In use cases 1 and 2a, the users have direct access to the data. Hive configurations don&rsquo;t control the data access. The HDFS permissions act as one source of truth for the table storage access. By enabling <a href=https://hive.apache.org/docs/latest/storage-based-authorization-in-the-metastore-server_45876440/>Storage Based Authorization in the Metastore Server</a>, you can use this single source for truth and have a consistent data and metadata authorization policy. To control metadata access on the metadata objects such as Databases, Tables and Partitions, it checks if you have permission on corresponding directories on the file system. You can also protect access through HiveServer2 (use case 2b above) by ensuring that the queries run as the end user (<a href=#hive-server2-enable-doas>hive.server2.enable.doAs</a> option should be &ldquo;true&rdquo; in HiveServer2 configuration – this is a default value).</p>
<p>Note, that through the use of <a href=http://hadoop.apache.org/docs/r2.4.0/hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html#ACLs_Access_Control_Lists>HDFS ACL</a> (available in Hadoop 2.4 onwards) you have a lot of flexibility in controlling access to the file system, which in turn provides more flexibility with Storage Based Authorization. This functionality is available as of Hive 0.14 (<a href=https://issues.apache.org/jira/browse/HIVE-7583>HIVE-7583</a>).</p>
<p><strong>While relying on Storage based authorization for restricting access, you still need to enable one of the security options 2 or 3 listed below or use FallbackHiveAuthorizer to protect actions within the HiveServer2 instance.</strong></p>
<h5 id=fall-back-authorizer>Fall Back Authorizer</h5>
<p>You need to use Hive 2.3.4 or 3.1.1 or later to use Fall Back Authorizer.</p>
<pre tabindex=0><code>Admin needs to specify the following entries in
hiveserver2-site.xml:

&lt;property&gt;
  &lt;name&gt;hive.security.authorization.enabled&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hive.security.authorization.manager&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hive.ql.security.authorization.plugin.fallback.FallbackHiveAuthorizerFactory&lt;/value&gt;
&lt;/property&gt;

</code></pre><p>FallbackHiveAuthorizerFactory will do the following to mitigate above mentioned threat:</p>
<ol>
<li>Disallow local file location in sql statements except for admin</li>
<li>Allow &ldquo;set&rdquo; only selected whitelist parameters</li>
<li>Disallow dfs commands except for admin</li>
<li>Disallow &ldquo;ADD JAR&rdquo; statement</li>
<li>Disallow &ldquo;COMPILE&rdquo; statement</li>
<li>Disallow &ldquo;TRANSFORM&rdquo; statement</li>
</ol>
<h4 id=2-sql-standards-based-authorization-in-hiveserver2>2 SQL Standards Based Authorization in HiveServer2</h4>
<p>Although Storage Based Authorization can provide access control at the level of Databases, Tables and Partitions, it can not control authorization at finer levels such as columns and views because the access control provided by the file system is at the level of directory and files. A prerequisite for fine grained access control is a data server that is able to provide just the columns and rows that a user needs (or has) access to. In the case of file system access, the whole file is served to the user. HiveServer2 satisfies this condition, as it has an API that understands rows and columns (through the use of SQL), and is able to serve just the columns and rows that your SQL query asked for.</p>
<p><a href=https://hive.apache.org/docs/latest/sql-standard-based-hive-authorization_40509928/>SQL Standards Based Authorization</a> (introduced in Hive 0.13.0, <a href=https://issues.apache.org/jira/browse/HIVE-5837>HIVE-5837</a>) can be used to enable fine grained access control. It is based on the SQL standard for authorization, and uses the familiar grant/revoke statements to control access. It needs to be enabled through HiveServer2 configuration. </p>
<p>Note that for use case 2a (Hive command line) SQL Standards Based Authorization is disabled. This is because secure access control is not possible for the Hive command line using an access control policy in Hive, because users have direct access to HDFS and so they can easily bypass the SQL standards based authorization checks or even disable it altogether. Disabling this avoids giving a false sense of security to users.</p>
<h4 id=3-authorization-using-apache-ranger--sentry>3 Authorization using Apache Ranger & Sentry</h4>
<p><a href=http://ranger.apache.org>Apache Ranger</a> and <a href=https://sentry.apache.org/>Apache Sentry</a> are apache projects that use plugins provided by hive to do authorization.</p>
<p>The policies are maintained under repositories under those projects.</p>
<p>You also get many advanced features using them. For example, with Ranger you can view and manage policies through web interface, view auditing information, have dynamic row and column level access control (including column masking) based on runtime attributes.</p>
<h4 id=4-old-default-hive-authorization-legacy-mode>4 Old default Hive Authorization (Legacy Mode)</h4>
<p><a href=https://hive.apache.org/docs/latest/45876173/>Hive Old Default Authorization</a> (was default before Hive 2.0.0) is the authorization mode that has been available in earlier versions of Hive. However, this mode does not have a complete access control model, leaving many security gaps unaddressed. For example, the permissions needed to grant privileges for a user are not defined, and any user can grant themselves access to a table or database.</p>
<p>This model is similar to the SQL standards based authorization mode, in that it provides grant/revoke statement-based access control. However, the access control policy is different from SQL standards based authorization, and they are not compatible. Use of this mode is also supported for Hive command line users. However, for reasons mentioned under the discussion of SQL standards based authorization (above), it is not a secure mode of authorization for the Hive command line.</p>
<h3 id=addressing-authorization-needs-of-multiple-use-cases>Addressing Authorization Needs of Multiple Use Cases</h3>
<p>Storage based authorization provides a simple way to address all the use cases described above. However, if you need finer grained access control for SQL users, you can also enable SQL standards based authorization mode in HiveServer2.</p>
<p>That is, you can have storage based authorization enabled for metastore API calls (in the Hive metastore) and have SQL standards based authorization enabled in HiveServer2 at the same time.</p>
<h2 id=explain-authorization>Explain Authorization</h2>
<p>Version 0.14 — EXPLAIN AUTHORIZATION</p>
<p>Starting in <a href=https://issues.apache.org/jira/browse/HIVE-5961>Hive 0.14.0</a>, the HiveQL command <a href=https://hive.apache.org/docs/latest/languagemanual-explain_27362037/>EXPLAIN AUTHORIZATION</a> shows all entities that need to be authorized to execute a query, as well as any authorization failures.</p>
<h2 id=more-information>More Information</h2>
<p>For detailed information about the Hive authorization modes, see:</p>
<ul>
<li><a href=https://hive.apache.org/docs/latest/storage-based-authorization-in-the-metastore-server_45876440/>Storage Based Authorization in the Metastore Server</a> 
<ul>
<li>also see <a href=https://hive.apache.org/docs/latest/hcatalog-authorization_34014782/>HCatalog Authorization</a></li>
</ul>
</li>
<li><a href=https://hive.apache.org/docs/latest/sql-standard-based-hive-authorization_40509928/>SQL Standard Based Hive Authorization</a></li>
<li><a href=https://hive.apache.org/docs/latest/45876173/>Hive deprecated authorization mode / Legacy Mode</a>
<ul>
<li>also see the <a href=https://hive.apache.org/docs/latest/authdev_27362078/>design document</a> and <a href=https://hive.apache.org/docs/latest/security_27362056/>Security</a></li>
</ul>
</li>
</ul>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>