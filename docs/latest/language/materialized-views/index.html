<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : Materialized views</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu class=main-menu>
<nav class="navbar navbar-expand-lg navbar-dark">
<div class=container-fluid>
<div class=navbar-brand-wrapper>
<a href=https://hive.apache.org class=navbar-logo>
<img src=https://hive.apache.org/images/hive.svg width=50 height=30 alt="Apache Hive Logo">
</a>
<a class=navbar-brand href=https://hive.apache.org>Apache Hive</a>
</div>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto">
<li class=nav-item>
<a class=nav-link href=https://hive.apache.org/general/downloads>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=docsDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=docsDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/latest/language/languagemanual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=generalDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=generalDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
<li><a class=dropdown-item href=/general/poweredby/>Powered by</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=devDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=devDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/desingdocs/>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/resources/hivedeveloperfaq>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=communityDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=communityDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/resources/howtocontribute>How To Contribute</a></li>
<li><a class=dropdown-item href=/community/resources/>Resources</a></li>
<li><a class=dropdown-item href=/community/meetings/>Meetings</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li><hr class=dropdown-divider></li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=/community/resources/howtorelease/>How To Release</a></li>
</ul>
</li>
<li class=nav-item>
<a class=nav-link href=https://hive.blog.apache.org/>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=asfDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=asfDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
</ul>
<div class=navbar-search>
<form action=/search method=get class=search-form>
<div class=search-input-group>
<input type=search name=q id=search-query placeholder=Search... class=search-input aria-label=Search>
<button type=submit class=search-button aria-label="Submit search">
<i class="fas fa-search"></i>
</button>
</div>
</form>
</div>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs-container>
<main class="docs-main docs-main-full">
<article class=docs-content>
<nav class=docs-breadcrumb>
<ol>
<li><a href=/><i class="fas fa-home"></i> Home</a></li>
<li><a href=/docs/>Documentation</a></li>
<li class=active>Apache Hive : Materialized views</li>
</ol>
</nav>
<header class=docs-header>
<h1 class=docs-title>Apache Hive : Materialized views</h1>
<div class=docs-meta>
<span class=docs-date>
<i class="fas fa-calendar-alt"></i>
Last updated: December 12, 2024
</span>
</div>
</header>
<div class=docs-toc>
<h4><i class="fas fa-list"></i> Table of Contents</h4>
<nav id=TableOfContents>
<ul>
<li><a href=#apache-hive--materialized-views>Apache Hive : Materialized views</a>
<ul>
<li><a href=#version-information>Version information</a>
<ul>
<li><a href=#objectives>Objectives</a></li>
</ul>
</li>
<li><a href=#management-of-materialized-views-in-hive>Management of materialized views in Hive</a>
<ul>
<li><a href=#materialized-views-creation>Materialized views creation</a></li>
<li><a href=#other-operations-for-materialized-view-management>Other operations for materialized view management</a></li>
</ul>
</li>
<li><a href=#materialized-view-based-query-rewriting>Materialized view-based query rewriting</a>
<ul>
<li><a href=#example-1>Example 1</a></li>
<li><a href=#example-2>Example 2</a></li>
<li><a href=#example-3>Example 3</a></li>
</ul>
</li>
<li><a href=#materialized-view-maintenance>Materialized view maintenance</a></li>
<li><a href=#materialized-view-lifecycle>Materialized view lifecycle</a></li>
<li><a href=#open-issues-jira>Open issues (JIRA)</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div class=docs-article>
<h1 id=apache-hive--materialized-views>Apache Hive : Materialized views</h1>
<p>This page documents the work done for the supporting materialized views in Apache Hive.</p>
<aside class=table-of-contents>
<nav id=TableOfContents>
<ul>
<li><a href=#apache-hive--materialized-views>Apache Hive : Materialized views</a>
<ul>
<li><a href=#version-information>Version information</a>
<ul>
<li><a href=#objectives>Objectives</a></li>
</ul>
</li>
<li><a href=#management-of-materialized-views-in-hive>Management of materialized views in Hive</a>
<ul>
<li><a href=#materialized-views-creation>Materialized views creation</a></li>
<li><a href=#other-operations-for-materialized-view-management>Other operations for materialized view management</a></li>
</ul>
</li>
<li><a href=#materialized-view-based-query-rewriting>Materialized view-based query rewriting</a>
<ul>
<li><a href=#example-1>Example 1</a></li>
<li><a href=#example-2>Example 2</a></li>
<li><a href=#example-3>Example 3</a></li>
</ul>
</li>
<li><a href=#materialized-view-maintenance>Materialized view maintenance</a></li>
<li><a href=#materialized-view-lifecycle>Materialized view lifecycle</a></li>
<li><a href=#open-issues-jira>Open issues (JIRA)</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
<h2 id=version-information>Version information</h2>
<p>Materialized views support is introduced in Hive 3.0.0.</p>
<h3 id=objectives>Objectives</h3>
<p>Traditionally, one of the most powerful techniques used to accelerate query processing in data warehouses is the pre-computation of relevant summaries or materialized views.</p>
<p>The initial implementation introduced in Apache Hive 3.0.0 focuses on introducing materialized views and automatic query rewriting based on those materializations in the project. In particular, materialized views can be stored natively in Hive or in other systems such as Druid using custom storage handlers, and they can seamlessly exploit new exciting Hive features such as LLAP acceleration. Then the optimizer relies in Apache Calcite to automatically produce full and partial rewritings for a large set of query expressions comprising projections, filters, join, and aggregation operations.</p>
<p>In this document, we provide details about materialized view creation and management in Hive, describe the current coverage of the rewriting algorithm with some examples, and explain how Hive controls important aspects of the life cycle of the materialized views such as the freshness of their data.</p>
<h2 id=management-of-materialized-views-in-hive>Management of materialized views in Hive</h2>
<p>In this section, we present the main operations that are currently present in Hive for materialized views management.</p>
<h3 id=materialized-views-creation>Materialized views creation</h3>
<p>The syntax to create a materialized view in Hive is very similar to the <a href=https://hive.apache.org/docs/latest/language/languagemanual-ddl#create-table-as-select-ctas>CTAS statement</a> syntax, supporting common features such as partition columns, custom storage handler, or passing table properties.</p>
<pre tabindex=0><code>CREATE MATERIALIZED VIEW [IF NOT EXISTS] [db_name.]materialized_view_name
  [DISABLE REWRITE]
  [COMMENT materialized_view_comment]
  [PARTITIONED ON (col_name, ...)]
  [CLUSTERED ON (col_name, ...) | DISTRIBUTED ON (col_name, ...) SORTED ON (col_name, ...)]
  [
    [ROW FORMAT row_format]
    [STORED AS file_format]
      | STORED BY 'storage.handler.class.name' [WITH SERDEPROPERTIES (...)]
  ]
  [LOCATION hdfs_path]
  [TBLPROPERTIES (property_name=property_value, ...)]
AS
&lt;query&gt;;
</code></pre><p>When a materialized view is created, its contents will be automatically populated by the results of executing the query in the statement. The materialized view creation statement is atomic, meaning that the materialized view is not seen by other users until all query results are populated.</p>
<p>By default, materialized views are usable for query rewriting by the optimizer, while the <code>DISABLE REWRITE</code> option can be used to alter this behavior at materialized view creation time.</p>
<p>The default values for SerDe and storage format when they are not specified in the materialized view creation statement (they are optional) are specified using the configuration properties <code>hive.materializedview.serde</code> and <code>hive.materializedview.fileformat</code>, respectively.</p>
<p>Materialized views can be stored in external systems, e.g., <a href=https://hive.apache.org/docs/latest/user/druid-integration>Druid</a>, using custom storage handlers. For instance, the following statement creates a materialized view that is stored in Druid:</p>
<p><strong>Example:</strong></p>
<pre tabindex=0><code>CREATE MATERIALIZED VIEW druid_wiki_mv
STORED AS 'org.apache.hadoop.hive.druid.DruidStorageHandler'
AS
SELECT __time, page, user, c_added, c_removed
FROM src;
</code></pre><h3 id=other-operations-for-materialized-view-management>Other operations for materialized view management</h3>
<p>Currently we support the following operations that aid at managing the materialized views in Hive:</p>
<pre tabindex=0><code>-- Drops a materialized view
DROP MATERIALIZED VIEW [db_name.]materialized_view_name;
-- Shows materialized views (with optional filters)
SHOW MATERIALIZED VIEWS [IN database_name] ['identifier_with_wildcards’];
-- Shows information about a specific materialized view
DESCRIBE [EXTENDED | FORMATTED] [db_name.]materialized_view_name;

</code></pre><p>The functionality of these operations will be extended in the future and more operations may be added.</p>
<h2 id=materialized-view-based-query-rewriting>Materialized view-based query rewriting</h2>
<p>Once a materialized view has been created, the optimizer will be able to exploit its definition semantics to automatically rewrite incoming queries using materialized views, and hence, accelerate query execution. </p>
<p>The rewriting algorithm can be enabled and disabled globally using the <code>hive.materializedview.rewriting and hive.materializedview.rewriting.sql</code> configuration properties (default value is <code>true</code>). In addition, users can selectively enable/disable materialized views for rewriting. Recall that, by default, materialized views are enabled for rewriting at creation time. To alter that behavior, the following statement can be used:</p>
<pre tabindex=0><code>ALTER MATERIALIZED VIEW [db_name.]materialized_view_name ENABLE|DISABLE REWRITE;
</code></pre><p>Hive supports two types of rewriting algorithms:</p>
<ul>
<li>Algebraic: this is part of Apache Calcite and it supports queries containing TableScan, Project, Filter, Join, and Aggregate operators. More information about this rewriting coverage can be found <a href=http://calcite.apache.org/docs/materialized_views#rewriting-using-plan-structural-information>here</a>. In the following, we include a few examples that briefly illustrate different rewritings.</li>
</ul>
<h3 id=example-1>Example 1</h3>
<p>Consider the database schema created by the following DDL statements:</p>
<pre tabindex=0><code>CREATE TABLE emps (
  empid INT,
  deptno INT,
  name VARCHAR(256),
  salary FLOAT,
  hire_date TIMESTAMP)
STORED AS ORC
TBLPROPERTIES ('transactional'='true');

CREATE TABLE depts (
  deptno INT,
  deptname VARCHAR(256),
  locationid INT)
STORED AS ORC
TBLPROPERTIES ('transactional'='true');
</code></pre><p>Assume we want to obtain frequently information about employees that were hired in different period granularities after 2016 and their departments. We may create the following materialized view:</p>
<pre tabindex=0><code>CREATE MATERIALIZED VIEW mv1
AS
SELECT empid, deptname, hire_date
FROM emps JOIN depts
  ON (emps.deptno = depts.deptno)
WHERE hire_date &gt;= '2016-01-01';
</code></pre><p>Then, the following query extracting information about employees that were hired in Q1 2018 is issued to Hive:</p>
<pre tabindex=0><code>SELECT empid, deptname
FROM emps
JOIN depts
  ON (emps.deptno = depts.deptno)
WHERE hire_date &gt;= '2018-01-01'
    AND hire_date &lt;= '2018-03-31';
</code></pre><p>Hive will be able to rewrite the incoming query using the materialized view, including a compensation predicate on top of the scan over the materialization. Though the rewriting happens at the algebraic level, to illustrate this example, we include the SQL statement equivalent to the rewriting using the <code>mv</code> used by Hive to answer the incoming query:</p>
<pre tabindex=0><code>SELECT empid, deptname
FROM mv1
WHERE hire_date &gt;= '2018-01-01'
    AND hire_date &lt;= '2018-03-31';
</code></pre><h3 id=example-2>Example 2</h3>
<p>For the second example, consider the star schema based on the <a href=https://www.cs.umb.edu/~poneil/StarSchemaB.PDF>SSB benchmark</a> created by the following DDL statements:</p>
<pre tabindex=0><code>CREATE TABLE `customer`(
  `c_custkey` BIGINT, 
  `c_name` STRING, 
  `c_address` STRING, 
  `c_city` STRING, 
  `c_nation` STRING, 
  `c_region` STRING, 
  `c_phone` STRING, 
  `c_mktsegment` STRING,
  PRIMARY KEY (`c_custkey`) DISABLE RELY)
STORED AS ORC
TBLPROPERTIES ('transactional'='true');

CREATE TABLE `dates`(
  `d_datekey` BIGINT, 
  `d_date` STRING, 
  `d_dayofweek` STRING, 
  `d_month` STRING, 
  `d_year` INT, 
  `d_yearmonthnum` INT, 
  `d_yearmonth` STRING, 
  `d_daynuminweek` INT,
  `d_daynuminmonth` INT,
  `d_daynuminyear` INT,
  `d_monthnuminyear` INT,
  `d_weeknuminyear` INT,
  `d_sellingseason` STRING,
  `d_lastdayinweekfl` INT,
  `d_lastdayinmonthfl` INT,
  `d_holidayfl` INT,
  `d_weekdayfl`INT,
  PRIMARY KEY (`d_datekey`) DISABLE RELY)
STORED AS ORC
TBLPROPERTIES ('transactional'='true');

CREATE TABLE `part`(
  `p_partkey` BIGINT, 
  `p_name` STRING, 
  `p_mfgr` STRING, 
  `p_category` STRING, 
  `p_brand1` STRING, 
  `p_color` STRING, 
  `p_type` STRING, 
  `p_size` INT, 
  `p_container` STRING,
  PRIMARY KEY (`p_partkey`) DISABLE RELY)
STORED AS ORC
TBLPROPERTIES ('transactional'='true');

CREATE TABLE `supplier`(
  `s_suppkey` BIGINT, 
  `s_name` STRING, 
  `s_address` STRING, 
  `s_city` STRING, 
  `s_nation` STRING, 
  `s_region` STRING, 
  `s_phone` STRING,
  PRIMARY KEY (`s_suppkey`) DISABLE RELY)
STORED AS ORC
TBLPROPERTIES ('transactional'='true');

CREATE TABLE `lineorder`(
  `lo_orderkey` BIGINT, 
  `lo_linenumber` int, 
  `lo_custkey` BIGINT not null DISABLE RELY,
  `lo_partkey` BIGINT not null DISABLE RELY,
  `lo_suppkey` BIGINT not null DISABLE RELY,
  `lo_orderdate` BIGINT not null DISABLE RELY,
  `lo_ordpriority` STRING, 
  `lo_shippriority` STRING, 
  `lo_quantity` DOUBLE, 
  `lo_extendedprice` DOUBLE, 
  `lo_ordtotalprice` DOUBLE, 
  `lo_discount` DOUBLE, 
  `lo_revenue` DOUBLE, 
  `lo_supplycost` DOUBLE, 
  `lo_tax` DOUBLE, 
  `lo_commitdate` BIGINT, 
  `lo_shipmode` STRING,
  PRIMARY KEY (`lo_orderkey`) DISABLE RELY,
  CONSTRAINT fk1 FOREIGN KEY (`lo_custkey`) REFERENCES `customer_n1`(`c_custkey`) DISABLE RELY,
  CONSTRAINT fk2 FOREIGN KEY (`lo_orderdate`) REFERENCES `dates_n0`(`d_datekey`) DISABLE RELY,
  CONSTRAINT fk3 FOREIGN KEY (`lo_partkey`) REFERENCES `ssb_part_n0`(`p_partkey`) DISABLE RELY,
  CONSTRAINT fk4 FOREIGN KEY (`lo_suppkey`) REFERENCES `supplier_n0`(`s_suppkey`) DISABLE RELY)
STORED AS ORC
TBLPROPERTIES ('transactional'='true');
</code></pre><p>As you can observe, we declare multiple integrity constraints for the database, using the <code>RELY</code> keyword so they are visible to the optimizer. Now assume we want to create a materialization that denormalizes the database contents (consider <code>dims</code> to be the set of dimensions that we will be querying often):</p>
<pre tabindex=0><code>CREATE MATERIALIZED VIEW mv2
AS
SELECT &lt;dims&gt;,
    lo_revenue,
    lo_extendedprice * lo_discount AS d_price,
    lo_revenue - lo_supplycost
FROM customer, dates, lineorder, part, supplier
WHERE lo_orderdate = d_datekey
    AND lo_partkey = p_partkey
    AND lo_suppkey = s_suppkey
    AND lo_custkey = c_custkey;
</code></pre><p>The materialized view above may accelerate queries that execute joins among the different tables in the database. For instance, consider the following query:</p>
<pre tabindex=0><code>SELECT SUM(lo_extendedprice * lo_discount)
FROM lineorder, dates
WHERE lo_orderdate = d_datekey
  AND d_year = 2013
  AND lo_discount between 1 and 3;
</code></pre><p>Though the query does not use all tables present in the materialized view, it may be answered using the materialized view because the joins in <code>mv2</code> preserve all the rows in the <code>lineorder</code> table (we know this because of the integrity constraints). Hence, the materialized view-based rewriting produced by the algorithm would be the following:</p>
<pre tabindex=0><code>SELECT SUM(d_price)
FROM mv2
WHERE d_year = 2013
  AND lo_discount between 1 and 3;
</code></pre><h3 id=example-3>Example 3</h3>
<p>For the third example, consider the database schema with a single table that stores the edit events produced by a given website:</p>
<pre tabindex=0><code>CREATE TABLE `wiki` (
  `time` TIMESTAMP, 
  `page` STRING, 
  `user` STRING, 
  `characters_added` BIGINT,
  `characters_removed` BIGINT)
STORED AS ORC
TBLPROPERTIES ('transactional'='true');
</code></pre><p>For this example, we will use Druid to store the materialized view. Assume we want to execute queries over the table, however we are not interested on any information about the events at a higher time granularity level than a minute. We may create the following materialized view that rolls up the events by the minute:</p>
<pre tabindex=0><code>CREATE MATERIALIZED VIEW mv3
STORED BY 'org.apache.hadoop.hive.druid.DruidStorageHandler'
AS
SELECT floor(time to minute) as `__time`, page,
    SUM(characters_added) AS c_added,
    SUM(characters_removed) AS c_removed
FROM wiki
GROUP BY floor(time to minute), page;
</code></pre><p>Then, assume we need to answer the following query that extracts the number of characters added per month:</p>
<pre tabindex=0><code>SELECT floor(time to month),
    SUM(characters_added) AS c_added
FROM wiki
GROUP BY floor(time to month);
</code></pre><p>Hive will be able to rewrite the incoming query using <code>mv3</code> by rolling up the data of the materialized view to month granularity and projecting the information needed for the query result:</p>
<pre tabindex=0><code>SELECT floor(time to month),
    SUM(c_added)
FROM mv3
GROUP BY floor(time to month);
</code></pre><ul>
<li>SQL text: The materialized view definition query text is compared to the incoming query text or it&rsquo;s subquery text. It supports all kind of operators and aggregate functions.</li>
</ul>
<h2 id=materialized-view-maintenance>Materialized view maintenance</h2>
<p>When data in the source tables used by a materialized view changes, e.g., new data is inserted or existing data is modified, we will need to refresh the contents of the materialized view to keep it up-to-date with those changes. Currently, the rebuild operation for a materialized view needs to be triggered by the user. In particular, the user should execute the following statement:</p>
<pre tabindex=0><code>ALTER MATERIALIZED VIEW [db_name.]materialized_view_name REBUILD;
</code></pre><p>Hive supports incremental view maintenance, i.e., only refresh data that was affected by the changes in the original source tables. Incremental view maintenance will decrease the rebuild step execution time. In addition, it will preserve LLAP cache for existing data in the materialized view.</p>
<p>By default, Hive will attempt to rebuild a materialized view incrementally, falling back to full rebuild if it is not possible.</p>
<p>Current implementation only supports incremental rebuild when there were <code>INSERT</code> operations over the source tables, while <code>UPDATE</code> and <code>DELETE</code> operations will force a full rebuild of the materialized view.</p>
<p>To execute incremental maintenance, following conditions should be met if there were only <code>INSERT</code> operations over the source tables:</p>
<ul>
<li>The materialized view should only use transactional tables (the source tables must be transactional), either micromanaged or ACID or a storage format that supports snapshots (ex. Iceberg)</li>
<li>If the materialized view definition contains a Group By clause, the materialized view should be stored in an ACID table or a storage format that supports snapshots (ex. Iceberg v2), since it needs to support MERGE operation. For materialized view definitions consisting of Scan-Project-Filter-Join, this restriction does not exist.</li>
<li>If the materialized view definition contains a Group By clause the following aggregate functions are supported: COUNT, SUM, AVG (only if both COUNT and SUM defined for the same column), MIN, MAX</li>
</ul>
<p>If there were <code>UPDATE</code> and <code>DELETE</code> operations over the source tables:</p>
<ul>
<li>The materialized view should only use transactional tables (the source tables must be transactional), either micromanaged or ACID</li>
<li>The materialized view definition must contain a Group By clause and a COUNT(*) function call.</li>
<li>The materialized view should be stored in an ACID table or a storage format that supports snapshots (ex. Iceberg v2), since it needs to support MERGE operation.</li>
<li>The following aggregate functions are supported: COUNT, SUM, AVG (only if both COUNT and SUM defined for the same column)</li>
</ul>
<p>A rebuild operation acquires an exclusive write lock over the materialized view, i.e., for a given materialized view, only one rebuild operation can be executed at a given time.</p>
<h2 id=materialized-view-lifecycle>Materialized view lifecycle</h2>
<p>By default, once a materialized view contents are stale, the materialized view will not be used for automatic query rewriting.</p>
<p>However, in some occasions it may be fine to accept stale data, e.g., if the materialized view uses non-transactional tables and hence we cannot verify whether its contents are outdated, however we still want to use the automatic rewriting. For those occasions, we can combine a rebuild operation run periodically, e.g., every 5minutes, and define the required freshness of the materialized view data using the <code>hive.materializedview.rewriting.time.window</code> configuration parameter, for instance:</p>
<pre tabindex=0><code>SET hive.materializedview.rewriting.time.window=10min;
</code></pre><p>The parameter value can be also overridden by a concrete materialized view just by setting it as a table property when the materialization is created.</p>
<h2 id=open-issues-jira>Open issues (JIRA)</h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Summary</th>
<th>T</th>
<th>Created</th>
<th>Updated</th>
<th>Due</th>
<th>Assignee</th>
<th>Reporter</th>
<th>P</th>
<th>Status</th>
<th>Resolution</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-14494?src=confmacro">HIVE-14494</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-14494?src=confmacro">Add support for BUILD DEFERRED</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-14494?src=confmacro">Improvement</a></td>
<td>Aug 09, 2016</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Ashish Sharma</td>
<td>Jesús Camacho Rodríguez</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-14499?src=confmacro">HIVE-14499</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-14499?src=confmacro">Add HMS metrics for materialized views</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-14499?src=confmacro">Improvement</a></td>
<td>Aug 09, 2016</td>
<td>Feb 27, 2024</td>
<td></td>
<td>John Sherman</td>
<td>Jesús Camacho Rodríguez</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-18621?src=confmacro">HIVE-18621</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-18621?src=confmacro">Replicate materialized views creation metadata with correct database name</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-18621?src=confmacro">Sub-task</a></td>
<td>Feb 05, 2018</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Unassigned</td>
<td>Jesús Camacho Rodríguez</td>
<td>Minor</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-18960?src=confmacro">HIVE-18960</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-18960?src=confmacro">Make Materialized view invalidation cache work with catalogs</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-18960?src=confmacro">Sub-task</a></td>
<td>Mar 14, 2018</td>
<td>Mar 14, 2018</td>
<td></td>
<td>Alan Gates</td>
<td>Alan Gates</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-19114?src=confmacro">HIVE-19114</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-19114?src=confmacro">MV rewriting not being triggered for last query in materialized_view_rewrite_4.q</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-19114?src=confmacro">Bug</a></td>
<td>Apr 05, 2018</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Unassigned</td>
<td>Jesús Camacho Rodríguez</td>
<td>Critical</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-19407?src=confmacro">HIVE-19407</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-19407?src=confmacro">Only support materialized views stored either as ACID or in selected custom storage handlers</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-19407?src=confmacro">Improvement</a></td>
<td>May 03, 2018</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Unassigned</td>
<td>Jesús Camacho Rodríguez</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-20543?src=confmacro">HIVE-20543</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-20543?src=confmacro">Support replication of Materialized views</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-20543?src=confmacro">Sub-task</a></td>
<td>Sep 12, 2018</td>
<td>Aug 21, 2020</td>
<td></td>
<td>Aasha Medhi</td>
<td>Sankar Hariappan</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-20773?src=confmacro">HIVE-20773</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-20773?src=confmacro">Query result cache might contain stale MV data</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-20773?src=confmacro">Bug</a></td>
<td>Oct 18, 2018</td>
<td>Jun 23, 2021</td>
<td></td>
<td>Unassigned</td>
<td>Oliver Draese</td>
<td>Critical</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21133?src=confmacro">HIVE-21133</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21133?src=confmacro">Support views with rewriting enabled useful for debugging</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21133?src=confmacro">Improvement</a></td>
<td>Jan 18, 2019</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Jesús Camacho Rodríguez</td>
<td>Jesús Camacho Rodríguez</td>
<td>Major</td>
<td>Patch Available</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21945?src=confmacro">HIVE-21945</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21945?src=confmacro">Enable sorted dynamic partitioning optimization for materialized views with custom data organization</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21945?src=confmacro">Bug</a></td>
<td>Jul 02, 2019</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Unassigned</td>
<td>Jesús Camacho Rodríguez</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21946?src=confmacro">HIVE-21946</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21946?src=confmacro">Consider data organization of a materialized view in transparent rewriting</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21946?src=confmacro">Bug</a></td>
<td>Jul 02, 2019</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Unassigned</td>
<td>Jesús Camacho Rodríguez</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21953?src=confmacro">HIVE-21953</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21953?src=confmacro">Enable CLUSTERED ON/DISTRIBUTED ON+SORTED ON in incremental rebuild of materialized views</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-21953?src=confmacro">Bug</a></td>
<td>Jul 04, 2019</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Unassigned</td>
<td>Jesús Camacho Rodríguez</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22111?src=confmacro">HIVE-22111</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22111?src=confmacro">Materialized view based on replicated table might not get refreshed</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22111?src=confmacro">Bug</a></td>
<td>Aug 14, 2019</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Unassigned</td>
<td>Peter Vary</td>
<td>Minor</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22253?src=confmacro">HIVE-22253</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22253?src=confmacro">General task tracking improvements for materialized views</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22253?src=confmacro">Task</a></td>
<td>Sep 27, 2019</td>
<td>Jul 20, 2020</td>
<td></td>
<td>Unassigned</td>
<td>Steve Carlin</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22260?src=confmacro">HIVE-22260</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22260?src=confmacro">Materialized view rewriting does not support <code>UNION</code> operator, exact match can work under view</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22260?src=confmacro">Sub-task</a></td>
<td>Sep 27, 2019</td>
<td>Sep 27, 2019</td>
<td></td>
<td>Unassigned</td>
<td>Steve Carlin</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22262?src=confmacro">HIVE-22262</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22262?src=confmacro">Aggregate pushdown through join may generate additional rewriting opportunities</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22262?src=confmacro">Sub-task</a></td>
<td>Sep 27, 2019</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Vineet Garg</td>
<td>Steve Carlin</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22264?src=confmacro">HIVE-22264</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22264?src=confmacro">Degenerate case where mv not being used: computing aggregate on group by field</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22264?src=confmacro">Sub-task</a></td>
<td>Sep 27, 2019</td>
<td>Sep 27, 2019</td>
<td></td>
<td>Unassigned</td>
<td>Steve Carlin</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22265?src=confmacro">HIVE-22265</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22265?src=confmacro">Ordinals in view are not being picked up in materialized view</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22265?src=confmacro">Sub-task</a></td>
<td>Sep 27, 2019</td>
<td>Feb 11, 2020</td>
<td></td>
<td>Unassigned</td>
<td>Steve Carlin</td>
<td>Critical</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22921?src=confmacro">HIVE-22921</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22921?src=confmacro">materialized_view_partitioned_3.q relies on hive.optimize.sort.dynamic.partition property</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-22921?src=confmacro">Test</a></td>
<td>Feb 21, 2020</td>
<td>Feb 27, 2024</td>
<td></td>
<td>Vineet Garg</td>
<td>Jesús Camacho Rodríguez</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
<tr>
<td><a href="https://issues.apache.org/jira/browse/HIVE-24335?src=confmacro">HIVE-24335</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-24335?src=confmacro">RelOptMaterialization creates LogicalProject on top of HiveTableScan</a></td>
<td><a href="https://issues.apache.org/jira/browse/HIVE-24335?src=confmacro">Bug</a></td>
<td>Oct 30, 2020</td>
<td>Apr 04, 2024</td>
<td></td>
<td>Krisztian Kasa</td>
<td>Krisztian Kasa</td>
<td>Major</td>
<td>Open</td>
<td>Unresolved</td>
</tr>
</tbody>
</table>
<p>Showing 20 out of
<a href="https://issues.apache.org/jira/secure/IssueNavigator.jspa?reset=true&jqlQuery=project+%3D+Hive+AND+component+%3D+%22Materialized+views%22++and+resolution+%3D+Unresolved+ORDER+BY+key+ASC++&src=confmacro">24 issues</a></p>
</div>
<footer class=docs-footer>
<div class=docs-feedback>
<h4><i class="fas fa-comment"></i> Feedback</h4>
<p>Was this page helpful? Let us know how we can improve.</p>
<div class=docs-feedback-buttons>
<button class="btn btn-feedback btn-positive">
<i class="fas fa-thumbs-up"></i> Yes
</button>
<button class="btn btn-feedback btn-negative">
<i class="fas fa-thumbs-down"></i> No
</button>
</div>
</div>
<div class=docs-edit>
<a href=https://github.com/apache/hive-site/edit/main/content/docs/latest/language/materialized-views.md class="btn btn-outline">
<i class="fab fa-github"></i> Edit this page on GitHub
</a>
</div>
</footer>
</article>
<aside class=docs-toc-sidebar>
<div class=docs-toc-sticky>
<h4><i class="fas fa-list"></i> On this page</h4>
<nav id=TableOfContents>
<ul>
<li><a href=#apache-hive--materialized-views>Apache Hive : Materialized views</a>
<ul>
<li><a href=#version-information>Version information</a>
<ul>
<li><a href=#objectives>Objectives</a></li>
</ul>
</li>
<li><a href=#management-of-materialized-views-in-hive>Management of materialized views in Hive</a>
<ul>
<li><a href=#materialized-views-creation>Materialized views creation</a></li>
<li><a href=#other-operations-for-materialized-view-management>Other operations for materialized view management</a></li>
</ul>
</li>
<li><a href=#materialized-view-based-query-rewriting>Materialized view-based query rewriting</a>
<ul>
<li><a href=#example-1>Example 1</a></li>
<li><a href=#example-2>Example 2</a></li>
<li><a href=#example-3>Example 3</a></li>
</ul>
</li>
<li><a href=#materialized-view-maintenance>Materialized view maintenance</a></li>
<li><a href=#materialized-view-lifecycle>Materialized view lifecycle</a></li>
<li><a href=#open-issues-jira>Open issues (JIRA)</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>