<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : Hive-Iceberg Integration</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--hive-iceberg-integration>Apache Hive : Hive-Iceberg Integration</h1>
<p>Apache Hive starting from 4.0 out of the box supports the Iceberg table format, the iceberg tables can be created like regular hive external or ACID tables, without adding any extra jars.</p>
<p><strong>Creating an Iceberg Table</strong></p>
<p>An iceberg table can be created using <em><strong>STORED BY ICEBERG</strong></em> keywords while creating a table.</p>
<ul>
<li>Creating an Iceberg table using normal create command</li>
</ul>
<pre tabindex=0><code>CREATE TABLE TBL_ICE (ID INT) STORED BY ICEBERG;
</code></pre><p>The above creates an iceberg table named &lsquo;TBL_ICE&rsquo;</p>
<ul>
<li>Creating an Iceberg Table using CTAS</li>
</ul>
<pre tabindex=0><code>CREATE TABLE TABLE_CTAS AS SELECT * FROM SRCTABLE STORED BY ICEBERG;
</code></pre><p>The above creates an iceberg table named &lsquo;TABLE_CTAS&rsquo; with schema & records as in &lsquo;SRCTABLE&rsquo; </p>
<ul>
<li>Creating an Iceberg Table using CTLT</li>
</ul>
<pre tabindex=0><code>CREATE TABLE_CTLT LIKE SRCTABLE STORED BY ICEBERG;
</code></pre><p>The above creates an iceberg table named &lsquo;TABLE_CTLT&rsquo; with schema same as SRCTABLE</p>
<p><strong>Format Versions:</strong></p>
<p>The iceberg tables support both v1 & v2 tables, the tables by default are created as v1 table unless explicitly specified. To create a v2 table (&lsquo;format-version&rsquo;=&lsquo;2&rsquo;)  can be specified as table property while creating the table</p>
<p>Example:</p>
<pre tabindex=0><code>CREATE TABLE V2_TABLE (ID INT) STORED BY ICEBERG TBLPROPERTIES ('format-version'='2');
</code></pre><p><strong>File Formats:</strong></p>
<p>The iceberg table currently supports three file formats: PARQUET, ORC & AVRO. The default file format is Parquet. The file format can be explicitily provided by using STORED AS while creating the table</p>
<p>Example-1:</p>
<pre tabindex=0><code>CREATE TABLE ORC_TABLE (ID INT) STORED BY ICEBERG STORED AS ORC;
</code></pre><p>The above creates a v1 iceberg table named &lsquo;ORC_TABLE&rsquo; of ORC file format.</p>
<p>Example-2:</p>
<pre tabindex=0><code>CREATE TABLE V2_ORC_TABLE (ID INT) STORED BY ICEBERG STORED AS ORC TBLPROPERTIES ('format-version'='2');
</code></pre><p>The above creates a v2 iceberg table named &lsquo;V2_ORC_TABLE&rsquo; of ORC file format.</p>
<p>Similarly we can specify any of the supported file formats while creating the table,</p>
<p><strong>Delete Modes:</strong></p>
<p>Hive for delete, update & merge queries support both Copy-on-Write and Merge-on-Read, by default the tables are created with Merge-on-Read mode. The delete mode can be configured using the following TBLPROPERTIES:</p>
<pre tabindex=0><code>CREATE TABLE tbl_x (id int) STORED BY ICEBERG TBLPROPERTIES (
    'write.delete.mode'='copy-on-write',
    'write.update.mode'='copy-on-write',
    'write.merge.mode'='copy-on-write'
);
</code></pre><p><strong>Migrating existing tables to Iceberg Tables</strong></p>
<p>Any Hive external table can be converted into an iceberg tables, without actually rewriting the data files again. We can use <em>ALTER TABLE CONVERT TO ICEBERG [TBLPROPERTIES]</em> to convert any existing external table to an iceberg table.</p>
<pre tabindex=0><code>ALTER TABLE TABLE1 CONVERT TO ICEBERG TBLPROPERTIES ('format-version'='2');
</code></pre><p>The above converts an existing external table &lsquo;TABLE1&rsquo; into a v2 Iceberg table, specifying the TBLPROPERTIES & format-version is option, if not specified the table will be converted into a v1 iceberg table.</p>
<p><strong>Querying an Iceberg Table</strong></p>
<p>Iceberg tables support all query statements similar to any other hive table.</p>
<p>Example:</p>
<pre tabindex=0><code>SELECT * FROM TBL_ICE WHERE ID &gt; 5;
</code></pre><p><strong>Writing data into iceberg tables</strong></p>
<p>Iceberg tables supports all data ingestion methods supported with hive</p>
<ul>
<li>Insert-Into</li>
</ul>
<pre tabindex=0><code>INSERT INTO TBL_ICE VALUES (1),(2),(3),(4);
</code></pre><ul>
<li>Insert-Overwrite</li>
</ul>
<pre tabindex=0><code>INSERT OVERWRITE TBL_ICE SELECT * FROM TABLE1;
</code></pre><ul>
<li>Delete</li>
</ul>
<pre tabindex=0><code>DELETE FROM TBL_ICE WHERE ID=5;
</code></pre><ul>
<li>Update</li>
</ul>
<pre tabindex=0><code>UPDATE TBL_ICE WHERE ID=8 SET ID=2;
</code></pre><ul>
<li>LOAD DATA</li>
</ul>
<pre tabindex=0><code>LOAD DATA LOCAL INPATH '/data/files/doctors.avro' OVERWRITE INTO TABLE ice_avro;
</code></pre><p><em>If the config “hive.load.data.use.native.api” is set to “false”, hive will rather than using the Append api, will launch a Tez job to do the LOAD.</em></p>
<p><strong>Metadata tables:</strong></p>
<p>Hive supports the following metadata tables for Iceberg tables
The metadata tables can be queried using the syntax <code>&lt;DATABASE NAME>.&lt;TABLE NAME>.&lt;METADATA TABLE></code></p>
<pre tabindex=0><code>ENTRIES                        SELECT * from db_name.tbl_name.entries;
FILES                          SELECT * from db_name.tbl_name.files;
HISTORY                        SELECT * from db_name.tbl_name.history;
SNAPSHOTS                      SELECT * from db_name.tbl_name.snapshots;
MANIFESTS                      SELECT * from db_name.tbl_name.manifests;
PARTITIONS                     SELECT * from db_name.tbl_name.partitions;
ALL_DATA_FILES                 SELECT * from db_name.tbl_name.all_data_files;
ALL_MANIFESTS                  SELECT * from db_name.tbl_name.all_manifests;
ALL_ENTRIES                    SELECT * from db_name.tbl_name.all_entries;
DATA_FILES                     SELECT * from db_name.tbl_name.data_files;
DELETE_FILES                   SELECT * from db_name.tbl_name.delete_files;
METADATA_LOG_ENTRIES           SELECT * from db_name.tbl_name.metadata_log_entries;
REFS                           SELECT * from db_name.tbl_name.refs;
ALL_DELETE_FILES               SELECT * from db_name.tbl_name.all_delete_files;
ALL_FILES                      SELECT * from db_name.tbl_name.all_files;
</code></pre><p><strong>Branches & Tags:</strong></p>
<p>Iceberg tables supports branches & tags, the details around the feature can be read <a href=https://medium.com/@ayushtkn/apache-hive-4-x-with-iceberg-branches-tags-3d52293ac0bf>here</a></p>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>