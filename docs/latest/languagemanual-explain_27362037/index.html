<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : LanguageManual Explain</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--languagemanual-explain>Apache Hive : LanguageManual Explain</h1>
<ul>
<li><a href=#explain-syntax>EXPLAIN Syntax</a>
<ul>
<li><a href=#example>Example</a></li>
<li><a href=#the-cbo-clause>The CBO Clause</a></li>
<li><a href=#the-ast-clause>The AST Clause</a></li>
<li><a href=#the-dependency-clause>The DEPENDENCY Clause</a></li>
<li><a href=#the-authorization-clause>The AUTHORIZATION Clause</a></li>
<li><a href=#the-locks-clause>The LOCKS Clause</a></li>
<li><a href=#the-vectorization-clause>The VECTORIZATION Clause</a></li>
<li><a href=#the-analyze-clause>The ANALYZE Clause</a></li>
<li><a href=#user-level-explain-output>User-level Explain Output</a></li>
</ul>
</li>
</ul>
<h2 id=explain-syntax>EXPLAIN Syntax</h2>
<p>Hive provides an <code>EXPLAIN</code> command that shows the execution plan for a query. The syntax for this statement is as follows:</p>
<pre tabindex=0><code>EXPLAIN [EXTENDED|CBO|AST|DEPENDENCY|AUTHORIZATION|LOCKS|VECTORIZATION|ANALYZE] query

</code></pre><p><code>AUTHORIZATION</code> is supported from HIVE 0.14.0 via <a href=https://issues.apache.org/jira/browse/HIVE-5961>HIVE-5961</a>. <code>VECTORIZATION</code> is supported from Hive 2.3.0 via <a href=https://issues.apache.org/jira/browse/HIVE-11394>HIVE-11394</a>. <code>LOCKS</code> is supported from Hive 3.2.0 via <a href=https://issues.apache.org/jira/browse/HIVE-17683>HIVE-17683</a>.</p>
<p>AST was removed from EXPLAIN EXTENDED in <a href=https://issues.apache.org/jira/browse/HIVE-13533>HIVE-13533</a> and reinstated as a separate command in <a href=https://issues.apache.org/jira/browse/HIVE-15932>HIVE-15932</a>.</p>
<p>The use of <code>EXTENDED</code> in the <code>EXPLAIN</code> statement produces extra information about the operators in the plan. This is typically physical information like file names.</p>
<p>A Hive query gets converted into a sequence (it is more a Directed Acyclic Graph) of stages. These stages may be map/reduce stages or they may even be stages that do metastore or file system operations like move and rename. The explain output has three parts:</p>
<ul>
<li>The Abstract Syntax Tree for the query</li>
<li>The dependencies between the different stages of the plan</li>
<li>The description of each of the stages</li>
</ul>
<p>The description of the stages itself shows a sequence of operators with the metadata associated with the operators. The metadata may comprise things like filter expressions for the FilterOperator or the select expressions for the SelectOperator or the output file names for the FileSinkOperator.</p>
<h3 id=example>Example</h3>
<p>As an example, consider the following <code>EXPLAIN</code> query:</p>
<pre tabindex=0><code>EXPLAIN
FROM src INSERT OVERWRITE TABLE dest_g1 SELECT src.key, sum(substr(src.value,4)) GROUP BY src.key;
</code></pre><p>The output of this statement contains the following parts:</p>
<ul>
<li>The Dependency Graph</li>
</ul>
<pre tabindex=0><code>STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-2 depends on stages: Stage-1
  Stage-0 depends on stages: Stage-2

</code></pre><p>This shows that Stage-1 is the root stage, Stage-2 is executed after Stage-1 is done and Stage-0 is executed after Stage-2 is done.</p>
<ul>
<li>The plans of each Stage</li>
</ul>
<pre tabindex=0><code>STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -&gt; Map Operator Tree:
        src
            Reduce Output Operator
              key expressions:
                    expr: key
                    type: string
              sort order: +
              Map-reduce partition columns:
                    expr: rand()
                    type: double
              tag: -1
              value expressions:
                    expr: substr(value, 4)
                    type: string
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: sum(UDFToDouble(VALUE.0))
          keys:
                expr: KEY.0
                type: string
          mode: partial1
          File Output Operator
            compressed: false
            table:
                input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
                name: binary_table

  Stage: Stage-2
    Map Reduce
      Alias -&gt; Map Operator Tree:
        /tmp/hive-zshao/67494501/106593589.10001
          Reduce Output Operator
            key expressions:
                  expr: 0
                  type: string
            sort order: +
            Map-reduce partition columns:
                  expr: 0
                  type: string
            tag: -1
            value expressions:
                  expr: 1
                  type: double
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: sum(VALUE.0)
          keys:
                expr: KEY.0
                type: string
          mode: final
          Select Operator
            expressions:
                  expr: 0
                  type: string
                  expr: 1
                  type: double
            Select Operator
              expressions:
                    expr: UDFToInteger(0)
                    type: int
                    expr: 1
                    type: double
              File Output Operator
                compressed: false
                table:
                    input format: org.apache.hadoop.mapred.TextInputFormat
                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
                    serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                    name: dest_g1

  Stage: Stage-0
    Move Operator
      tables:
            replace: true
            table:
                input format: org.apache.hadoop.mapred.TextInputFormat
                output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
                serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                name: dest_g1

</code></pre><p>In this example there are 2 map/reduce stages (Stage-1 and Stage-2) and 1 File System related stage (Stage-0). Stage-0 basically moves the results from a temporary directory to the directory corresponding to the table dest_g1.<br>
<code>Sort order</code> indicates the number of columns in key expressions that are used for sorting. Each &ldquo;<code>+</code>&rdquo; represents one column sorted in ascending order, and each &ldquo;<code>-</code>&rdquo; represents a column sorted in descending order.</p>
<p>A map/reduce stage itself has 2 parts:</p>
<ul>
<li>A mapping from table alias to Map Operator Tree – This mapping tells the mappers which operator tree to call in order to process the rows from a particular table or result of a previous map/reduce stage. In Stage-1 in the above example, the rows from src table are processed by the operator tree rooted at a Reduce Output Operator. Similarly, in Stage-2 the rows of the results of Stage-1 are processed by another operator tree rooted at another Reduce Output Operator. Each of these Reduce Output Operators partitions the data to the reducers according to the criteria shown in the metadata.</li>
<li>A Reduce Operator Tree – This is the operator tree which processes all the rows on the reducer of the map/reduce job. In Stage-1 for example, the Reducer Operator Tree is carrying out a partial aggregation whereas the Reducer Operator Tree in Stage-2 computes the final aggregation from the partial aggregates computed in Stage-1.</li>
</ul>
<h3 id=the-cbo-clause>The CBO Clause</h3>
<p>The CBO clause outputs the plan generated by Calcite optimizer. It can optionally include information about the cost of the plan using Calcite default cost model and cost model used for join reordering. Since Hive release 4.0.0 (<a href=https://issues.apache.org/jira/browse/HIVE-17503>HIVE-17503</a> / <a href=https://issues.apache.org/jira/browse/HIVE-21184>HIVE-21184</a>).</p>
<p>Syntax: EXPLAIN [FORMATTED] CBO [COST|JOINCOST]</p>
<ul>
<li><em>COST</em> option prints the plan and cost calculated using Calcite default cost model.</li>
<li><em>JOINCOST</em> option prints the plan and cost calculated using the cost model used for join reordering.</li>
</ul>
<p>For example, we can execute the following statement:</p>
<pre tabindex=0><code>EXPLAIN CBO
WITH customer_total_return AS
(SELECT sr_customer_sk AS ctr_customer_sk,
  sr_store_sk AS ctr_store_sk,
  SUM(SR_FEE) AS ctr_total_return
  FROM store_returns, date_dim
  WHERE sr_returned_date_sk = d_date_sk
    AND d_year =2000
  GROUP BY sr_customer_sk, sr_store_sk)
SELECT c_customer_id
FROM customer_total_return ctr1, store, customer
WHERE ctr1.ctr_total_return &gt; (SELECT AVG(ctr_total_return)*1.2
FROM customer_total_return ctr2
WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk)
  AND s_store_sk = ctr1.ctr_store_sk
  AND s_state = 'NM'
  AND ctr1.ctr_customer_sk = c_customer_sk
ORDER BY c_customer_id
LIMIT 100

</code></pre><p>The query will be optimized and Hive produces the following output:</p>
<pre tabindex=0><code>CBO PLAN:
HiveSortLimit(sort0=[$0], dir0=[ASC], fetch=[100])
  HiveProject(c_customer_id=[$1])
    HiveJoin(condition=[AND(=($3, $7), &gt;($4, $6))], joinType=[inner], algorithm=[none], cost=[not available])
      HiveJoin(condition=[=($2, $0)], joinType=[inner], algorithm=[none], cost=[not available])
        HiveProject(c_customer_sk=[$0], c_customer_id=[$1])
          HiveFilter(condition=[IS NOT NULL($0)])
            HiveTableScan(table=[[default, customer]], table:alias=[customer])
        HiveJoin(condition=[=($3, $1)], joinType=[inner], algorithm=[none], cost=[not available])
          HiveProject(sr_customer_sk=[$0], sr_store_sk=[$1], $f2=[$2])
            HiveAggregate(group=[{1, 2}], agg#0=[sum($3)])
              HiveJoin(condition=[=($0, $4)], joinType=[inner], algorithm=[none], cost=[not available])
                HiveProject(sr_returned_date_sk=[$0], sr_customer_sk=[$3], sr_store_sk=[$7], sr_fee=[$14])
                  HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($7), IS NOT NULL($3))])
                    HiveTableScan(table=[[default, store_returns]], table:alias=[store_returns])
                HiveProject(d_date_sk=[$0])
                  HiveFilter(condition=[AND(=($6, 2000), IS NOT NULL($0))])
                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
          HiveProject(s_store_sk=[$0])
            HiveFilter(condition=[AND(=($24, _UTF-16LE'NM'), IS NOT NULL($0))])
              HiveTableScan(table=[[default, store]], table:alias=[store])
      HiveProject(_o__c0=[*(/($1, $2), 1.2)], ctr_store_sk=[$0])
        HiveAggregate(group=[{1}], agg#0=[sum($2)], agg#1=[count($2)])
          HiveProject(sr_customer_sk=[$0], sr_store_sk=[$1], $f2=[$2])
            HiveAggregate(group=[{1, 2}], agg#0=[sum($3)])
              HiveJoin(condition=[=($0, $4)], joinType=[inner], algorithm=[none], cost=[not available])
                HiveProject(sr_returned_date_sk=[$0], sr_customer_sk=[$3], sr_store_sk=[$7], sr_fee=[$14])
                  HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($7))])
                    HiveTableScan(table=[[default, store_returns]], table:alias=[store_returns])
                HiveProject(d_date_sk=[$0])
                  HiveFilter(condition=[AND(=($6, 2000), IS NOT NULL($0))])
                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
</code></pre><p>In turn, we can execute the following command:</p>
<pre tabindex=0><code>EXPLAIN CBO COST
WITH customer_total_return AS
(SELECT sr_customer_sk AS ctr_customer_sk,
  sr_store_sk AS ctr_store_sk,
  SUM(SR_FEE) AS ctr_total_return
  FROM store_returns, date_dim
  WHERE sr_returned_date_sk = d_date_sk
    AND d_year =2000
  GROUP BY sr_customer_sk, sr_store_sk)
SELECT c_customer_id
FROM customer_total_return ctr1, store, customer
WHERE ctr1.ctr_total_return &gt; (SELECT AVG(ctr_total_return)*1.2
FROM customer_total_return ctr2
WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk)
  AND s_store_sk = ctr1.ctr_store_sk
  AND s_state = 'NM'
  AND ctr1.ctr_customer_sk = c_customer_sk
ORDER BY c_customer_id
LIMIT 100

</code></pre><p>It will produce a similar plan, but the cost for each operator will be embedded next to the operator descriptors:</p>
<pre tabindex=0><code>CBO PLAN:
HiveSortLimit(sort0=[$0], dir0=[ASC], fetch=[100]): rowcount = 100.0, cumulative cost = {2.395588892021712E26 rows, 1.197794434438787E26 cpu, 0.0 io}, id = 1683
  HiveProject(c_customer_id=[$1]): rowcount = 1.1977944344387866E26, cumulative cost = {2.395588892021712E26 rows, 1.197794434438787E26 cpu, 0.0 io}, id = 1681
    HiveJoin(condition=[AND(=($3, $7), &gt;($4, $6))], joinType=[inner], algorithm=[none], cost=[not available]): rowcount = 1.1977944344387866E26, cumulative cost = {1.1977944575829254E26 rows, 4.160211553874922E10 cpu, 0.0 io}, id = 1679
      HiveJoin(condition=[=($2, $0)], joinType=[inner], algorithm=[none], cost=[not available]): rowcount = 2.3144135067474273E18, cumulative cost = {2.3144137967122499E18 rows, 1.921860676139634E10 cpu, 0.0 io}, id = 1663
        HiveProject(c_customer_sk=[$0], c_customer_id=[$1]): rowcount = 7.2E7, cumulative cost = {2.24E8 rows, 3.04000001E8 cpu, 0.0 io}, id = 1640
          HiveFilter(condition=[IS NOT NULL($0)]): rowcount = 7.2E7, cumulative cost = {1.52E8 rows, 1.60000001E8 cpu, 0.0 io}, id = 1638
            HiveTableScan(table=[[default, customer]], table:alias=[customer]): rowcount = 8.0E7, cumulative cost = {8.0E7 rows, 8.0000001E7 cpu, 0.0 io}, id = 1055
        HiveJoin(condition=[=($3, $1)], joinType=[inner], algorithm=[none], cost=[not available]): rowcount = 2.1429754692105807E11, cumulative cost = {2.897408225471977E11 rows, 1.891460676039634E10 cpu, 0.0 io}, id = 1661
          HiveProject(sr_customer_sk=[$0], sr_store_sk=[$1], $f2=[$2]): rowcount = 6.210443022113779E9, cumulative cost = {7.544327346205959E10 rows, 1.891460312135634E10 cpu, 0.0 io}, id = 1685
            HiveAggregate(group=[{1, 2}], agg#0=[sum($3)]): rowcount = 6.210443022113779E9, cumulative cost = {6.92328304399458E10 rows, 2.8327405501500005E8 cpu, 0.0 io}, id = 1654
              HiveJoin(condition=[=($0, $4)], joinType=[inner], algorithm=[none], cost=[not available]): rowcount = 6.2104430221137794E10, cumulative cost = {6.2246082040067795E10 rows, 2.8327405501500005E8 cpu, 0.0 io}, id = 1652
                HiveProject(sr_returned_date_sk=[$0], sr_customer_sk=[$3], sr_store_sk=[$7], sr_fee=[$14]): rowcount = 4.198394835000001E7, cumulative cost = {1.4155904670000002E8 rows, 2.8311809440000004E8 cpu, 0.0 io}, id = 1645
                  HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($7), IS NOT NULL($3))]): rowcount = 4.198394835000001E7, cumulative cost = {9.957509835000001E7 rows, 1.15182301E8 cpu, 0.0 io}, id = 1643
                    HiveTableScan(table=[[default, store_returns]], table:alias=[store_returns]): rowcount = 5.759115E7, cumulative cost = {5.759115E7 rows, 5.7591151E7 cpu, 0.0 io}, id = 1040
                HiveProject(d_date_sk=[$0]): rowcount = 9861.615, cumulative cost = {92772.23000000001 rows, 155960.615 cpu, 0.0 io}, id = 1650
                  HiveFilter(condition=[AND(=($6, 2000), IS NOT NULL($0))]): rowcount = 9861.615, cumulative cost = {82910.615 rows, 146099.0 cpu, 0.0 io}, id = 1648
                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {73049.0 rows, 73050.0 cpu, 0.0 io}, id = 1043
          HiveProject(s_store_sk=[$0]): rowcount = 230.04000000000002, cumulative cost = {2164.08 rows, 3639.04 cpu, 0.0 io}, id = 1659
            HiveFilter(condition=[AND(=($24, _UTF-16LE'NM'), IS NOT NULL($0))]): rowcount = 230.04000000000002, cumulative cost = {1934.04 rows, 3409.0 cpu, 0.0 io}, id = 1657
              HiveTableScan(table=[[default, store]], table:alias=[store]): rowcount = 1704.0, cumulative cost = {1704.0 rows, 1705.0 cpu, 0.0 io}, id = 1050
      HiveProject(_o__c0=[*(/($1, $2), 1.2)], ctr_store_sk=[$0]): rowcount = 6.900492246793088E8, cumulative cost = {8.537206083312463E10 rows, 2.2383508777352882E10 cpu, 0.0 io}, id = 1677
        HiveAggregate(group=[{1}], agg#0=[sum($2)], agg#1=[count($2)]): rowcount = 6.900492246793088E8, cumulative cost = {8.468201160844533E10 rows, 2.1003410327994267E10 cpu, 0.0 io}, id = 1675
          HiveProject(sr_customer_sk=[$0], sr_store_sk=[$1], $f2=[$2]): rowcount = 6.900492246793088E9, cumulative cost = {8.381945007759619E10 rows, 2.1003410327994267E10 cpu, 0.0 io}, id = 1686
            HiveAggregate(group=[{1, 2}], agg#0=[sum($3)]): rowcount = 6.900492246793088E9, cumulative cost = {7.69189578308031E10 rows, 3.01933587615E8 cpu, 0.0 io}, id = 1673
              HiveJoin(condition=[=($0, $4)], joinType=[inner], algorithm=[none], cost=[not available]): rowcount = 6.900492246793088E10, cumulative cost = {6.915590405316087E10 rows, 3.01933587615E8 cpu, 0.0 io}, id = 1671
                HiveProject(sr_returned_date_sk=[$0], sr_customer_sk=[$3], sr_store_sk=[$7], sr_fee=[$14]): rowcount = 4.66488315E7, cumulative cost = {1.50888813E8 rows, 3.01777627E8 cpu, 0.0 io}, id = 1667
                  HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($7))]): rowcount = 4.66488315E7, cumulative cost = {1.042399815E8 rows, 1.15182301E8 cpu, 0.0 io}, id = 1665
                    HiveTableScan(table=[[default, store_returns]], table:alias=[store_returns]): rowcount = 5.759115E7, cumulative cost = {5.759115E7 rows, 5.7591151E7 cpu, 0.0 io}, id = 1040
                HiveProject(d_date_sk=[$0]): rowcount = 9861.615, cumulative cost = {92772.23000000001 rows, 155960.615 cpu, 0.0 io}, id = 1650
                  HiveFilter(condition=[AND(=($6, 2000), IS NOT NULL($0))]): rowcount = 9861.615, cumulative cost = {82910.615 rows, 146099.0 cpu, 0.0 io}, id = 1648
                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {73049.0 rows, 73050.0 cpu, 0.0 io}, id = 1043
</code></pre><h3 id=the-ast-clause>The AST Clause</h3>
<p>Outputs the query&rsquo;s Abstract Syntax Tree.</p>
<p>Example:</p>
<pre tabindex=0><code>EXPLAIN AST
FROM src INSERT OVERWRITE TABLE dest_g1 SELECT src.key, sum(substr(src.value,4)) GROUP BY src.key;
</code></pre><p>Outputs:</p>
<pre tabindex=0><code>ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest_g1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4)))) (TOK_GROUPBY (TOK_COLREF src key))))

</code></pre><h3 id=the-dependency-clause>The DEPENDENCY Clause</h3>
<p>The use of <code>DEPENDENCY</code> in the <code>EXPLAIN</code> statement produces extra information about the inputs in the plan. It shows various attributes for the inputs. For example, for a query like:</p>
<pre tabindex=0><code>EXPLAIN DEPENDENCY
  SELECT key, count(1) FROM srcpart WHERE ds IS NOT NULL GROUP BY key

</code></pre><p>the following output is produced:</p>
<pre tabindex=0><code>{&quot;input_partitions&quot;:[{&quot;partitionName&quot;:&quot;default&lt;at:var at:name=&quot;srcpart&quot; /&gt;ds=2008-04-08/hr=11&quot;},{&quot;partitionName&quot;:&quot;default&lt;at:var at:name=&quot;srcpart&quot; /&gt;ds=2008-04-08/hr=12&quot;},{&quot;partitionName&quot;:&quot;default&lt;at:var at:name=&quot;srcpart&quot; /&gt;ds=2008-04-09/hr=11&quot;},{&quot;partitionName&quot;:&quot;default&lt;at:var at:name=&quot;srcpart&quot; /&gt;ds=2008-04-09/hr=12&quot;}],&quot;input_tables&quot;:[{&quot;tablename&quot;:&quot;default@srcpart&quot;,&quot;tabletype&quot;:&quot;MANAGED_TABLE&quot;}]}

</code></pre><p>The inputs contain both the tables and the partitions. Note that the table is present even if none of the partitions is accessed in the query.</p>
<p>The dependencies show the parents in case a table is accessed via a view. Consider the following queries:</p>
<pre tabindex=0><code>CREATE VIEW V1 AS SELECT key, value from src;
EXPLAIN DEPENDENCY SELECT * FROM V1;

</code></pre><p>The following output is produced:</p>
<pre tabindex=0><code>{&quot;input_partitions&quot;:[],&quot;input_tables&quot;:[{&quot;tablename&quot;:&quot;default@v1&quot;,&quot;tabletype&quot;:&quot;VIRTUAL_VIEW&quot;},{&quot;tablename&quot;:&quot;default@src&quot;,&quot;tabletype&quot;:&quot;MANAGED_TABLE&quot;,&quot;tableParents&quot;:&quot;[default@v1]&quot;}]}

</code></pre><p>As above, the inputs contain the view V1 and the table &lsquo;src&rsquo; that the view V1 refers to.</p>
<p>All the outputs are shown if a table is being accessed via multiple parents.</p>
<pre tabindex=0><code>CREATE VIEW V2 AS SELECT ds, key, value FROM srcpart WHERE ds IS NOT NULL;
CREATE VIEW V4 AS
  SELECT src1.key, src2.value as value1, src3.value as value2
  FROM V1 src1 JOIN V2 src2 on src1.key = src2.key JOIN src src3 ON src2.key = src3.key;
EXPLAIN DEPENDENCY SELECT * FROM V4;

</code></pre><p>The following output is produced.</p>
<pre tabindex=0><code>{&quot;input_partitions&quot;:[{&quot;partitionParents&quot;:&quot;[default@v2]&quot;,&quot;partitionName&quot;:&quot;default&lt;at:var at:name=&quot;srcpart&quot; /&gt;ds=2008-04-08/hr=11&quot;},{&quot;partitionParents&quot;:&quot;[default@v2]&quot;,&quot;partitionName&quot;:&quot;default&lt;at:var at:name=&quot;srcpart&quot; /&gt;ds=2008-04-08/hr=12&quot;},{&quot;partitionParents&quot;:&quot;[default@v2]&quot;,&quot;partitionName&quot;:&quot;default&lt;at:var at:name=&quot;srcpart&quot; /&gt;ds=2008-04-09/hr=11&quot;},{&quot;partitionParents&quot;:&quot;[default@v2]&quot;,&quot;partitionName&quot;:&quot;default&lt;at:var at:name=&quot;srcpart&quot; /&gt;ds=2008-04-09/hr=12&quot;}],&quot;input_tables&quot;:[{&quot;tablename&quot;:&quot;default@v4&quot;,&quot;tabletype&quot;:&quot;VIRTUAL_VIEW&quot;},{&quot;tablename&quot;:&quot;default@v2&quot;,&quot;tabletype&quot;:&quot;VIRTUAL_VIEW&quot;,&quot;tableParents&quot;:&quot;[default@v4]&quot;},{&quot;tablename&quot;:&quot;default@v1&quot;,&quot;tabletype&quot;:&quot;VIRTUAL_VIEW&quot;,&quot;tableParents&quot;:&quot;[default@v4]&quot;},{&quot;tablename&quot;:&quot;default@src&quot;,&quot;tabletype&quot;:&quot;MANAGED_TABLE&quot;,&quot;tableParents&quot;:&quot;[default@v4, default@v1]&quot;},{&quot;tablename&quot;:&quot;default@srcpart&quot;,&quot;tabletype&quot;:&quot;MANAGED_TABLE&quot;,&quot;tableParents&quot;:&quot;[default@v2]&quot;}]}

</code></pre><p>As can be seen, src is being accessed via parents v1 and v4.</p>
<h3 id=the-authorization-clause>The AUTHORIZATION Clause</h3>
<p>The use of <code>AUTHORIZATION</code> in the <code>EXPLAIN</code> statement shows all entities needed to be authorized to execute the query and authorization failures if any exist. For example, for a query like:</p>
<pre tabindex=0><code>EXPLAIN AUTHORIZATION
  SELECT * FROM src JOIN srcpart;

</code></pre><p>the following output is produced:</p>
<pre tabindex=0><code>INPUTS: 
  default@srcpart
  default@src
  default@srcpart@ds=2008-04-08/hr=11
  default@srcpart@ds=2008-04-08/hr=12
  default@srcpart@ds=2008-04-09/hr=11
  default@srcpart@ds=2008-04-09/hr=12
OUTPUTS: 
  hdfs://localhost:9000/tmp/.../-mr-10000
CURRENT_USER: 
  navis
OPERATION: 
  QUERY
AUTHORIZATION_FAILURES: 
  Permission denied: Principal [name=navis, type=USER] does not have following privileges for operation QUERY [[SELECT] on Object [type=TABLE_OR_VIEW, name=default.src], [SELECT] on Object [type=TABLE_OR_VIEW, name=default.srcpart]]

</code></pre><p>With the <code>FORMATTED</code> keyword, it will be returned in JSON format.</p>
<pre tabindex=0><code>  

</code></pre><pre tabindex=0><code>&quot;OUTPUTS&quot;:[&quot;hdfs://localhost:9000/tmp/.../-mr-10000&quot;],&quot;INPUTS&quot;:[&quot;default@srcpart&quot;,&quot;default@src&quot;,&quot;default@srcpart@ds=2008-04-08/hr=11&quot;,&quot;default@srcpart@ds=2008-04-08/hr=12&quot;,&quot;default@srcpart@ds=2008-04-09/hr=11&quot;,&quot;default@srcpart@ds=2008-04-09/hr=12&quot;],&quot;OPERATION&quot;:&quot;QUERY&quot;,&quot;CURRENT_USER&quot;:&quot;navis&quot;,&quot;AUTHORIZATION_FAILURES&quot;:[&quot;Permission denied: Principal [name=navis, type=USER] does not have following privileges for operation QUERY [[SELECT] on Object [type=TABLE_OR_VIEW, name=default.src], [SELECT] on Object [type=TABLE_OR_VIEW, name=default.srcpart]]&quot;]}

</code></pre><h3 id=the-locks-clause>The LOCKS Clause</h3>
<p>This is useful to understand what locks the system will acquire to run the specified query.  Since Hive release 3.2.0 (<a href=https://issues.apache.org/jira/browse/HIVE-17683>HIVE-17683</a>).</p>
<p>For example</p>
<pre tabindex=0><code>EXPLAIN LOCKS UPDATE target SET b = 1 WHERE p IN (SELECT t.q1 FROM source t WHERE t.a1=5)

</code></pre><p>Will produce output like this.</p>
<pre tabindex=0><code>LOCK INFORMATION:
default.source -&gt; SHARED_READ
default.target.p=1/q=2 -&gt; SHARED_READ
default.target.p=1/q=3 -&gt; SHARED_READ
default.target.p=2/q=2 -&gt; SHARED_READ
default.target.p=2/q=2 -&gt; SHARED_WRITE
default.target.p=1/q=3 -&gt; SHARED_WRITE
default.target.p=1/q=2 -&gt; SHARED_WRITE
</code></pre><pre tabindex=0><code>  

</code></pre><pre tabindex=0><code>EXPLAIN FORMATTED LOCKS &lt;sql&gt;

</code></pre><p>is also supported which will produce JSON encoded output.</p>
<h3 id=the-vectorization-clause>The VECTORIZATION Clause</h3>
<p>Adds detail to the EXPLAIN output showing why Map and Reduce work is not vectorized. Since Hive release 2.3.0 (<a href=https://issues.apache.org/jira/browse/HIVE-11394>HIVE-11394</a>).</p>
<p>Syntax: EXPLAIN VECTORIZATION [ONLY] [SUMMARY|OPERATOR|EXPRESSION|DETAIL]</p>
<ul>
<li><em>ONLY</em> option suppresses most non-vectorization elements.</li>
<li><em>SUMMARY</em> (default) shows vectorization information for the PLAN (is vectorization enabled) and a summary of Map and Reduce work.</li>
<li><em>OPERATOR</em> shows vectorization information for operators. E.g. Filter Vectorization. Includes all information of SUMMARY.</li>
<li><em>EXPRESSION</em> shows vectorization information for expressions. E.g. predicateExpression. Includes all information of SUMMARY and OPERATOR.</li>
<li><em>DETAIL</em> shows detail-level vectorization information.  It includes all information of SUMMARY, OPERATOR, and EXPRESSION.</li>
</ul>
<p>The optional clause defaults are not ONLY and SUMMARY.</p>
<p>See <a href=https://issues.apache.org/jira/browse/HIVE-11394>HIVE-11394</a> for more details and examples.</p>
<h3 id=the-analyze-clause>The ANALYZE Clause</h3>
<p>Annotates the plan with actual row counts. Since in Hive 2.2.0 (<a href=https://issues.apache.org/jira/browse/HIVE-14362>HIVE-14362</a>)</p>
<p>Format is: (estimated row count) / (actual row count)</p>
<p>Example:</p>
<p>For the below tablescan; the estimation was 500 rows; but actually the scan only yielded 13 rows.</p>
<pre tabindex=0><code>[...]
              TableScan [TS_13] (rows=500/13 width=178)
                Output:[&quot;key&quot;,&quot;value&quot;]
[...]
</code></pre><h3 id=user-level-explain-output>User-level Explain Output</h3>
<p>Since <a href=https://issues.apache.org/jira/browse/HIVE-8600>HIVE-8600</a> in Hive 1.1.0, we support a user-level explain extended output for any query at the log4j INFO level after <strong>set <a href=#**h**ive-log-explain-output><strong>h</strong>ive.log.explain.output</a>****=true</strong> (default is <strong>false</strong>).</p>
<p>Since <a href=https://issues.apache.org/jira/browse/HIVE-18469>HIVE-18469</a> in Hive 3.1.0, the user-level explain extended output for any query will be shown in the WebUI / Drilldown / Query Plan after <strong>set <a href=#hive-server2-webui-explain-output>hive.server2.webui.explain.output</a>=true</strong> (default is <strong>false</strong>).</p>
<p>Since <a href=https://issues.apache.org/jira/browse/HIVE-9780>HIVE-9780</a> in Hive 1.2.0, we support a user-level explain for Hive on Tez users. After <strong>set <a href=#hive-explain-user>hive.explain.user</a>=true</strong> (default is <strong>false</strong>) if the following query is sent, the user can see a much more clearly readable tree of operations.</p>
<p>Since <a href=https://issues.apache.org/jira/browse/HIVE-11133>HIVE-11133</a> in Hive 3.0.0, we support a user-level explain for Hive on Spark users. A separate configuration is used for Hive-on-Spark, <strong><a href=#hive-spark-explain-user>hive.spark.explain.user</a></strong> which is set to false by default.</p>
<pre tabindex=0><code>EXPLAIN select sum(hash(key)), sum(hash(value)) from src_orc_merge_test_part where ds='2012-01-03' and ts='2012-01-03+14:46:31'
</code></pre><pre tabindex=0><code>Plan optimized by CBO.
Vertex dependency in root stage
Reducer 2 &lt;- Map 1 (SIMPLE_EDGE)
Stage-0
   Fetch Operator
      limit:-1
      Stage-1
         Reducer 2
         File Output Operator [FS_8]
            compressed:false
            Statistics:Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
            table:{&quot;serde:&quot;:&quot;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe&quot;,&quot;input format:&quot;:&quot;org.apache.hadoop.mapred.TextInputFormat&quot;,&quot;output format:&quot;:&quot;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&quot;}
            Group By Operator [GBY_6]
            |  aggregations:[&quot;sum(VALUE._col0)&quot;,&quot;sum(VALUE._col1)&quot;]
            |  outputColumnNames:[&quot;_col0&quot;,&quot;_col1&quot;]
            |  Statistics:Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
            |&lt;-Map 1 [SIMPLE_EDGE]
               Reduce Output Operator [RS_5]
                  sort order:
                  Statistics:Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
                  value expressions:_col0 (type: bigint), _col1 (type: bigint)
                  Group By Operator [GBY_4]
                     aggregations:[&quot;sum(_col0)&quot;,&quot;sum(_col1)&quot;]
                     outputColumnNames:[&quot;_col0&quot;,&quot;_col1&quot;]
                     Statistics:Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
                     Select Operator [SEL_2]
                        outputColumnNames:[&quot;_col0&quot;,&quot;_col1&quot;]
                        Statistics:Num rows: 500 Data size: 47000 Basic stats: COMPLETE Column stats: NONE
                        TableScan [TS_0]
                           alias:src_orc_merge_test_part
                           Statistics:Num rows: 500 Data size: 47000 Basic stats: COMPLETE Column stats: NONE

</code></pre>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>