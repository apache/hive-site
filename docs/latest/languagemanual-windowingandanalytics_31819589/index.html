<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : LanguageManual WindowingAndAnalytics</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--languagemanual-windowingandanalytics>Apache Hive : LanguageManual WindowingAndAnalytics</h1>
<h1 id=windowing-and-analytics-functions>Windowing and Analytics Functions</h1>
<ul>
<li><a href=#windowing-and-analytics-functions>Windowing and Analytics Functions</a>
<ul>
<li><a href=#enhancements-to-hive-ql>Enhancements to Hive QL</a></li>
<li><a href=#examples>Examples</a>
<ul>
<li><a href=#partition-by-with-one-partitioning-column-no-order-by-or-window-specification>PARTITION BY with one partitioning column, no ORDER BY or window specification</a></li>
<li><a href=#partition-by-with-two-partitioning-columns-no-order-by-or-window-specification>PARTITION BY with two partitioning columns, no ORDER BY or window specification</a></li>
<li><a href=#partition-by-with-one-partitioning-column-one-order-by-column-and-no-window-specification>PARTITION BY with one partitioning column, one ORDER BY column, and no window specification</a></li>
<li><a href=#partition-by-with-two-partitioning-columns-two-order-by-columns-and-no-window-specification>PARTITION BY with two partitioning columns, two ORDER BY columns, and no window specification</a></li>
<li><a href=#partition-by-with-partitioning-order-by-and-window-specification>PARTITION BY with partitioning, ORDER BY, and window specification</a></li>
<li><a href=#window-clause>WINDOW clause</a></li>
<li><a href=#lead-using-default-1-row-lead-and-not-specifying-default-value>LEAD using default 1 row lead and not specifying default value</a></li>
<li><a href=#lag-specifying-a-lag-of-3-rows-and-default-value-of-0>LAG specifying a lag of 3 rows and default value of 0</a></li>
<li><a href=#distinct-counting-for-each-partition>Distinct counting for each partition</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id=enhancements-to-hive-ql>Enhancements to Hive QL</h2>
<p>Version</p>
<p>Introduced in Hive version 0.11.</p>
<p>This section introduces the Hive QL enhancements for windowing and analytics functions. See &ldquo;<a href=https://issues.apache.org/jira/secure/attachment/12575830/WindowingSpecification.pdf>Windowing Specifications in HQL</a>&rdquo; (attached to <a href=https://issues.apache.org/jira/browse/HIVE-4197>HIVE-4197</a>) for details. <a href=https://issues.apache.org/jira/browse/HIVE-896>HIVE-896</a> has more information, including links to earlier documentation in the initial comments.</p>
<p>All of the windowing and analytics functions operate as per the SQL standard.</p>
<p>The current release supports the following functions for windowing and analytics:</p>
<ol>
<li>Windowing functions
<ul>
<li>LEAD
<ul>
<li>The number of rows to lead can optionally be specified. If the number of rows to lead is not specified, the lead is one row.</li>
<li>Returns null when the lead for the current row extends beyond the end of the window.</li>
</ul>
</li>
<li>LAG
<ul>
<li>The number of rows to lag can optionally be specified. If the number of rows to lag is not specified, the lag is one row.</li>
<li>Returns null when the lag for the current row extends before the beginning of the window.</li>
</ul>
</li>
<li>FIRST_VALUE
<ul>
<li>This takes at most two parameters. The first parameter is the column for which you want the first value, the second (optional) parameter must be a boolean which is <code>false</code> by default. If set to true it skips null values.</li>
</ul>
</li>
<li>LAST_VALUE
<ul>
<li>This takes at most two parameters. The first parameter is the column for which you want the last value, the second (optional) parameter must be a boolean which is <code>false</code> by default. If set to true it skips null values.</li>
</ul>
</li>
</ul>
</li>
<li>The OVER clause
<ul>
<li>
<p>OVER with standard aggregates:</p>
<ul>
<li>COUNT</li>
<li>SUM</li>
<li>MIN</li>
<li>MAX</li>
<li>AVG</li>
</ul>
</li>
<li>
<p>OVER with a PARTITION BY statement with one or more partitioning columns of any primitive datatype.</p>
</li>
<li>
<p>OVER with PARTITION BY and ORDER BY with one or more partitioning and/or ordering columns of any datatype.</p>
<ul>
<li>OVER with a window specification. Windows can be defined separately in a WINDOW clause. Window specifications support the following formats:</li>
</ul>
<pre tabindex=0><code>(ROWS | RANGE) BETWEEN (UNBOUNDED | [num]) PRECEDING AND ([num] PRECEDING | CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)
(ROWS | RANGE) BETWEEN CURRENT ROW AND (CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)
(ROWS | RANGE) BETWEEN [num] FOLLOWING AND (UNBOUNDED | [num]) FOLLOWING
</code></pre><pre tabindex=0><code>
en ORDER BY is specified with missing WINDOW clause, the WINDOW specification defaults to `RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW.`

en both ORDER BY and WINDOW clauses are missing, the WINDOW specification defaults to `ROW BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING.`

e OVER clause supports the following functions, but it does not support a window with them (see [HIVE-4797](https://issues.apache.org/jira/browse/HIVE-4797)):

nking functions: Rank, NTile, DenseRank, CumeDist, PercentRank.

ad and Lag functions.
</code></pre></li>
</ul>
</li>
<li>Analytics functions
<ul>
<li>RANK</li>
<li>ROW_NUMBER</li>
<li>DENSE_RANK</li>
<li>CUME_DIST</li>
<li>PERCENT_RANK</li>
<li>NTILE</li>
</ul>
</li>
<li>Distinct support in Hive 2.1.0 and later (see <a href=https://issues.apache.org/jira/browse/HIVE-9534>HIVE-9534</a>)</li>
</ol>
<p>Distinct is supported for aggregation functions including SUM, COUNT and AVG, which aggregate over the distinct values within each partition. Current implementation has the limitation that no ORDER BY or window specification can be supported in the partitioning clause for performance reason. The supported syntax is as follows.</p>
<pre tabindex=0><code>COUNT(DISTINCT a) OVER (PARTITION BY c)
</code></pre><p>ORDER BY and window specification is supported for distinct in Hive 2.2.0 (see <a href=https://issues.apache.org/jira/browse/HIVE-13453>HIVE-13453</a>). An example is as follows.</p>
<pre tabindex=0><code>COUNT(DISTINCT a) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)
</code></pre><ol start=5>
<li>Aggregate functions in OVER clause support in Hive 2.1.0 and later (see <a href=https://issues.apache.org/jira/browse/HIVE-13475>HIVE-13475</a>)</li>
</ol>
<p>Support to reference aggregate functions within the OVER clause has been added. For instance, currently we can use the SUM aggregation function within the OVER clause as follows.</p>
<pre tabindex=0><code>SELECT rank() OVER (ORDER BY sum(b))
FROM T
GROUP BY a;
</code></pre><h2 id=examples>Examples</h2>
<p>This section provides examples of how to use the Hive QL windowing and analytics functions in SELECT statements. See <a href=https://issues.apache.org/jira/browse/HIVE-896>HIVE-896</a> for additional examples.</p>
<h4 id=partition-by-with-one-partitioning-column-no-order-by-or-window-specification>PARTITION BY with one partitioning column, no ORDER BY or window specification</h4>
<pre tabindex=0><code>SELECT a, COUNT(b) OVER (PARTITION BY c)
FROM T;
</code></pre><h4 id=partition-by-with-two-partitioning-columns-no-order-by-or-window-specification>PARTITION BY with two partitioning columns, no ORDER BY or window specification</h4>
<pre tabindex=0><code>SELECT a, COUNT(b) OVER (PARTITION BY c, d)
FROM T;
</code></pre><h4 id=partition-by-with-one-partitioning-column-one-order-by-column-and-no-window-specification>PARTITION BY with one partitioning column, one ORDER BY column, and no window specification</h4>
<pre tabindex=0><code>SELECT a, SUM(b) OVER (PARTITION BY c ORDER BY d)
FROM T;
</code></pre><h4 id=partition-by-with-two-partitioning-columns-two-order-by-columns-and-no-window-specification>PARTITION BY with two partitioning columns, two ORDER BY columns, and no window specification</h4>
<pre tabindex=0><code>SELECT a, SUM(b) OVER (PARTITION BY c, d ORDER BY e, f)
FROM T;
</code></pre><h4 id=partition-by-with-partitioning-order-by-and-window-specification>PARTITION BY with partitioning, ORDER BY, and window specification</h4>
<pre tabindex=0><code>SELECT a, SUM(b) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)
FROM T;
</code></pre><pre tabindex=0><code>SELECT a, AVG(b) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN 3 PRECEDING AND CURRENT ROW)
FROM T;
</code></pre><pre tabindex=0><code>SELECT a, AVG(b) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN 3 PRECEDING AND 3 FOLLOWING)
FROM T;
</code></pre><pre tabindex=0><code>SELECT a, AVG(b) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING)
FROM T;
</code></pre><p> </p>
<p>There can be multiple <code>OVER</code> clauses in a single query. A single <code>OVER</code> clause only applies to the immediately preceding function call. In this example, the first OVER clause applies to COUNT(b) and the second OVER clause applies to SUM(b):</p>
<pre tabindex=0><code>SELECT 
 a,
 COUNT(b) OVER (PARTITION BY c),
 SUM(b) OVER (PARTITION BY c)
FROM T;
</code></pre><p> </p>
<p>Aliases can be used as well, with or without the keyword AS:</p>
<pre tabindex=0><code>SELECT 
 a,
 COUNT(b) OVER (PARTITION BY c) AS b_count,
 SUM(b) OVER (PARTITION BY c) b_sum
FROM T;
</code></pre><h4 id=window-clause>WINDOW clause</h4>
<pre tabindex=0><code>SELECT a, SUM(b) OVER w
FROM T
WINDOW w AS (PARTITION BY c ORDER BY d ROWS UNBOUNDED PRECEDING);
</code></pre><h4 id=lead-using-default-1-row-lead-and-not-specifying-default-value>LEAD using default 1 row lead and not specifying default value</h4>
<pre tabindex=0><code>SELECT a, LEAD(a) OVER (PARTITION BY b ORDER BY C)
FROM T;
</code></pre><h4 id=lag-specifying-a-lag-of-3-rows-and-default-value-of-0>LAG specifying a lag of 3 rows and default value of 0</h4>
<pre tabindex=0><code>SELECT a, LAG(a, 3, 0) OVER (PARTITION BY b ORDER BY C)
FROM T;
</code></pre><h4 id=distinct-counting-for-each-partition>Distinct counting for each partition</h4>
<pre tabindex=0><code>SELECT a, COUNT(distinct a) OVER (PARTITION BY b)
FROM T;
</code></pre>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>