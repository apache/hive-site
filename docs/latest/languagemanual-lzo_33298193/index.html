<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : LanguageManual LZO</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--languagemanual-lzo>Apache Hive : LanguageManual LZO</h1>
<h1 id=lzo-compression>LZO Compression</h1>
<ul>
<li><a href=#lzo-compression>LZO Compression</a>
<ul>
<li><a href=#general-lzo-concepts>General LZO Concepts</a></li>
<li><a href=#prerequisites>Prerequisites</a>
<ul>
<li><a href=#lzolzop-installations>Lzo/Lzop Installations</a></li>
<li><a href=#core-site-xml>core-site.xml</a></li>
<li><a href=#table-definition>Table Definition</a></li>
</ul>
</li>
<li><a href=#hive-queries>Hive Queries</a>
<ul>
<li><a href=#option-1-directly-create-lzo-files>Option 1: Directly Create LZO Files</a></li>
<li><a href=#option-2-write-custom-java-to-create-lzo-files>Option 2: Write Custom Java to Create LZO Files</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id=general-lzo-concepts>General LZO Concepts</h2>
<p>LZO is a lossless data compression library that favors speed over compression ratio. See <a href=http://www.oberhumer.com/opensource/lzo>http://www.oberhumer.com/opensource/lzo</a> and <a href=http://www.lzop.org>http://www.lzop.org</a> for general information about LZO and see <a href=https://hive.apache.org/docs/latest/compressedstorage_27362073/>Compressed Data Storage</a> for information about compression in Hive.</p>
<p>Imagine a simple data file that has three columns</p>
<ul>
<li>id</li>
<li>first name</li>
<li>last name</li>
</ul>
<p>Let&rsquo;s populate a data file containing 4 records:</p>
<pre tabindex=0><code>19630001     john          lennon
19630002     paul          mccartney
19630003     george        harrison
19630004     ringo         starr

</code></pre><p>Let&rsquo;s call the data file <code>/path/to/dir/names.txt</code>.</p>
<p>In order to make it into an LZO file, we can use the lzop utility and it will create a <code>names.txt.lzo</code> file.</p>
<p>Now copy the file <code>names.txt.lzo</code> to HDFS.</p>
<h2 id=prerequisites>Prerequisites</h2>
<h3 id=lzolzop-installations>Lzo/Lzop Installations</h3>
<p><code>lzo</code> and <code>lzop</code> need to be installed on every node in the Hadoop cluster. The details of these installations are beyond the scope of this document.</p>
<h3 id=core-sitexml><code>core-site.xml</code></h3>
<p>Add the following to your <code>core-site.xml</code>:</p>
<ul>
<li><code>com.hadoop.compression.lzo.LzoCodec</code></li>
<li><code>com.hadoop.compression.lzo.LzopCodec</code></li>
</ul>
<p>For example:</p>
<p><code>&lt;property></code><br>
<code>&lt;name>io.compression.codecs&lt;/name></code><br>
<code>&lt;value>org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.DefaultCodec,org.apache.hadoop.io.compress.BZip2Codec,</code>com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec<code>&lt;/value></code><br>
<code>&lt;/property></code></p>
<p><code>&lt;property></code><br>
<code>&lt;name>io.compression.codec.lzo.class&lt;/name></code><br>
<code>&lt;value></code>com.hadoop.compression.lzo.LzoCodec<code>&lt;/value></code><br>
<code>&lt;/property></code></p>
<p>Next we run the command to create an LZO index file:</p>
<pre tabindex=0><code>hadoop jar /path/to/jar/hadoop-lzo-cdh4-0.4.15-gplextras.jar com.hadoop.compression.lzo.LzoIndexer  /path/to/HDFS/dir/containing/lzo/files

</code></pre><p>This creates <code>names.txt.lzo</code> on HDFS.</p>
<h3 id=table-definition>Table Definition</h3>
<p>The following <code>hive -e</code> command creates an LZO-compressed external table:</p>
<pre tabindex=0><code>hive -e &quot;CREATE EXTERNAL TABLE IF NOT EXISTS hive_table_name (column_1  datatype_1......column_N datatype_N)
         PARTITIONED BY (partition_col_1 datatype_1 ....col_P  datatype_P)
         ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
         STORED AS INPUTFORMAT  \&quot;com.hadoop.mapred.DeprecatedLzoTextInputFormat\&quot;
                   OUTPUTFORMAT \&quot;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\&quot;;

</code></pre><p>Note: The double quotes have to be escaped so that the &lsquo;<code>hive -e</code>&rsquo; command works correctly.</p>
<p>See <a href=#create-table>CREATE TABLE</a> and <a href=https://hive.apache.org/docs/latest/languagemanual-cli_27362033/>Hive CLI</a> for information about command syntax.</p>
<h2 id=hive-queries>Hive Queries</h2>
<h3 id=option-1-directly-create-lzo-files>Option 1: Directly Create LZO Files</h3>
<ol>
<li>Directly create LZO files as the output of the Hive query.</li>
<li>Use <code>lzop</code> command utility or your custom Java to generate <code>.lzo.index</code> for the <code>.lzo</code> files.</li>
</ol>
<p><strong>Hive Query Parameters</strong></p>
<pre tabindex=0><code>SET mapreduce.output.fileoutputformat.compress.codec=com.hadoop.compression.lzo.LzoCodec
SET hive.exec.compress.output=true
SET mapreduce.output.fileoutputformat.compress=true

</code></pre><p>For example:</p>
<pre tabindex=0><code>hive -e &quot;SET mapreduce.output.fileoutputformat.compress.codec=com.hadoop.compression.lzo.LzoCodec; SET hive.exec.compress.output=true;SET mapreduce.output.fileoutputformat.compress=true; &lt;query-string&gt;&quot;

</code></pre><p><em>Note: If the data sets are large or number of output files are large , then this option does not work.</em></p>
<h3 id=option-2-write-custom-java-to-create-lzo-files>Option 2: Write Custom Java to Create LZO Files</h3>
<ol>
<li>Create text files as the output of the Hive query.</li>
<li>Write custom Java code to
<ol>
<li>convert Hive query generated text files to <code>.lzo</code> files</li>
<li>generate <code>.lzo.index</code> files for the <code>.lzo</code> files generated above</li>
</ol>
</li>
</ol>
<p><strong>Hive Query Parameters</strong></p>
<p>Prefix the query string with these parameters:</p>
<pre tabindex=0><code>SET hive.exec.compress.output=false
SET mapreduce.output.fileoutputformat.compress=false

</code></pre><p>For example:</p>
<pre tabindex=0><code>hive -e &quot;SET hive.exec.compress.output=false;SET mapreduce.output.fileoutputformat.compress=false;&lt;query-string&gt;&quot;

</code></pre>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>