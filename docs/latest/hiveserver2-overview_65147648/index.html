<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : HiveServer2 Overview</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
<li>
<form action=/search method=get class=search-bar>
<input type=search name=q id=search-query placeholder=Search... class=search-input>
<button type=submit class=search-button>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--hiveserver2-overview>Apache Hive : HiveServer2 Overview</h1>
<ul>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#hs2-architecture>HS2 Architecture</a>
<ul>
<li><a href=#server>Server</a></li>
<li><a href=#transport>Transport</a></li>
<li><a href=#protocol>Protocol</a></li>
<li><a href=#processor>Processor</a></li>
</ul>
</li>
<li><a href=#dependencies-of-hs2>Dependencies of HS2</a></li>
<li><a href=#jdbc-client>JDBC Client</a></li>
<li><a href=#source-code-description>Source Code Description</a>
<ul>
<li><a href=#server-side>Server Side</a></li>
<li><a href=#client-side>Client Side</a></li>
<li><a href=#interaction-between-client-and-server>Interaction between Client and Server</a></li>
</ul>
</li>
<li><a href=#resources>Resources</a></li>
</ul>
<h1 id=introduction>Introduction</h1>
<p>HiveServer2 (HS2) is a service that enables clients to execute queries against Hive. HiveServer2 is the successor to <a href=https://cwiki.apache.org/confluence/display/Hive/HiveServer>HiveServer1</a> which has been deprecated. HS2 supports multi-client concurrency and authentication. It is designed to provide better support for open API clients like JDBC and ODBC.</p>
<p>HS2 is a single process running as a composite service, which includes the Thrift-based Hive service (TCP or HTTP) and a <a href=http://www.eclipse.org/jetty/>Jetty</a> web server for web UI. </p>
<h1 id=hs2-architecture>HS2 Architecture</h1>
<p>The Thrift-based Hive service is the core of HS2 and responsible for servicing the Hive queries (e.g., from Beeline). <a href=https://thrift.apache.org/>Thrift</a> is an RPC framework for building cross-platform services. Its stack consists of 4 layers: Server, Transport, Protocol, and Processor. You can find more details about the layers at <a href=https://thrift.apache.org/docs/concepts>https://thrift.apache.org/docs/concepts</a>.</p>
<p>The usage of those layers in the HS2 implementation is described below.</p>
<h2 id=server>Server</h2>
<p>HS2 uses a TThreadPoolServer (from Thrift) for TCP mode, or a Jetty server for the HTTP mode. </p>
<p>The TThreadPoolServer allocates one worker thread per TCP connection. Each thread is always associated with a connection even if the connection is idle. So there is a potential performance issue resulting from a large number of threads due to a large number of concurrent connections. In the future HS2 might switch to another server type for TCP mode, for example TThreadedSelectorServer. Here is an <a href=https://github.com/m1ch1/mapkeeper/wiki/Thrift-Java-Servers-Compared>article</a> about a performance comparison between different Thrift Java servers.  </p>
<h2 id=transport>Transport</h2>
<p>HTTP mode is required when a proxy is needed between the client and server (for example, for load balancing or security reasons). That is why it is supported, as well as TCP mode. You can specify the transport mode of the Thrift service through the Hive configuration property <a href=#hive-server2-transport-mode>hive.server2.transport.mode</a>.</p>
<h2 id=protocol>Protocol</h2>
<p>The Protocol implementation is responsible for serialization and deserialization. HS2 is currently using TBinaryProtocol as its Thrift protocol for serialization. In the future other protocols may be considered, such as TCompactProtocol, based on more performance evaluation.</p>
<h2 id=processor>Processor</h2>
<p>Process implementation is the application logic to handle requests. For example, the ThriftCLIService.ExecuteStatement() method implements the logic to compile and execute a Hive query.</p>
<h1 id=dependencies-of-hs2>Dependencies of HS2</h1>
<ul>
<li><a href=https://hive.apache.org/docs/latest/adminmanual-metastore-administration_27362076/>Metastore</a><br>
The metastore can be configured as embedded (in the same process as HS2) or as a remote server (which is a Thrift-based service as well). HS2 talks to the metastore for the metadata required for query compilation.</li>
<li>Hadoop cluster<br>
HS2 prepares physical execution plans for various execution engines (MapReduce/Tez/Spark) and submits jobs to the Hadoop cluster for execution.</li>
</ul>
<p>You can find a diagram of the interactions between HS2 and its dependencies <a href=#here>here</a>.</p>
<h1 id=jdbc-client>JDBC Client</h1>
<p>The JDBC driver is recommended for the client side to interact with HS2. Note that there are some use cases (e.g., <a href=http://gethue.com/>Hadoop Hue</a>) where the Thrift client is used directly and JDBC is bypassed.</p>
<p>Here is a sequence of API calls involved to make the first query:</p>
<ul>
<li>The JDBC client (e.g., Beeline) creates a HiveConnection by initiating a transport connection (e.g., TCP connection) followed by an OpenSession API call to get a SessionHandle. The session is created from the server side.</li>
<li>The HiveStatement is executed (following JDBC standards) and an ExecuteStatement API call is made from the Thrift client. In the API call, SessionHandle information is passed to the server along with the query information.</li>
<li>The HS2 server receives the request and asks the driver (which is a CommandProcessor) for query parsing and compilation. The driver kicks off a background job that will talk to Hadoop and then immediately returns a response to the client. This is an asynchronous design of the ExecuteStatement API. The response contains an OperationHandle created from the server side.</li>
<li>The client uses the OperationHandle to talk to HS2 to poll the status of the query execution.</li>
</ul>
<h1 id=source-code-description>Source Code Description</h1>
<p>The following sections help you locate some basic components of HiveServer2 in the source code.</p>
<h2 id=server-side>Server Side</h2>
<ul>
<li><strong>Thrift IDL file for TCLIService</strong>: <a href=https://github.com/apache/hive/blob/master/service-rpc/if/TCLIService.thrift>https://github.com/apache/hive/blob/master/service-rpc/if/TCLIService.thrift</a>.</li>
<li><strong>TCL<strong><strong>IService</strong></strong>.Iface implemented by</strong>: <em>org.apache.hive.service.cli.thrift.ThriftCLIService</em> class.</li>
<li><strong>ThriftCLIService subclassed by</strong>: <em>org.apache.hive.service.cli.thrift.ThriftBinaryCLIService</em>and <em>org.apache.hive.service.cli.thrift.ThriftHttpCLIService</em> for TCP mode and HTTP mode respectively*.*</li>
<li><strong>org.apache.hive.service.cli.thrift.EmbeddedThriftBinaryCLIService class:</strong> Embedded mode for HS2. Don&rsquo;t get confused with embedded metastore, which is a different service (although the embedded mode concept is similar).</li>
<li><strong>org.apache.hive.service.cli.session.HiveSessionImpl class</strong>: Instances of this class are created on the server side and managed by an <em>org.apache.accumulo.tserver.TabletServer.SessionManager</em> instance*.*</li>
<li><strong>org.apache.hive.service.cli.operation.Operation class</strong>: Defines an operation (e.g., a query). Instances of this class are created on the server and managed by an <em>org.apache.hive.service.cli.operation.OperationManager</em> instance*.*</li>
<li><strong>org.apache.hive.service.auth.HiveAuthFactory class</strong>: A helper used by both HTTP and TCP mode for authentication. Refer to <a href=https://hive.apache.org/docs/latest/setting-up-hiveserver2_30758712/>Setting Up HiveServer2</a> for various authentication options, in particular <a href=#authentication/security-configuration>Authentication/Security Configuration</a> and <a href=#cookie-based-authentication>Cookie Based Authentication</a>.</li>
</ul>
<h2 id=client-side>Client Side</h2>
<ul>
<li><strong>org.apache.hive.jdbc.HiveConnection class</strong>:**** Implements the<em>java.sql.Connection</em> interface (part of JDBC*)**.* An instance of this class holds a reference to a <em>SessionHandle</em> instance which is retrieved when making Thrift API calls to the server*.*</li>
<li><strong>org.apache.hive.jdbc.HiveStatement class:</strong> Implements the <em>java.sql.Statement</em> interface (part of JDBC). The client (e.g., Beeline) calls the <em>HiveStatement.execute()</em> method for the query. Inside the <em>execute</em>() method, the Thrift client is used to make API calls.</li>
<li><strong>org.apache.hive.jdbc.HiveDriver class</strong>: Implements the <em>java.sql.Driver</em> interface (part of JDBC)<em>.</em> The core method is <em>connect</em>() which is used by the JDBC client to initiate a SQL connection.</li>
</ul>
<h2 id=interaction-between-client-and-server>Interaction between Client and Server</h2>
<ul>
<li>**org.apache.hive.service.cli.SessionHandle class:<em><em>Session identifier.Instances of this class are returned from the server and used by the client as input for Thrift API calls</em>.</em></li>
<li><strong>org.apache.hive.service.cli.OperationHandle class</strong>: Operation identifier. Instances of this class are returned from the server and used by the client to poll the execution status of an operation.</li>
</ul>
<h1 id=resources>Resources</h1>
<p>How to set up HS2: <a href=https://hive.apache.org/docs/latest/setting-up-hiveserver2_30758712/>Setting Up HiveServer2</a></p>
<p>HS2 clients: <a href=https://hive.apache.org/docs/latest/hiveserver2-clients_30758725/>HiveServer2 Clients</a></p>
<p>User interface:  <a href=#web-ui-for-hiveserver2>Web UI for HiveServer2</a></p>
<p>Metrics:  <a href=https://hive.apache.org/docs/latest/hive-metrics_65872987/>Hive Metrics</a></p>
<p>Cloudera blog on HS2: <a href=http://blog.cloudera.com/blog/2013/07/how-hiveserver2-brings-security-and-concurrency-to-apache-hive/>http://blog.cloudera.com/blog/2013/07/how-hiveserver2-brings-security-and-concurrency-to-apache-hive/</a></p>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>