<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : HiveDeveloperFAQ</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css>
<link href=https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC crossorigin=anonymous>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://hive.apache.org> <img src=https://hive.apache.org/images/hive.svg width=60 height=35 alt="Apache Software Foundation"></a>
<a class="header-text navbar-brand" href=https://hive.apache.org>Apache Hive</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a class=nav-link href=/general/downloads id=navbarDropdown role=button aria-expanded=false>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/DesignDocs>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing>Precommit Patch Testing</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/BecomingACommitter>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToContribute>How To Contribute</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Home#Home-ResourcesforContributors>Resources for Contributors</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/Bylaws>By Laws</a></li>
<li><a class=dropdown-item href=https://cwiki.apache.org/confluence/display/Hive/HowToRelease>How To Release</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class=nav-link href=https://hive.blog.apache.org/ id=navbarDropdown role=button aria-expanded=false>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=navbarDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<h1 id=apache-hive--hivedeveloperfaq>Apache Hive : HiveDeveloperFAQ</h1>
<h1 id=hive-developer-faq>Hive Developer FAQ</h1>
<ul>
<li><a href=#hive-developer-faq>Hive Developer FAQ</a>
<ul>
<li><a href=#developing>Developing</a>
<ul>
<li><a href=#how-do-i-move-some-files>How do I move some files?</a></li>
<li><a href=#how-do-i-add-a-new-minidriver-test>How do I add a new MiniDriver test?</a></li>
</ul>
</li>
<li><a href=#building>Building</a>
<ul>
<li><a href=#maven-settings>Maven settings</a></li>
<li><a href=#how-to-build-all-source>How to build all source?</a></li>
<li><a href=#how-do-i-import-into-eclipse>How do I import into Eclipse?</a></li>
<li><a href=#how-to-generate-tarball>How to generate tarball?</a></li>
<li><a href=#how-to-generate-protobuf-code>How to generate protobuf code?</a></li>
<li><a href=#how-to-generate-thrift-code>How to generate Thrift code?</a></li>
<li><a href=#how-to-run-findbugs-after-a-change?>How to run findbugs after a change?</a></li>
<li><a href=#how-to-compile-odbc>How to compile ODBC?</a></li>
<li><a href=#how-do-i-publish-hive-artifacts-to-my-local-maven-repository>How do I publish Hive artifacts to my local Maven repository?</a></li>
</ul>
</li>
<li><a href=#testing>Testing</a>
<ul>
<li><a href=#how-do-i-run-precommit-tests-on-a-patch>How do I run precommit tests on a patch?</a></li>
<li><a href=#how-do-i-rerun-precommit-tests-over-the-same-patch>How do I rerun precommit tests over the same patch?</a></li>
<li><a href=#how-do-i-run-a-single-test>How do I run a single test?</a></li>
<li><a href=#how-do-i-run-all-of-the-unit-tests>How do I run all of the unit tests?</a></li>
<li><a href=#how-do-i-run-all-of-the-unit-tests-except-for-a-certain-few-tests>How do I run all of the unit tests except for a certain few tests?</a></li>
<li><a href=#how-do-i-run-the-clientpositiveclientnegative-unit-tests>How do I run the clientpositive/clientnegative unit tests?</a></li>
<li><a href=#how-do-i-run-with-postgremysqloracle>How do I run with Postgre/MySQL/Oracle?</a></li>
<li><a href=#how-do-i-remote-debug-a-qtest>How do I remote debug a qtest?</a></li>
<li><a href=#how-do-i-modify-the-init-script-when-testing>How do I modify the init script when testing?</a></li>
<li><a href=#how-do-i-update-the-output-of-a-clidriver-testcase>How do I update the output of a CliDriver testcase?</a></li>
<li><a href=#how-do-i-update-the-results-of-many-test-cases>How do I update the results of many test cases?</a></li>
<li><a href=#where-is-the-log-output-of-a-test>Where is the log output of a test?</a></li>
<li><a href=#how-do-i-add-a-test-case>How do I add a test case?</a></li>
<li><a href=#why-isnt-the-itests-pom-connected-to-the-root-pom>Why isn&rsquo;t the itests pom connected to the root pom?</a></li>
<li><a href=#why-does-a-test-fail-with-a-nullpointerexception-in-minidfscluster>Why does a test fail with a NullPointerException in MiniDFSCluster?</a></li>
<li><a href=#why-do-spark-unit-tests-fail-with-a-securityexception>Why do Spark unit tests fail with a SecurityException?</a></li>
</ul>
</li>
<li><a href=#debugging>Debugging</a>
<ul>
<li><a href=#how-do-i-debug-into-a-single-test-in-eclipse?>How do I debug into a single test in Eclipse?</a></li>
<li><a href=#how-do-i-debug-my-queries-in-hive>How do I debug my queries in Hive?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Maven</p>
<p>Run the test and generate the output file using the appropriate <code>-Dtest</code>Hive is using <a href=#maven>Maven</a> as its build tool. Versions prior to 0.13 were using Ant.</p>
<h2 id=developing>Developing</h2>
<h3 id=how-do-i-move-some-files>How do I move some files?</h3>
<p>Post a patch for testing purposes which simply does add and deletes. SVN will not understand these patches are actually moves, therefore you should actually upload the following, <strong>in order</strong> so the last upload is the patch for testing purposes:</p>
<ol>
<li>A patch which has only the non-move changes for commit e.g. HIVE-XXX-for-commit.patch</li>
<li>A script of of commands required to make the moves HIVE-XXX-moves.sh</li>
<li>A patch for testing purposes HIVE-XXX.patch</li>
</ol>
<p>The script should be a set of <code>svn mv</code> commands along with any <code>perl</code> commands required for find/replace. For example:</p>
<pre tabindex=0><code>$ svn mv MyCLass.java MyClass.java
$ perl -i -pe 's&lt;at:var at:name=&quot;MyCLass&quot; /&gt;MyClass@g' MyClass.java

</code></pre><h3 id=how-do-i-add-a-new-minidriver-test>How do I add a new MiniDriver test?</h3>
<p>See <a href=https://hive.apache.org/docs/latest/minidriver-tests_38571221/>MiniDriver Tests</a> for information about MiniDriver and Beeline tests.</p>
<p>For FAQ about how to run tests, see <a href=#testing>Testing</a> below.</p>
<h2 id=building>Building</h2>
<ul>
<li>See <a href=https://cwiki.apache.org/confluence/display/Hive/GettingStarted#GettingStarted-BuildingHivefromSource>Getting Started: Building Hive from Source</a> for detailed information about building Hive releases 0.13 and later with <a href=http://maven.apache.org/>Maven</a>.</li>
<li>See <a href=https://cwiki.apache.org/confluence/display/Hive/AdminManual+Installation#AdminManualInstallation-InstallingfromSourceCode(Hive0.12.0andEarlier)>Installing from Source Code (Hive 0.12.0 and Earlier)</a> for detailed information about building Hive 0.12 and earlier with <a href=http://ant.apache.org/>Ant</a>.</li>
</ul>
<h3 id=maven-settings>Maven settings</h3>
<p>You might have to set the following Maven options on certain systems to get build working: Set MAVEN_OPTS to &ldquo;-Xmx2g -XX:MaxPermSize=256M&rdquo;.</p>
<h3 id=how-to-build-all-source>How to build all source?</h3>
<p>The way Maven is set up differs between the master branch and branch-1.  In branch-1, since both Hadoop 1.x and 2.x are supported, you need to specify whether you want to build Hive against Hadoop 1.x or 2.x.  This is done via Maven profiles.  There is a profile for each version of Hadoop, <code>hadoop-1</code> and <code>hadoop-2</code>.  For most Maven operations one of these profiles needs to be specified or the build will fail.</p>
<p>In master, only Hadoop 2.x is supported, thus there is no need to specify a Maven profile for most build operations.</p>
<p>In master:</p>
<pre tabindex=0><code>mvn clean install -DskipTests
cd itests 
mvn clean install -DskipTests
</code></pre><p>In branch-1, MVN:</p>
<pre tabindex=0><code>mvn clean install -DskipTests -Phadoop-2
cd itests 
mvn clean install -DskipTests -Phadoop-2

</code></pre><p>To build against Hadoop 1.x, switch the above to <code>-Phadoop-1</code>.</p>
<p>For the remainder of this page we will assume master and not show the profiles.  However, if you are working on branch-1 remember that you will need to add in the appropriate profile.</p>
<h3 id=how-do-i-import-into-eclipse>How do I import into Eclipse?</h3>
<p>Build and generate <a href=https://www.eclipse.org/users/>Eclipse</a> files (the conservative method).</p>
<p>For master – without using a local Maven repository: </p>
<pre tabindex=0><code>$ mkdir workspace
$ cd workspace
$ git clone https://github.com/apache/hive.git
$ cd hive
$ mvn clean package eclipse:clean eclipse:eclipse -Pitests -DskipTests -DdownloadSources -DdownloadJavadocs

</code></pre><p>NOTE: The presence of the <strong>package</strong> target is crucial in successfully generating the project files.</p>
<p>NOTE: It is recommended to wipe out or rename the <em>org/apache/hive</em> subtree of the local m2 repository prior to generating the project files; and you may want to check after its execution that it does not contain any files – if it does contain something, then your project files may not be fully independent of downloaded Maven artifacts.</p>
<p>This will work on all branches; but keep in mind that in this case you are installing the Hive artifacts into your local repository.</p>
<pre tabindex=0><code>$ mkdir workspace
$ cd workspace
$ git clone https://github.com/apache/hive.git
$ cd hive
$ mvn clean install -DskipTests
$ mvn eclipse:clean
$ mvn eclipse:eclipse -DdownloadSources -DdownloadJavadocs
$ cd itests
$ mvn clean install -DskipTests
$ mvn eclipse:clean
$ mvn eclipse:eclipse -DdownloadSources -DdownloadJavadocs

</code></pre><p>In Eclipse define M2_REPO in Preferences -> Java -> Build Path -> Classpath Variables to either:</p>
<p><strong>Mac Example</strong></p>
<pre tabindex=0><code>/Users/$USER/.m2/repository

</code></pre><p><strong>Linux Example</strong></p>
<pre tabindex=0><code>/home/$USER/.m2/repository

</code></pre><p><strong>Windows Example</strong></p>
<pre tabindex=0><code>C:/users/$USER/.m2/repository

</code></pre><p>Then import the workspaces. If you get an error about &ldquo;restricted use of Signal&rdquo; for Beeline and CLI, follow <a href=http://stackoverflow.com/questions/860187/access-restriction-on-class-due-to-restriction-on-required-library-rt-jar>these instructions</a>.</p>
<p>Note that if you use the Hive git base directory as the Eclipse workspace, then it does not pick the right project names (for example, picks &lsquo;ant&rsquo; instead of &lsquo;hive-ant&rsquo;). Therefore it&rsquo;s recommended to have the workspace directory one up from the git directory. For example workspaces/<em>hive-workspace</em>/<em>hive</em> where <em>hive-workspace</em> is the Eclipse workspace and <em>hive</em> is the git base directory.</p>
<h3 id=how-to-generate-tarball>How to generate tarball?</h3>
<pre tabindex=0><code>mvn clean package -DskipTests -Pdist

</code></pre><p>It will then be located in the packaging/target/ directory.</p>
<h3 id=how-to-generate-protobuf-code>How to generate protobuf code?</h3>
<pre tabindex=0><code>cd ql
mvn clean install -DskipTests -Pprotobuf

</code></pre><h3 id=how-to-generate-thrift-code>How to generate Thrift code?</h3>
<pre tabindex=0><code>mvn clean install -Pthriftif -DskipTests -Dthrift.home=/usr/local
</code></pre><p>Don’t forget to update <code>hive_metastore.proto</code> when changing  `hive_metastore.thrift</p>
<h2 id=httpsissuesapacheorgjirasecureviewavatarsizexsmallavatarid21141avatartypeissuetypehive-26769httpsissuesapacheorgjirabrowsehive-26769srcconfmacro><a href="https://issues.apache.org/jira/browse/HIVE-26769?src=confmacro"><img src="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype" alt>HIVE-26769</a></h2>
<p>[TRACKING] gRPC support for Hive metastore
Open`### How to run findbugs after a change?</p>
<pre tabindex=0><code>mvn site -Pfindbugs 
</code></pre><p>Note:  Available in Hive 1.1.0 onward (see <a href=https://issues.apache.org/jira/browse/HIVE-8327>HIVE-8327</a>).</p>
<h3 id=how-to-compile-odbc>How to compile ODBC?</h3>
<pre tabindex=0><code>cd odbc
mvn compile -Podbc -Dthrift.home=/usr/local -Dboost.home=/usr/local

</code></pre><h3 id=how-do-i-publish-hive-artifacts-to-my-local-maven-repository>How do I publish Hive artifacts to my local Maven repository?</h3>
<pre tabindex=0><code>mvn clean install -DskipTests
cd itests 
mvn clean install -DskipTests

</code></pre><h2 id=testing>Testing</h2>
<p>For general information, see <a href=#unit-tests-and-debugging>Unit Tests and Debugging</a> in the Developer Guide.</p>
<h3 id=how-do-i-run-precommit-tests-on-a-patch>How do I run precommit tests on a patch?</h3>
<p>Hive precommit testing is triggered automatically when a file is uploaded to the JIRA ticket:</p>
<ol>
<li>Attach the patch file to a JIRA ticket: in the ticket&rsquo;s &ldquo;More&rdquo; tab, select &ldquo;Attach Files&rdquo; and use &ldquo;Choose File&rdquo; to upload the file, then add a descriptive comment.</li>
<li>Put the patch in the review queue: click the &ldquo;Submit Patch&rdquo; button. The button name will change to &ldquo;Cancel Patch&rdquo; and the ticket status will change to Patch Available.</li>
</ol>
<p>See <a href=https://hive.apache.org/docs/latest/hive-precommit-patch-testing_33295252/>Hive PreCommit Patch Testing</a> for more detail.</p>
<h3 id=how-do-i-rerun-precommit-tests-over-the-same-patch>How do I rerun precommit tests over the same patch?</h3>
<p>For patch updates, our convention is to number them like HIVE-1856.1.patch, HIVE-1856.2.patch, etc. And then click the &ldquo;Submit Patch&rdquo; button again when a new one is uploaded; this makes sure it gets back into the review queue.</p>
<h3 id=how-do-i-run-a-single-test>How do I run a single test?</h3>
<p>ITests</p>
<p>Note that any test in the itests directory needs to be executed from within the itests directory. The pom is disconnected from the parent project for technical reasons.Single test class:</p>
<pre tabindex=0><code>mvn test -Dtest=ClassName

</code></pre><p>Single test method:</p>
<pre tabindex=0><code>mvn test -Dtest=ClassName#methodName

</code></pre><p>Note that a pattern can also be supplied to -Dtests to run multiple tests matching the pattern:</p>
<pre tabindex=0><code>mvn test -Dtest='org.apache.hive.beeline.*' 
</code></pre><p>For more usage see the documentation for the <a href=http://maven.apache.org/surefire/maven-surefire-plugin/>Maven Surefire Plugin</a>.</p>
<h3 id=how-do-i-run-all-of-the-unit-tests>How do I run all of the unit tests?</h3>
<pre tabindex=0><code>mvn test 
cd itests 
mvn test 

</code></pre><p>Note that you need to have previously built and installed the jars:</p>
<pre tabindex=0><code>mvn clean install -DskipTests 
cd itests 
mvn clean install -DskipTests 

</code></pre><h3 id=how-do-i-run-all-of-the-unit-tests-except-for-a-certain-few-tests>How do I run all of the unit tests except for a certain few tests?</h3>
<p>Similar to running all tests, but define test.excludes.additional to specify a test/pattern to exclude from the test run. For example the following will run all tests except for the CliDriver tests:</p>
<pre tabindex=0><code>cd itests 
mvn test -Dtest.excludes.additional='**/Test*CliDriver.java' 
</code></pre><h3 id=how-do-i-run-the-clientpositiveclientnegative-unit-tests>How do I run the clientpositive/clientnegative unit tests?</h3>
<p>All of the below require that you have previously run <code>ant package</code>.</p>
<p>To run clientpositive tests</p>
<pre tabindex=0><code>cd itests/qtest
mvn test -Dtest=TestCliDriver 
</code></pre><p>To run a single clientnegative test alter1.q</p>
<pre tabindex=0><code>cd itests/qtest
mvn test -Dtest=TestNegativeCliDriver -Dqfile=alter1.q 
</code></pre><p>To run all of the clientpositive tests that match a regex, for example the partition_wise_fileformat tests</p>
<pre tabindex=0><code>cd itests/qtest
mvn test -Dtest=TestCliDriver -Dqfile\_regex=partition\_wise\_fileformat.* 

# Alternatively, you can specify comma separated list with &quot;-Dqfile&quot; argument
mvn test -Dtest=TestMiniLlapLocalCliDriver -Dqfile='vectorization\_0.q,vectorization\_17.q,vectorization\_8.q'
</code></pre><p>To run a single contrib test alter1.q and overwrite the result file</p>
<pre tabindex=0><code>cd itests/qtest
mvn test -Dtest=TestContribCliDriver -Dqfile=alter1.q -Dtest.output.overwrite=true 
</code></pre><h3 id=how-do-i-run-with-postgremysqloracle>How do I run with Postgre/MySQL/Oracle?</h3>
<p>To run test test with a specified DB it is possible by adding &ldquo;-Dtest.metastore.db&rdquo; parameter like in the following commands:</p>
<pre tabindex=0><code>mvn test -Pitests -pl itests/qtest -Dtest=TestCliDriver -Dqfile=partition\_params\_postgres.q -Dtest.metastore.db=postgres

mvn test -Pitests -pl itests/qtest -Dtest=TestCliDriver -Dqfile=partition\_params\_postgres.q -Dtest.metastore.db=mssql
mvn test -Pitests -pl itests/qtest -Dtest=TestCliDriver -Dqfile=partition\_params\_postgres.q -Dtest.metastore.db=mysql
mvn test -Pitests -pl itests/qtest -Dtest=TestCliDriver -Dqfile=partition\_params\_postgres.q -Dtest.metastore.db=oracle -Ditest.jdbc.jars=/path/to/your/god/damn/oracle/jdbc/driver/ojdbc6.jar
</code></pre><p>Without specifying -Dqfile it will run all .q files .</p>
<h3 id=how-do-i-remote-debug-a-qtest>How do I remote debug a qtest?</h3>
<pre tabindex=0><code>cd itests/qtest
mvn -Dmaven.surefire.debug=&quot;-Xdebug -Xrunjdwp:transport=dt\_socket,server=y,suspend=y,address=8000 -Xnoagent -Djava.compiler=NONE&quot; test -Dtest=TestCliDriver -Dqfile=&lt;test&gt;.q
</code></pre><h3 id=how-do-i-modify-the-init-script-when-testing>How do I modify the init script when testing?</h3>
<p>The option to skip the init script or supply a custom init script was added in Hive 2.0 (see <a href=https://issues.apache.org/jira/browse/HIVE-11538>HIVE-11538</a>).</p>
<p>To skip initialization:</p>
<pre tabindex=0><code>mvn test -Dtest=TestCliDriver -Phadoop-2 -Dqfile=test\_to\_run.q  -DinitScript=
</code></pre><p>To supply a custom script:</p>
<pre tabindex=0><code>mvn test -Dtest=TestCliDriver -Phadoop-2 -Dtest.output.overwrite=true -Dqfile=test\_to\_run.q  -DinitScript=custom\_script.sql
</code></pre><h3 id=how-do-i-update-the-output-of-a-clidriver-testcase>How do I update the output of a CliDriver testcase?</h3>
<pre tabindex=0><code>cd itests/qtest
mvn test -Dtest=TestCliDriver -Dqfile=alter1.q -Dtest.output.overwrite=true 

</code></pre><h3 id=how-do-i-update-the-results-of-many-test-cases>How do I update the results of many test cases?</h3>
<p>Assume that you have a file like below which you&rsquo;d like to re-generate output files for. Such a file could be created by copying the output from the precommit tests.</p>
<pre tabindex=0><code>head -2 /tmp/failed-TestCliDriver-file-tests
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver\_allcolref\_in\_udf
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver\_annotate\_stats\_join
</code></pre><p>You can re-generate all those output files in batches of 20 with the command below</p>
<pre tabindex=0><code>egrep 'TestCliDriver' /tmp/failed-TestCliDriver-file-tests | perl -pe 's@.*testCliDriver\_@@g' | awk '{print $1 &quot;.q&quot;}' | xargs -n 30 | perl -pe 's@ @,@g' | xargs -I{} mvn test -Dtest=TestCliDriver -Dtest.output.overwrite=true -Dqfile={}
</code></pre><p>To do the same from the output of a precommit result, with multiple drivers, you can do</p>
<pre tabindex=0><code>import re
from itertools import groupby
s = &quot;&quot;&quot;
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[drop\_with\_concurrency] (batchId=231)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[comments] (batchId=35)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector\_if\_expr] (batchId=141)
&quot;&quot;&quot;
PAT = re.compile(&quot;org.apache.hadoop.hive.cli.([^\.]*).*\[([^\]]*).*&quot;)
l = [PAT.match(x.strip()) for x in s.split(&quot;\n&quot;) if x.strip()]
for driver,q in groupby(sorted([a.groups() for a in l if a]), key=lambda a:a[0]):
	print &quot;&quot;&quot;mvn clean test -Dtest=%s '-Dqfile=%s' -Dtest.output.overwrite=true&quot;&quot;&quot; % (driver, &quot;,&quot;.join([&quot;%s.q&quot; % a[1] for a in q]))

</code></pre><h3 id=where-is-the-log-output-of-a-test>Where is the log output of a test?</h3>
<p>Logs are put in a couple locations:</p>
<ul>
<li>
<pre tabindex=0><code></code></pre></li>
</ul>
<p>From the root of the source tree: find . -name hive.log</p>
<pre tabindex=0><code>* ```
/tmp/$USER/ (Linux) or $TMPDIR/$USER/ (MacOS)
</code></pre><p>See <a href=#hive-logging>Hive Logging</a> for details about log files, including alternative configurations.</p>
<h3 id=how-do-i-add-a-test-case>How do I add a test case?</h3>
<p>First, add the test case to the qfile test suite:</p>
<ul>
<li>Copy the test to a new file under <code>ql/src/test/queries/clientpositive/&lt;filename>.q</code> (or <code>/clientnegative</code> if it is a negative test).
<ul>
<li>If the new test creates any table, view, function, etc., make sure that the name is unique across tests. For instance, name a table in the test file <code>foo.q</code>, <code>foo_t1</code> instead of simply <code>t1</code>. This will help reduce flakiness in the test runs, since Jenkins will run tests and batches, and currently it does not restore to former state after running each of the q files.</li>
<li>If there is any interaction with file system, use unique folders for the test to avoid any collision with other tests.</li>
</ul>
</li>
<li>Add the <code>&lt;filename.q></code> to <code>itests/src/test/resources/testconfiguration.properties</code> to the appropriate variable (ex. <code>minimr.query.files</code>).</li>
</ul>
<p>Next, generate the golden (output) file the first time you run the test case:</p>
<ul>
<li>Compile the Hive source from the top level Hive directory:</li>
</ul>
<pre tabindex=0><code>mvn clean install -DskipTests
</code></pre><ul>
<li>Compile the itests:</li>
</ul>
<pre tabindex=0><code>cd itests
mvn clean install -DskipTests
</code></pre><ul>
<li>Run the test and generate the output file using the appropriate <code>-Dtest</code> (ex. <code>TestCliDriver</code>; see <code>itests/qtest/pom.xml</code> for the names of other test suites):</li>
</ul>
<pre tabindex=0><code>cd qtest
mvn test -Dtest=TestCliDriver -Dqfile=&lt;filename&gt;.q -Dtest.output.overwrite=true
</code></pre><ul>
<li>Add your output file to <code>ql/src/test/results/clientpositive/&lt;filename>.q.out</code> (or <code>/clientnegative</code> if it is a negative test).</li>
</ul>
<p>With the above steps, you can <a href=#create-a-patch>create a patch</a> which has a <code>.java</code> file, a <code>.q</code> file and a <code>.q.out</code> file.</p>
<h3 id=why-isnt-the-itests-pom-connected-to-the-root-pom>Why isn&rsquo;t the itests pom connected to the root pom?</h3>
<p>It would be great to have it connected, but it would make it harder to use <strong>mvn test</strong> locally. The best option would be to utilize the failsafe plugin for integration testing; but it needs a bit different setup, and it&rsquo;s harder to use for now&mldr;. If you&rsquo;d like to give that a try, by all means, go ahead.</p>
<p>There is an option to attach all the itest subprojects to the main project by enabling this with <strong>-Pitests</strong> (<a href=https://issues.apache.org/jira/browse/HIVE-13490>HIVE-13490</a>).</p>
<p>There are some good and bad sides using this, it&rsquo;s introduced as a profile to clearly communicate that the integration tests are attached to the main project.</p>
<p>The good side is that you may freely use <strong>-Pitests</strong> to run integration tests from the root project without the need of <strong>mvn install</strong>.</p>
<pre tabindex=0><code>mvn test -q -Pitests -Dtest=TestCliDriver -Dqtest=sample2.q
</code></pre><p>The bad side is that a simple <strong>mvn test -Pitests</strong>will start executing all integration tests.</p>
<h3 id=why-does-a-test-fail-with-a-nullpointerexception-in-minidfscluster>Why does a test fail with a NullPointerException in MiniDFSCluster?</h3>
<p>If any test fails with the error below it means you have an inappropriate umask setting. It should be set to 0022.</p>
<pre tabindex=0><code>java.lang.NullPointerException: null
    at org.apache.hadoop.hdfs.MiniDFSCluster.startDataNodes(MiniDFSCluster.java:426)
    at org.apache.hadoop.hdfs.MiniDFSCluster.&lt;init&gt;(MiniDFSCluster.java:284)
    at org.apache.hadoop.hdfs.MiniDFSCluster.&lt;init&gt;(MiniDFSCluster.java:124)

</code></pre><h3 id=why-do-spark-unit-tests-fail-with-a-securityexception>Why do Spark unit tests fail with a SecurityException?</h3>
<p>If you get the following errors in the unit tests:</p>
<pre tabindex=0><code>2016-01-07T09:51:49,365 ERROR [Driver[]]: spark.SparkContext (Logging.scala:logError(96)) - Error initializing SparkContext.
java.lang.SecurityException: class &quot;javax.servlet.FilterRegistration&quot;'s signer information does not match signer information of other classes in the same package

</code></pre><p>It happens because there are two conflicting versions of the same classes &ldquo;javax.servlet:servlet-api&rdquo; and &ldquo;org.eclipse.jetty.orbit:javax-servlet&rdquo;. Spark requires the eclipse version, but most tools including Hadoop and Jetty depend on the javax one. To avoid this problem, we need to exclude the javax version everywhere it comes up. Fortunately, maven has a tool to do that with:</p>
<pre tabindex=0><code>mvn dependency:tree -Dverbose
</code></pre><p>which prints out the dependency tree. Go to each directory with the failing unit tests and search the dependency tree for  &ldquo;javax.servlet:servlet-api&rdquo; and use exclusions in the pom.xml to remove it. See <a href=https://issues.apache.org/jira/browse/HIVE-12783>HIVE-12783</a> for an example.</p>
<h2 id=debugging>Debugging</h2>
<h3 id=how-do-i-debug-into-asingle-testin-eclipse>How do I debug into a single test in Eclipse?</h3>
<p>You can debug into a single JUnit test in <a href=https://www.eclipse.org/users/>Eclipse</a> by first making sure you&rsquo;ve built the Eclipse files and imported the project into Eclipse as described <a href=#here>here</a>. Then set one or more breakpoints, highlight the method name of the JUnit test method you want to debug into, and do <code>Run->Debug</code>.</p>
<p>Another useful method to debug these tests is to attach a remote debugger. When you run the test, enable the debug mode for surefire by passing in &ldquo;<code>-Dmaven.surefire.debug</code>&rdquo;. Additional details on how to turning on debugging for surefire can be found <a href=http://maven.apache.org/surefire/maven-surefire-plugin/examples/debugging.html>here</a>. Now when you run the tests, it will wait with a message similar to</p>
<pre tabindex=0><code>Listening for transport dt\_socket at address: 5005
</code></pre><p>Note that this assumes that you are still using the default port 5005 for surefire. Otherwise you might see a different port. Once you see this message, in Eclipse right click on the project you want to debug, go to &ldquo;Debug As -> Debug Configurations -> Remote Java Application&rdquo; and hit the &ldquo;+&rdquo; sign on far left top. This should bring up a dialog box. Make sure that the host is &ldquo;localhost&rdquo; and the port is &ldquo;5005&rdquo;. Before you start debugging, make sure that you have set appropriate debug breakpoints in the code. Once ready, hit &ldquo;Debug&rdquo;. Now if you go back to the terminal, you should see the tests running and they will stop at the breakpoints that you set for debugging.</p>
<h3 id=how-do-i-debug-my-queries-in-hive>How do I debug my queries in Hive?</h3>
<p>You can also interactively debug your queries in Hive by attaching a remote debugger. To do so, start <a href=#beeline>Beeline</a> with the &ldquo;<code>--debug</code>&rdquo; option.</p>
<pre tabindex=0><code>$ beeline --debug
Listening for transport dt\_socket at address: 8000
</code></pre><p>Once you see this message, in Eclipse right click on the project you want to debug, go to &ldquo;Debug As -> Debug Configurations -> Remote Java Application&rdquo; and hit the &ldquo;+&rdquo; sign on far left top. This should bring up a dialog box. Make sure that the host is the host on which the Beeline CLI is running and the port is &ldquo;8000&rdquo;. Before you start debugging, make sure that you have set appropriate debug breakpoints in the code. Once ready, hit &ldquo;Debug&rdquo;. The remote debugger should attach to Beeline and proceed.</p>
<pre tabindex=0><code>$ beeline --debug
Listening for transport dt\_socket at address: 8000
Beeline version 1.2.0 by Apache Hive
beeline&gt;
</code></pre><p>At this point, run your queries as normal and it should stop at the breakpoints that you set so that you can start debugging.</p>
<p>This method should work great if your queries are simple fetch queries that do not kick off MapReduce jobs. If a query runs in a distributed mode, it becomes very hard to debug. Therefore, it is advisable to run in a &ldquo;local&rdquo; mode for debugging. In order to run Hive in local mode, do the following:</p>
<p><strong>MRv1:</strong></p>
<pre tabindex=0><code>SET mapred.job.tracker=local
</code></pre><p><strong>MRv2 (YARN):</strong></p>
<pre tabindex=0><code>SET mapreduce.framework.name=local
</code></pre><p>At this point, attach the remote debugger as mentioned before to start debugging your queries.</p>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js integrity=sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM crossorigin=anonymous></script>
</body>
</html>