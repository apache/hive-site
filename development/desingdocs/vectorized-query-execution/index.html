<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : Vectorized Query Execution</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu class=main-menu>
<nav class="navbar navbar-expand-lg navbar-dark">
<div class=container-fluid>
<div class=navbar-brand-wrapper>
<a href=https://hive.apache.org class=navbar-logo>
<img src=https://hive.apache.org/images/hive.svg width=50 height=30 alt="Apache Hive Logo">
</a>
<a class=navbar-brand href=https://hive.apache.org>Apache Hive</a>
</div>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto">
<li class=nav-item>
<a class=nav-link href=https://hive.apache.org/general/downloads>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=docsDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=docsDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/latest/language/languagemanual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=generalDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=generalDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
<li><a class=dropdown-item href=/general/poweredby/>Powered by</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=devDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=devDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/desingdocs/>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/resources/hivedeveloperfaq>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=communityDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=communityDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/resources/howtocontribute>How To Contribute</a></li>
<li><a class=dropdown-item href=/community/resources/>Resources</a></li>
<li><a class=dropdown-item href=/community/meetings/>Meetings</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li><hr class=dropdown-divider></li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=/community/resources/howtorelease/>How To Release</a></li>
</ul>
</li>
<li class=nav-item>
<a class=nav-link href=https://hive.blog.apache.org/>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=asfDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=asfDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
</ul>
<div class=navbar-search>
<form action=/search method=get class=search-form>
<div class=search-input-group>
<input type=search name=q id=search-query placeholder=Search... class=search-input aria-label=Search>
<button type=submit class=search-button aria-label="Submit search">
<i class="fas fa-search"></i>
</button>
</div>
</form>
</div>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs-container>
<main class="docs-main docs-main-full">
<article class=docs-content>
<nav class=docs-breadcrumb>
<ol>
<li><a href=/><i class="fas fa-home"></i> Home</a></li>
<li><a href=/docs/>Documentation</a></li>
<li class=active>Apache Hive : Vectorized Query Execution</li>
</ol>
</nav>
<header class=docs-header>
<h1 class=docs-title>Apache Hive : Vectorized Query Execution</h1>
<div class=docs-meta>
<span class=docs-date>
<i class="fas fa-calendar-alt"></i>
Last updated: December 12, 2024
</span>
</div>
</header>
<div class=docs-toc>
<h4><i class="fas fa-list"></i> Table of Contents</h4>
<nav id=TableOfContents>
<ul>
<li><a href=#apache-hive--vectorized-query-execution>Apache Hive : Vectorized Query Execution</a></li>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#using-vectorized-query-execution>Using Vectorized Query Execution</a>
<ul>
<li><a href=#enabling-vectorized-execution>Enabling vectorized execution</a></li>
<li><a href=#supported-data-types-and-operations>Supported data types and operations</a></li>
<li><a href=#seeing-whether-vectorization-is-used-for-a-query>Seeing whether vectorization is used for a query</a></li>
</ul>
</li>
<li><a href=#limitations>Limitations</a></li>
<li><a href=#version-information>Version Information</a></li>
</ul>
</nav>
</div>
<div class=docs-article>
<h1 id=apache-hive--vectorized-query-execution>Apache Hive : Vectorized Query Execution</h1>
<aside class=table-of-contents>
<nav id=TableOfContents>
<ul>
<li><a href=#apache-hive--vectorized-query-execution>Apache Hive : Vectorized Query Execution</a></li>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#using-vectorized-query-execution>Using Vectorized Query Execution</a>
<ul>
<li><a href=#enabling-vectorized-execution>Enabling vectorized execution</a></li>
<li><a href=#supported-data-types-and-operations>Supported data types and operations</a></li>
<li><a href=#seeing-whether-vectorization-is-used-for-a-query>Seeing whether vectorization is used for a query</a></li>
</ul>
</li>
<li><a href=#limitations>Limitations</a></li>
<li><a href=#version-information>Version Information</a></li>
</ul>
</nav>
</aside>
<h1 id=introduction>Introduction</h1>
<p>Vectorized query execution is a Hive feature that greatly reduces the CPU usage for typical query operations like scans, filters, aggregates, and joins. A standard query execution system processes one row at a time. This involves long code paths and significant metadata interpretation in the inner loop of execution. Vectorized query execution streamlines operations by processing a block of 1024 rows at a time. Within the block, each column is stored as a vector (an array of a primitive data type). Simple operations like arithmetic and comparisons are done by quickly iterating through the vectors in a tight loop, with no or very few function calls or conditional branches inside the loop. These loops compile in a streamlined way that uses relatively few instructions and finishes each instruction in fewer clock cycles, on average, by effectively using the processor pipeline and cache memory. A detailed design document is attached to the vectorized query execution JIRA, at <a href=https://issues.apache.org/jira/browse/HIVE-4160>https://issues.apache.org/jira/browse/HIVE-4160</a>.</p>
<h1 id=using-vectorized-query-execution>Using Vectorized Query Execution</h1>
<h2 id=enabling-vectorized-execution>Enabling vectorized execution</h2>
<p>To use vectorized query execution, you must store your data in <a href=https://hive.apache.org/docs/latest/language/languagemanual-orc/>ORC</a> format, and set the following variable as shown in Hive SQL (see <a href=#configuring-hive>Configuring Hive</a>):</p>
<p><code>set hive.vectorized.execution.enabled = true;</code></p>
<p>Vectorized execution is off by default, so your queries only utilize it if this variable is turned on. To disable vectorized execution and go back to standard execution, do the following:</p>
<p><code>set hive.vectorized.execution.enabled = false;</code></p>
<p>Additional configuration variables for vectorized execution are documented in <a href=#configuration-properties –-vectorization>Configuration Properties – Vectorization</a>.</p>
<h2 id=supported-data-types-and-operations>Supported data types and operations</h2>
<p>The following data types are currently supported for vectorized execution:</p>
<ul>
<li><code>tinyint</code></li>
<li><code>smallint</code></li>
<li><code>int</code></li>
<li><code>bigint</code></li>
<li><code>boolean</code></li>
<li><code>float</code></li>
<li><code>double</code></li>
<li><code>decimal</code></li>
<li><code>date</code></li>
<li><code>timestamp</code> (see <a href=#limitations>Limitations</a> below)</li>
<li><code>string</code></li>
</ul>
<p>Using other data types will cause your query to execute using standard, row-at-a-time execution.</p>
<p>The following expressions can be vectorized when used on supported types:</p>
<ul>
<li>arithmetic: +, -, *, /, %</li>
<li>AND, OR, NOT</li>
<li>comparisons &lt;, >, &lt;=, >=, =, !=, BETWEEN, IN ( list-of-constants ) as filters</li>
<li>Boolean-valued expressions (non-filters) using AND, OR, NOT, &lt;, >, &lt;=, >=, =, !=</li>
<li>IS [NOT] NULL</li>
<li>all math functions (SIN, LOG, etc.)</li>
<li>string functions SUBSTR, CONCAT, TRIM, LTRIM, RTRIM, LOWER, UPPER, LENGTH</li>
<li>type casts</li>
<li>Hive user-defined functions, including standard and generic UDFs</li>
<li>date functions (YEAR, MONTH, DAY, HOUR, MINUTE, SECOND, UNIX_TIMESTAMP)</li>
<li>the IF conditional expression</li>
</ul>
<p>User-defined functions are supported using a backward compatibility bridge, so although they do run vectorized, they don&rsquo;t run as fast as optimized vector implementations of built-in operators and functions. Vectorized filter operations are evaluated left-to-right, so for best performance, put UDFs on the right in an ANDed list of expressions in the WHERE clause. E.g., use</p>
<p><code>column1 = 10 and myUDF(column2) = "x"</code></p>
<p>instead of</p>
<p><code>myUDF(column2) = "x" and column1 = 10</code></p>
<p>This will allow the optimized filter to run first, potentially eliminating many rows from consideration, before running the UDF via the bridge. The UDF will only be run for rows that pass the filter on the left hand side of the AND operation.</p>
<p>Using a built-in operator or function that is not supported for vectorization will cause your query to run in standard row-at-a-time mode. If a compile time or run time error occurs that appears related to vectorization, please file a <a href=https://issues.apache.org/jira/browse/HIVE>Hive JIRA</a>. To work around such an error, disable vectorization by setting <code>hive.vectorized.execution.enabled</code> to <code>false</code> for the specific query that is failing, to run it in standard mode.</p>
<p>Vectorized support continues to be added for additional functions and expressions. If you have a request for one, please comment on this page, or open a JIRA for it.</p>
<h2 id=seeing-whether-vectorization-is-used-for-a-query>Seeing whether vectorization is used for a query</h2>
<p>You can verify which parts of your query are being vectorized using the <strong><a href=https://hive.apache.org/docs/latest/language/languagemanual-explain/>explain</a></strong> feature. For example, when Fetch is used in the plan instead of Map, it does not vectorize and the explain output will not include the &ldquo;<code>Vectorized execution: true</code>&rdquo; notation:</p>
<pre tabindex=0><code>create table vectorizedtable(state string,id int) stored as orc;

insert into vectorizedtable values('haryana',1);
set hive.vectorized.execution.enabled = true;
explain select count(*) from vectorizedtable;
</code></pre><p>The <strong>explain</strong> output contains this:</p>
<pre tabindex=0><code>STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -&gt; Map Operator Tree:
        alltypesorc
          TableScan
            alias: vectorizedtable
             Statistics: Num rows: 1 Data size: 95 Basic stats: COMPLETE Column stats: COMPLETE
            Select Operator
              Statistics: Num rows: 1 Data size: 95 Basic stats: COMPLETE Column stats: COMPLETE
              Group By Operator
                aggregations: count()
                mode: hash
                outputColumnNames: _col0
                Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                Reduce Output Operator
                  sort order: 
                  Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                  value expressions: _col0 (type: bigint)
      Execution mode: vectorized
      Reduce Operator Tree:
        Group By Operator
          aggregations: count(VALUE._col0)
          mode: mergepartial
          outputColumnNames: _col0
          Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
          File Output Operator
            compressed: false
            Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
            table:
                input format: org.apache.hadoop.mapred.TextInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        ListSink

</code></pre><p>The notation <code>Vectorized execution: true</code> shows that the operator containing that notation is vectorized. Absence of this notation means the operator is not vectorized, and uses the standard row-at-a-time execution path.</p>
<p><strong>Note</strong>: In case you want to use vectorized execution for fetch then </p>
<p>set hive.fetch.task.conversion=none</p>
<h1 id=limitations>Limitations</h1>
<ul>
<li>Timestamps only work correctly with vectorized execution if the timestamp value is between 1677-09-20 and 2262-04-11. This limitation is due to the fact that a vectorized timestamp value is stored as a long value representing nanoseconds before/after the Unix Epoch time of 1970-01-01 00:00:00 UTC. Also see <a href=https://issues.apache.org/jira/browse/HIVE-9862>HIVE-9862</a>.</li>
</ul>
<h1 id=version-information>Version Information</h1>
<p>Vectorized execution is available in Hive 0.13.0 and later (<a href=https://issues.apache.org/jira/browse/HIVE-5283>HIVE-5283</a>).</p>
</div>
<footer class=docs-footer>
<div class=docs-feedback>
<h4><i class="fas fa-comment"></i> Feedback</h4>
<p>Was this page helpful? Let us know how we can improve.</p>
<div class=docs-feedback-buttons>
<button class="btn btn-feedback btn-positive">
<i class="fas fa-thumbs-up"></i> Yes
</button>
<button class="btn btn-feedback btn-negative">
<i class="fas fa-thumbs-down"></i> No
</button>
</div>
</div>
<div class=docs-edit>
<a href=https://github.com/apache/hive-site/edit/main/content/Development/desingdocs/vectorized-query-execution.md class="btn btn-outline">
<i class="fab fa-github"></i> Edit this page on GitHub
</a>
</div>
</footer>
</article>
<aside class=docs-toc-sidebar>
<div class=docs-toc-sticky>
<h4><i class="fas fa-list"></i> On this page</h4>
<nav id=TableOfContents>
<ul>
<li><a href=#apache-hive--vectorized-query-execution>Apache Hive : Vectorized Query Execution</a></li>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#using-vectorized-query-execution>Using Vectorized Query Execution</a>
<ul>
<li><a href=#enabling-vectorized-execution>Enabling vectorized execution</a></li>
<li><a href=#supported-data-types-and-operations>Supported data types and operations</a></li>
<li><a href=#seeing-whether-vectorization-is-used-for-a-query>Seeing whether vectorization is used for a query</a></li>
</ul>
</li>
<li><a href=#limitations>Limitations</a></li>
<li><a href=#version-information>Version Information</a></li>
</ul>
</nav>
</div>
</aside>
</main>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>