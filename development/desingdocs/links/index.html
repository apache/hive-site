<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=author content>
<title>Apache Hive : Links</title>
<link rel=icon href=/images/hive.svg sizes=any type=image/svg+xml>
<link rel=stylesheet href=https://hive.apache.org/css/hive-theme.css>
<link rel=stylesheet href=https://hive.apache.org/css/font-awesome.all.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/bootstrap.min.css>
<link rel=stylesheet href=https://hive.apache.org/css/termynal.css>
<link rel=apple-touch-icon sizes=180x180 href=https://hive.apache.org/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://hive.apache.org/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://hive.apache.org/images/favicon-16x16.png>
<link rel=manifest href=https://hive.apache.org/images/site.webmanifest>
<link rel=mask-icon href=https://hive.apache.org/images/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']),_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var b="https://analytics.apache.org/",c,a,d;_paq.push(['setTrackerUrl',b+'matomo.php']),_paq.push(['setSiteId','30']),c=document,a=c.createElement('script'),d=c.getElementsByTagName('script')[0],a.async=!0,a.src=b+'matomo.js',d.parentNode.insertBefore(a,d)}()</script>
</head>
<body>
<body>
<header>
<menu class=main-menu>
<nav class="navbar navbar-expand-lg navbar-dark">
<div class=container-fluid>
<div class=navbar-brand-wrapper>
<a href=https://hive.apache.org class=navbar-logo>
<img src=https://hive.apache.org/images/hive.svg width=50 height=30 alt="Apache Hive Logo">
</a>
<a class=navbar-brand href=https://hive.apache.org>Apache Hive</a>
</div>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto">
<li class=nav-item>
<a class=nav-link href=https://hive.apache.org/general/downloads>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/Document id=docsDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Documentation
</a>
<ul class=dropdown-menu aria-labelledby=docsDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/docs/latest/>Latest</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/javadocs/>Javadocs</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/docs/latest/language/languagemanual>Language Manual</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=/general id=generalDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
General
</a>
<ul class=dropdown-menu aria-labelledby=generalDropdown>
<li><a class=dropdown-item href=https://www.apache.org/licenses/LICENSE-2.0.html>License</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/general/privacypolicy/>Privacy Policy</a></li>
<li><a class=dropdown-item href=/general/poweredby/>Powered by</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=devDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Development
</a>
<ul class=dropdown-menu aria-labelledby=devDropdown>
<li><a class=dropdown-item href=https://hive.apache.org/development/gettingstarted/>Getting Started</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/quickstart/>Quickstart with Docker</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/desingdocs/>Design Docs</a></li>
<li><a class=dropdown-item href=https://issues.apache.org/jira/projects/HIVE/issues>Hive JIRA</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/resources/hivedeveloperfaq>Hive Developer FAQ</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/development/versioncontrol/>Version Control</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=communityDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
Community
</a>
<ul class=dropdown-menu aria-labelledby=communityDropdown>
<li><a class=dropdown-item href=/community/becomingcommitter/>Becoming A Committer</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/resources/howtocontribute>How To Contribute</a></li>
<li><a class=dropdown-item href=/community/resources/>Resources</a></li>
<li><a class=dropdown-item href=/community/meetings/>Meetings</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/mailinglists/>Mailing Lists</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/issuetracking/>Issue Tracking</a></li>
<li><a class=dropdown-item href=https://hive.apache.org/community/people/>People</a></li>
<li><hr class=dropdown-divider></li>
<li><a class=dropdown-item href=/community/bylaws/>By Laws</a></li>
<li><a class=dropdown-item href=/community/resources/howtorelease/>How To Release</a></li>
</ul>
</li>
<li class=nav-item>
<a class=nav-link href=https://hive.blog.apache.org/>
Blogs
</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=asfDropdown role=button data-bs-toggle=dropdown aria-expanded=false>
ASF
</a>
<ul class=dropdown-menu aria-labelledby=asfDropdown>
<li><a class=dropdown-item href=https://www.apache.org/foundation/contributing.html>Donations</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li>
<li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li>
<li><a class=dropdown-item href=https://www.apache.org/>Website</a></li>
</ul>
</li>
</ul>
<div class=navbar-search>
<form action=/search method=get class=search-form>
<div class=search-input-group>
<input type=search name=q id=search-query placeholder=Search... class=search-input aria-label=Search>
<button type=submit class=search-button aria-label="Submit search">
<i class="fas fa-search"></i>
</button>
</div>
</form>
</div>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs-container>
<main class="docs-main docs-main-full">
<article class=docs-content>
<nav class=docs-breadcrumb>
<ol>
<li><a href=/><i class="fas fa-home"></i> Home</a></li>
<li><a href=/docs/>Documentation</a></li>
<li class=active>Apache Hive : Links</li>
</ol>
</nav>
<header class=docs-header>
<h1 class=docs-title>Apache Hive : Links</h1>
<div class=docs-meta>
<span class=docs-date>
<i class="fas fa-calendar-alt"></i>
Last updated: December 12, 2024
</span>
</div>
</header>
<div class=docs-toc>
<h4><i class="fas fa-list"></i> Table of Contents</h4>
<nav id=TableOfContents>
<ul>
<li><a href=#apache-hive--links>Apache Hive : Links</a></li>
<li><a href=#motivation>Motivation</a></li>
<li><a href=#requirements>Requirements</a></li>
<li><a href=#design>Design</a></li>
<li><a href=#alternate-design-options>Alternate design options</a>
<ul>
<li><a href=#modeling-namespace-as-a-role-in-hive-using-the-authorization-model>Modeling Namespace as a Role in Hive (using the authorization model)</a></li>
<li><a href=#modeling-namespace-by-tagging-objects>Modeling Namespace by tagging objects</a></li>
<li><a href=#modeling-namespace-as-a-database-but-using-views-for-imports>Modeling Namespace as a database but using views for imports</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div class=docs-article>
<h1 id=apache-hive--links>Apache Hive : Links</h1>
<h1 id=motivation>Motivation</h1>
<p>Today, the infrastructure provided by Hive allows for the setup of a single shared warehouse and the authorization model allows for access control within this warehouse if needed. Growth beyond a single warehouse (when datacenter capacity limits are reached) OR separation of capacity usage and allocation requires the creation of multiple warehouses with each warehouse mapping to it&rsquo;s own Hive metastore. Let&rsquo;s define the term physical warehouse to map to a single Hive metastore, the Hadoop cluster it maps to and the data in it.</p>
<p>In organizations with a large number of teams needing a warehouse, there is a need to be able to:</p>
<ul>
<li>Maximize sharing of physical clusters to keep operational costs low</li>
<li>Clearly identify and track capacity usage by teams in the data warehouse</li>
</ul>
<p>One way to do this is to use a single shared warehouse as we do today, but this has the below issues:</p>
<ul>
<li>When the warehouse reaches datacenter capacity limits, it is hard to identify self-contained pieces that can be migrated out.</li>
<li>Capacity tracking and management becomes an issue.</li>
</ul>
<p>An alternative is to create a new physical warehouse per team (1:1 mapping), but this is not optimal since the physical resources are not shared across teams, and the operational cost is high. Further, data may not be cleanly partition-able and end up being replicated in multiple physical warehouses.</p>
<p>To provide context, in Facebook, we expect to have 20+ partitions of the warehouse, so operating each in their own physical warehouse will be impractical from an operational perspective.</p>
<h1 id=requirements>Requirements</h1>
<p>Introduce the notion of a virtual warehouse (namespace) in Hive with the below key properties:</p>
<ul>
<li>Can be housed in the same physical warehouse with other virtual warehouses (multi-tenancy).</li>
<li>Portable (so it can be moved from one physical warehouse to another). Being self-contained is a necessary condition for portability (all queries on this namespace operate only on data available in the namespace).</li>
<li>Unit of capacity tracking and capacity allocation. This is a nice side effect of creating self-contained namespaces and allows capacity planning based on the virtual warehouse growth.</li>
</ul>
<p>Mapping many namespaces to 1 physical warehouse keeps the operational cost low. If a physical warehouse reaches capacity limits, portability will allow seamless migration of the namespace to another physical warehouse.</p>
<p>Note that users can operate on multiple namespaces simultaneously although they are likely to most often operate within one namespace. So namespaces are not trying to solve the problem of ensuring that users only have access to a subset of data in the warehouse.</p>
<p>From Hive, therefore the requirements are:</p>
<ul>
<li>Provide metadata to identify tables and queries that belong to one namespace.</li>
<li>Provide controls to prevent operating on tables outside the namespace.</li>
<li>Provide commands to explicitly request that tables/partitions in namespace1 be made available in namespace2 (since some tables/partitions may be needed across multiple namespaces). Avoid making copies of tables/partitions for this.</li>
</ul>
<h1 id=design>Design</h1>
<p>The design that is proposed is:</p>
<ul>
<li>Modeling namespaces as databases. No explicit accounting/tracking of tables/partitions/views that belong to a namespace is needed since a database provides that already.</li>
<li>Prevent access using two part name syntax (Y.T). This ensures the database is self-contained.</li>
<li>Modeling table/partition imports across namespaces using a new concept called Links in Hive. There will be commands to create Links to tables in other databases, alter and drop them. Links do not make copies of the table/partition and hence avoid data duplication in the same physical warehouse.</li>
</ul>
<p>Let’s take a concrete example:</p>
<ul>
<li>Namespace A resides in database A, namespace B in database B.</li>
<li>Access across these namespace using A.T or B.T syntax is disabled in ‘namespace’ mode.</li>
<li>The user is importing table T1 from B into A .</li>
<li>The user issues a CREATE LINK command, which creates metadata in the target namespace A for the table + metadata to indicate which object is linked.</li>
<li>The ALTER LINK ADD PARTITION command is used to add partitions to the link.</li>
<li>These partitions are modeled by replicating partition-level metadata in the target database A for the accessible partitions.</li>
<li>The Link can be dynamic, which means it is kept updated as the source table gets new partitions or drops partitions.</li>
</ul>
<p>There are 3 alternatives to implementing these ideas in open-source hive and Facebook extensions:</p>
<ul>
<li>Implement links as a first-class concept in Hive, and use a Facebook hook to disable Y.T access unless there is a link to the table Y.T.</li>
<li>Implement links as a first-class concept, and introduce a new syntax T@Y to access linked content. Use a Facebook hook to disable Y.T access.</li>
<li>Implement links as a first-class concept, and introduce a new syntax T@Y to access linked content. Disable cross database access using a new privilege. All these changes will be in Open Source Hive.</li>
</ul>
<p>Links to JIRAS for these features:</p>
<ul>
<li><a href=https://issues.apache.org/jira/browse/HIVE-3047>HIVE-3047 Add a privilege for cross database access</a></li>
<li><a href=https://issues.apache.org/jira/browse/HIVE-2989>HIVE-2989 Adding Table Links to Hive</a></li>
</ul>
<p>A basic tenet of our design is that a Hive instance does not operate across physical warehouses. We are building a namespace service external to Hive that has metadata on namespace location across the Hive instances, and allows importing data across Hive instances using replication.</p>
<h1 id=alternate-design-options>Alternate design options</h1>
<h2 id=modeling-namespace-as-a-role-in-hive-using-the-authorization-model>Modeling Namespace as a Role in Hive (using the authorization model)</h2>
<p>The idea here is to create a Role for each namespace and users operating in that namespace belong to that Role. Access to data outside the namespace is made possible by granting permissions to the foreign table/view to the Role for the namespace.</p>
<p>Issues</p>
<ul>
<li>A user who belongs to multiple namespaces (and hence multiple roles) will be able to operate on all data across those namespaces at any point in time, so namespaces are no longer self-contained. Imagine the situation of user A who has access to namespaces N1 and N2 running a query on both simultaneously. Either of those queries will be able to access data across both N1 and N2 although this shouldn’t be allowed.</li>
<li>Capacity tracking is more complex</li>
<li>Operations like show tables, and show partitions do not work without changes.</li>
</ul>
<h2 id=modeling-namespace-by-tagging-objects>Modeling Namespace by tagging objects</h2>
<p>The idea here is to tag tables/partitions with the namespaces that they belong to. To handle the requirements:</p>
<ul>
<li>Tags will have to be explicitly created by a user of the warehouse (through a command)</li>
<li>Commands like show tables and show partitions will need changes to understand tags.</li>
<li>Capacity tracking and management will be more complex than using databases for this purpose.</li>
<li>Data migration is more complex since the data is not contained with the root folder of one database</li>
</ul>
<p>None of these are insurmountable problems, but using databases to model namespaces is a cleaner approach.</p>
<p>(Taking this idea further, a database in Hive could itself have been implemented using tags in a single global namespace which would have not been as elegant as the current implementation of a database being a first class concept in Hive.)</p>
<h2 id=modeling-namespace-as-a-database-but-using-views-for-imports>Modeling Namespace as a database but using views for imports</h2>
<ul>
<li>The view would be a simple select * using Y.T syntax. It’s a degenerate case of view.</li>
<li>We would need a registry of all views which import tables/partitions from other databases for namespace accounting. This requires adding metadata to these views to distinguish them from other user-created views.</li>
<li>It would be harder to single instance imports using views (same table/partitions imported twice into the same namespace). Views are too opaque.</li>
</ul>
<p>Using partitioned views:</p>
<p>By definition, there isn&rsquo;t a one-one mapping between a view partition and a table partition. In fact, hive today does not even know about this dependency between view partitions and table partitions. Partitioned views is just a metadata concept - it is not something that the query layer understands. For e.g: if a view V partitioned on ds had 2 partitions: 1 and 2, then a query like select … from V where ds = 3 may still give valid results if the ds=3 is satisfied by the table underlying V. This means that:</p>
<ul>
<li>View metadata doesn’t stay in sync with source partitions (as partitions get added and dropped). The user has to explicitly do this, which won&rsquo;t work for our case.</li>
<li>We would like to differentiate the set of partitions that are available for the same imported tables across namespaces. This would require partition pruning based on the view partitions in query rewrite which is not how it works today.</li>
</ul>
<p>The above notes make it clear that what we are trying to build is a very special case of a degenerate view, and it would be cleaner to introduce a new concept in Hive to model these ‘imports’.</p>
</div>
<footer class=docs-footer>
<div class=docs-feedback>
<h4><i class="fas fa-comment"></i> Feedback</h4>
<p>Was this page helpful? Let us know how we can improve.</p>
<div class=docs-feedback-buttons>
<button class="btn btn-feedback btn-positive">
<i class="fas fa-thumbs-up"></i> Yes
</button>
<button class="btn btn-feedback btn-negative">
<i class="fas fa-thumbs-down"></i> No
</button>
</div>
</div>
<div class=docs-edit>
<a href=https://github.com/apache/hive-site/edit/main/content/Development/desingdocs/links.md class="btn btn-outline">
<i class="fab fa-github"></i> Edit this page on GitHub
</a>
</div>
</footer>
</article>
<aside class=docs-toc-sidebar>
<div class=docs-toc-sticky>
<h4><i class="fas fa-list"></i> On this page</h4>
<nav id=TableOfContents>
<ul>
<li><a href=#apache-hive--links>Apache Hive : Links</a></li>
<li><a href=#motivation>Motivation</a></li>
<li><a href=#requirements>Requirements</a></li>
<li><a href=#design>Design</a></li>
<li><a href=#alternate-design-options>Alternate design options</a>
<ul>
<li><a href=#modeling-namespace-as-a-role-in-hive-using-the-authorization-model>Modeling Namespace as a Role in Hive (using the authorization model)</a></li>
<li><a href=#modeling-namespace-by-tagging-objects>Modeling Namespace by tagging objects</a></li>
<li><a href=#modeling-namespace-as-a-database-but-using-views-for-imports>Modeling Namespace as a database but using views for imports</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://www.apache.org/>
<img src=https://hive.apache.org/images/asf_logo.png width=270 height=100 alt="Apache Software Foundation"></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>Apache is a non-profit organization helping open-source
software projects released under the Apache
<a href=https://www.apache.org/licenses/>license</a>
and managed with
<a href=https://www.apache.org/foundation/how-it-works.html>
open governance</a> and
<a href=https://privacy.apache.org/policies/privacy-policy-public.html>
privacy policy</a>. See upcoming
<a href=https://www.apache.org/events/current-event>Apache Events</a>.
If you discover any
<a href=https://www.apache.org/security/>security</a> vulnerabilities, please
report them privately. Finally,
<a href=https://www.apache.org/foundation/sponsorship.html>thanks
</a> to the sponsors who
<a href=https://www.apache.org/foundation/contributing.html>
donate</a> to the Apache Foundation.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://hive.apache.org style=color:grey>
The contents of this website are © 2023 Apache Software Foundation under the terms of the Apache License v2. Apache Hive and its logo are trademarks of the Apache Software Foundation.
</a>
</div>
</footer>
<script src=https://hive.apache.org/js/bootstrap.bundle.min.js></script>
</body>
</html>